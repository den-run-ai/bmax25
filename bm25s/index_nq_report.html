<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
.r1 {color: #005f00; text-decoration-color: #005f00}
.r2 {font-weight: bold}
.r3 {color: #000080; text-decoration-color: #000080; font-weight: bold}
.r4 {color: #005f00; text-decoration-color: #005f00; font-weight: bold}
.r5 {color: #87af00; text-decoration-color: #87af00; font-weight: bold}
.r6 {color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold}
.r7 {color: #000080; text-decoration-color: #000080; font-weight: bold; font-style: italic}
.r8 {color: #005f00; text-decoration-color: #005f00; font-weight: bold; font-style: italic}
.r9 {color: #87af00; text-decoration-color: #87af00; font-weight: bold; font-style: italic}
.r10 {color: #7f7f7f; text-decoration-color: #7f7f7f}
.r11 {color: #000080; text-decoration-color: #000080}
.r12 {color: #87af00; text-decoration-color: #87af00}
.r13 {color: #ba2121; text-decoration-color: #ba2121; background-color: #f8f8f8; font-style: italic}
.r14 {background-color: #f8f8f8}
.r15 {color: #008000; text-decoration-color: #008000; background-color: #f8f8f8; font-weight: bold}
.r16 {color: #bbbbbb; text-decoration-color: #bbbbbb; background-color: #f8f8f8}
.r17 {color: #0000ff; text-decoration-color: #0000ff; background-color: #f8f8f8; font-weight: bold}
.r18 {color: #000000; text-decoration-color: #000000; background-color: #f8f8f8}
.r19 {color: #0000ff; text-decoration-color: #0000ff; background-color: #f8f8f8}
.r20 {color: #666666; text-decoration-color: #666666; background-color: #f8f8f8}
.r21 {color: #ba2121; text-decoration-color: #ba2121; background-color: #f8f8f8}
.r22 {color: #008000; text-decoration-color: #008000; background-color: #f8f8f8}
.r23 {color: #aa22ff; text-decoration-color: #aa22ff; background-color: #f8f8f8; font-weight: bold}
.r24 {color: #800000; text-decoration-color: #800000; font-weight: bold}
.r25 {color: #a45a77; text-decoration-color: #a45a77; background-color: #f8f8f8; font-weight: bold}
.r26 {color: #3d7b7b; text-decoration-color: #3d7b7b; background-color: #f8f8f8; font-style: italic}
.r27 {color: #19177c; text-decoration-color: #19177c; background-color: #f8f8f8}
.r28 {font-weight: bold; font-style: italic}
.r29 {color: #008080; text-decoration-color: #008080; font-weight: bold}
.r30 {font-style: italic}
.r31 {color: #cb3f38; text-decoration-color: #cb3f38; background-color: #f8f8f8; font-weight: bold}
.r32 {color: #aa22ff; text-decoration-color: #aa22ff; background-color: #f8f8f8}
.r33 {color: #aa5d1f; text-decoration-color: #aa5d1f; background-color: #f8f8f8; font-weight: bold}
.r34 {color: #000080; text-decoration-color: #000080; text-decoration: underline}
body {
    color: #000000;
    background-color: #ffffff;
}
</style>
</head>
<body>
    <pre style="font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><code style="font-family:inherit">                           Memory usage: <span class="r1">▁▁▁▁▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▆▆▆▇▇</span> (max: 20.930 GB, growth rate:  76%)                           
             /home/team-054/dkozlov/bm25s/examples/index_nq.py: % of time = 100.00% (21m:32.451s) out of 21m:32.451s.              
       ╷       ╷       ╷       ╷        ╷       ╷               ╷       ╷                                                          
 <span class="r2">      </span>│<span class="r3">Time</span><span class="r2">   </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r4">Memory</span><span class="r2">  </span>│<span class="r4">––––––</span><span class="r2"> </span>│<span class="r4">–––––––––––</span><span class="r2">    </span>│<span class="r5">Copy</span><span class="r2">   </span>│<span class="r2">                                                         </span> 
 <span class="r2"> </span><span class="r6">Line</span><span class="r2"> </span>│<span class="r7">Python</span><span class="r2"> </span>│<span class="r7">native</span><span class="r2"> </span>│<span class="r7">system</span><span class="r2"> </span>│<span class="r8">Python</span><span class="r2">  </span>│<span class="r8">peak</span><span class="r2">   </span>│<span class="r8">timeline</span><span class="r4">/%</span><span class="r2">     </span>│<span class="r9">(MB/s)</span><span class="r2"> </span>│<span class="r2">/home/team-054/dkozlov/bm25s/examples/index_nq.py        </span> 
╺━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r10">    1 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                     </span>  
 <span class="r10">    2 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13"># Example: Indexing Natural Questions</span><span class="r14">                   </span>  
 <span class="r10">    3 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    4 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">This shows how to build an index of the natural question</span>  
 <span class="r10">    5 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    6 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">To run this example, you need to install the following d</span>  
 <span class="r10">    7 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    8 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">```bash</span><span class="r14">                                                 </span>  
 <span class="r10">    9 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">pip install bm25s[core]</span><span class="r14">                                 </span>  
 <span class="r10">   10 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">```</span><span class="r14">                                                     </span>  
 <span class="r10">   11 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   12 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">Then, run with:</span><span class="r14">                                         </span>  
 <span class="r10">   13 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   14 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">```bash</span><span class="r14">                                                 </span>  
 <span class="r10">   15 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">python examples/index_nq.py</span><span class="r14">                             </span>  
 <span class="r10">   16 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">```</span><span class="r14">                                                     </span>  
 <span class="r10">   17 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                     </span>  
 <span class="r10">   18 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   19 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">pathlib</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> Path</span><span class="r14">                                </span>  
 <span class="r10">   20 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">bm25s</span><span class="r14">                                            </span>  
 <span class="r10">   21 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">Stemmer</span><span class="r14">                                          </span>  
 <span class="r10">   22 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   23 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   24 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">main</span><span class="r18">(save_dir</span><span class="r20">=</span><span class="r21">&quot;datasets&quot;</span><span class="r18">, index_dir</span><span class="r20">=</span><span class="r21">&quot;bm25s_indices/&quot;</span>  
 <span class="r10">   25 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    index_dir </span><span class="r20">=</span><span class="r18"> Path(index_dir) </span><span class="r20">/</span><span class="r18"> dataset</span><span class="r14">               </span>  
 <span class="r10">   26 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    index_dir</span><span class="r20">.</span><span class="r18">mkdir(parents</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, exist_ok</span><span class="r20">=</span><span class="r15">True</span><span class="r18">)</span><span class="r14">        </span>  
 <span class="r10">   27 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r14">                                                    </span>  
 <span class="r10">   28 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r22">print</span><span class="r18">(</span><span class="r21">&quot;Downloading the dataset...&quot;</span><span class="r18">)</span><span class="r14">                 </span>  
 <span class="r10">   29 </span>│<span class="r11">    1% </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    bm25s</span><span class="r20">.</span><span class="r18">utils</span><span class="r20">.</span><span class="r18">beir</span><span class="r20">.</span><span class="r18">download_dataset(dataset, save_dir</span><span class="r20">=</span>  
 <span class="r10">   30 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r22">print</span><span class="r18">(</span><span class="r21">&quot;Loading the corpus...&quot;</span><span class="r18">)</span><span class="r14">                      </span>  
 <span class="r10">   31 </span>│<span class="r11">    6% </span>│<span class="r11">    1% </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    corpus </span><span class="r20">=</span><span class="r18"> bm25s</span><span class="r20">.</span><span class="r18">utils</span><span class="r20">.</span><span class="r18">beir</span><span class="r20">.</span><span class="r18">load_corpus(dataset, save_</span>  
 <span class="r10">   32 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  102M </span>│<span class="r1">▁▁▁▁▁▁▁▁       </span>│<span class="r12">       </span>│<span class="r18">    corpus_records </span><span class="r20">=</span><span class="r18"> [</span><span class="r14">                                  </span>  
 <span class="r10">   33 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1"> 1.88G </span>│<span class="r1">▁▁▁▁▁▁▁▁▁   8% </span>│<span class="r12">     1 </span>│<span class="r18">        {</span><span class="r21">&quot;id&quot;</span><span class="r18">: k, </span><span class="r21">&quot;title&quot;</span><span class="r18">: v[</span><span class="r21">&quot;title&quot;</span><span class="r18">], </span><span class="r21">&quot;text&quot;</span><span class="r18">: v[</span><span class="r21">&quot;text&quot;</span><span class="r18">]</span>  
 <span class="r10">   34 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ]</span><span class="r14">                                                   </span>  
 <span class="r10">   35 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1"> 3.32G </span>│<span class="r1">▁▁▁▁▁▁▁▁▁  14% </span>│<span class="r12">     2 </span>│<span class="r18">    corpus_lst </span><span class="r20">=</span><span class="r18"> [r[</span><span class="r21">&quot;title&quot;</span><span class="r18">] </span><span class="r20">+</span><span class="r18"> </span><span class="r21">&quot; &quot;</span><span class="r18"> </span><span class="r20">+</span><span class="r18"> r[</span><span class="r21">&quot;text&quot;</span><span class="r18">] </span><span class="r15">for</span><span class="r18"> r </span><span class="r23">in</span><span class="r18"> </span>  
 <span class="r10">   36 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   37 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    stemmer </span><span class="r20">=</span><span class="r18"> Stemmer</span><span class="r20">.</span><span class="r18">Stemmer(</span><span class="r21">&quot;english&quot;</span><span class="r18">)</span><span class="r14">                </span>  
 <span class="r10">   38 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    tokenizer </span><span class="r20">=</span><span class="r18"> bm25s</span><span class="r20">.</span><span class="r18">tokenization</span><span class="r20">.</span><span class="r18">Tokenizer(stemmer</span><span class="r20">=</span><span class="r18">ste</span>  
 <span class="r10">   39 </span>│<span class="r11">   23% </span>│<span class="r11">    4% </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    corpus_tokens </span><span class="r20">=</span><span class="r18"> tokenizer</span><span class="r20">.</span><span class="r18">tokenize(corpus_lst, retur</span>  
 <span class="r10">   40 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   41 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    retriever </span><span class="r20">=</span><span class="r18"> bm25s</span><span class="r20">.</span><span class="r18">BM25(corpus</span><span class="r20">=</span><span class="r18">corpus_records, backen</span>  
 <span class="r10">   42 </span>│<span class="r24">   41%</span><span class="r11"> </span>│<span class="r24">    2%</span><span class="r11"> </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    retriever</span><span class="r20">.</span><span class="r18">index(corpus_tokens)</span><span class="r14">                      </span>  
 <span class="r10">   43 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r14">                                                    </span>  
 <span class="r10">   44 </span>│<span class="r11">   16% </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    retriever</span><span class="r20">.</span><span class="r18">save(index_dir)</span><span class="r14">                           </span>  
 <span class="r10">   45 </span>│<span class="r11">       </span>│<span class="r11">    1% </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    tokenizer</span><span class="r20">.</span><span class="r18">save_vocab(index_dir)</span><span class="r14">                     </span>  
 <span class="r10">   46 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    tokenizer</span><span class="r20">.</span><span class="r18">save_stopwords(index_dir)</span><span class="r14">                 </span>  
 <span class="r10">   47 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r22">print</span><span class="r18">(</span><span class="r21">f&quot;Saved the index to </span><span class="r25">{</span><span class="r18">index_dir</span><span class="r25">}</span><span class="r21">.&quot;</span><span class="r18">)</span><span class="r14">           </span>  
 <span class="r10">   48 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r14">                                                    </span>  
 <span class="r10">   49 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># get memory usage</span><span class="r14">                                  </span>  
 <span class="r10">   50 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    mem_use </span><span class="r20">=</span><span class="r18"> bm25s</span><span class="r20">.</span><span class="r18">utils</span><span class="r20">.</span><span class="r18">benchmark</span><span class="r20">.</span><span class="r18">get_max_memory_usage</span>  
 <span class="r10">   51 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r22">print</span><span class="r18">(</span><span class="r21">f&quot;Peak memory usage: </span><span class="r25">{</span><span class="r18">mem_use</span><span class="r25">:</span><span class="r21">.2f</span><span class="r25">}</span><span class="r21"> GB&quot;</span><span class="r18">)</span><span class="r14">       </span>  
 <span class="r10">   52 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   53 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   54 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">if</span><span class="r18"> </span><span class="r27">__name__</span><span class="r18"> </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;__main__&quot;</span><span class="r18">:</span><span class="r14">                              </span>  
 <span class="r10">   55 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    main(dataset</span><span class="r20">=</span><span class="r21">&#x27;msmarco&#x27;</span><span class="r18">)</span><span class="r14">                             </span>  
 <span class="r10">   56 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">      </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│                                                          
╶──────┼───────┼───────┼───────┼────────┼───────┼───────────────┼───────┼─────────────────────────────────────────────────────────╴
 <span class="r10">      </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r28">function summary for /home/team-054/dkozlov/bm25s/examp…</span>  
 <span class="r10">   24 </span>│<span class="r24">   88%</span><span class="r11"> </span>│<span class="r24">    9%</span><span class="r11"> </span>│<span class="r11">   3%  </span>│<span class="r1"> 100%   </span>│<span class="r1"> 3.32G </span>│<span class="r24">█████████  14%</span><span class="r1"> </span>│<span class="r12">     2 </span>│<span class="r18">main</span><span class="r14">                                                    </span>  
       ╵       ╵       ╵       ╵        ╵       ╵               ╵       ╵                                                          
Top AVERAGE memory consumption, by line:
<span class="r1">(1)    35:  3403 MB</span>                                                                                                                 
<span class="r1">(2)    32:   102 MB</span>                                                                                                                 
Top PEAK memory consumption, by line:
<span class="r1">(1)    35:  3403 MB</span>                                                                                                                 
<span class="r1">(2)    33:  1920 MB</span>                                                                                                                 
<span class="r1">(3)    32:   102 MB</span>                                                                                                                 
Possible memory leak identified at line <span class="r29">35</span> <span class="r2">(</span>estimated likelihood: <span class="r29">100</span>%, velocity:   <span class="r29">3</span> MB/s<span class="r2">)</span>
Possible memory leak identified at line <span class="r29">33</span> <span class="r2">(</span>estimated likelihood:  <span class="r29">99</span>%, velocity:   <span class="r29">0</span> MB/s<span class="r2">)</span>
<span class="r30">                 /home/team-054/dkozlov/bm25s/bm25s/__init__.py: % of time =   0.00% (0.000ms) out of 21m:32.451s.                 </span>
       ╷       ╷       ╷       ╷        ╷       ╷               ╷       ╷                                                          
 <span class="r2">      </span>│<span class="r3">Time</span><span class="r2">   </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r4">Memory</span><span class="r2">  </span>│<span class="r4">––––––</span><span class="r2"> </span>│<span class="r4">–––––––––––</span><span class="r2">    </span>│<span class="r5">Copy</span><span class="r2">   </span>│<span class="r2">                                                         </span> 
 <span class="r2"> </span><span class="r6">Line</span><span class="r2"> </span>│<span class="r7">Python</span><span class="r2"> </span>│<span class="r7">native</span><span class="r2"> </span>│<span class="r7">system</span><span class="r2"> </span>│<span class="r8">Python</span><span class="r2">  </span>│<span class="r8">peak</span><span class="r2">   </span>│<span class="r8">timeline</span><span class="r4">/%</span><span class="r2">     </span>│<span class="r9">(MB/s)</span><span class="r2"> </span>│<span class="r2">/home/team-054/dkozlov/bm25s/bm25s/__init__.py           </span> 
╺━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r10">    1 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">concurrent.futures</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> ThreadPoolExecutor</span><span class="r14">       </span>  
 <span class="r10">    2 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">collections</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> Counter</span><span class="r14">                         </span>  
 <span class="r10">    3 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">functools</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> partial</span><span class="r14">                           </span>  
 <span class="r10">    4 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    5 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">os</span><span class="r14">                                               </span>  
 <span class="r10">    6 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">logging</span><span class="r14">                                          </span>  
 <span class="r10">    7 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">pathlib</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> Path</span><span class="r14">                                </span>  
 <span class="r10">    8 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">json</span><span class="r14">                                             </span>  
 <span class="r10">    9 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">typing</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> Any, Tuple, Dict, Iterable, List, Nam</span>  
 <span class="r10">   10 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   11 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   10M </span>│<span class="r1">▁              </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">numpy</span><span class="r16"> </span><span class="r15">as</span><span class="r16"> </span><span class="r17">np</span><span class="r14">                                      </span>  
 <span class="r10">   12 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   13 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">.utils</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> json_functions </span><span class="r15">as</span><span class="r18"> json_functions</span><span class="r14">     </span>  
 <span class="r10">   14 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   15 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">try</span><span class="r18">:</span><span class="r14">                                                    </span>  
 <span class="r10">   16 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">from</span><span class="r16"> </span><span class="r17">.numba</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> selection </span><span class="r15">as</span><span class="r18"> selection_jit</span><span class="r14">       </span>  
 <span class="r10">   17 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">except</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">:</span><span class="r14">                                     </span>  
 <span class="r10">   18 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    selection_jit </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r14">                                </span>  
 <span class="r10">   19 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   20 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">try</span><span class="r18">:</span><span class="r14">                                                    </span>  
 <span class="r10">   21 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">from</span><span class="r16"> </span><span class="r17">.numba.retrieve_utils</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> _retrieve_numba_fu</span>  
 <span class="r10">   22 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">except</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">:</span><span class="r14">                                     </span>  
 <span class="r10">   23 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    _retrieve_numba_functional </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r14">                   </span>  
 <span class="r10">   24 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   25 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   26 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_faketqdm</span><span class="r18">(iterable, </span><span class="r20">*</span><span class="r18">args, </span><span class="r20">**</span><span class="r18">kwargs):</span><span class="r14">               </span>  
 <span class="r10">   27 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> iterable</span><span class="r14">                                     </span>  
 <span class="r10">   28 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   29 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   30 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">if</span><span class="r18"> os</span><span class="r20">.</span><span class="r18">environ</span><span class="r20">.</span><span class="r18">get(</span><span class="r21">&quot;DISABLE_TQDM&quot;</span><span class="r18">, </span><span class="r15">False</span><span class="r18">):</span><span class="r14">               </span>  
 <span class="r10">   31 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    tqdm </span><span class="r20">=</span><span class="r18"> _faketqdm</span><span class="r14">                                    </span>  
 <span class="r10">   32 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># if can&#x27;t import tqdm, use a fake tqdm</span><span class="r14">             </span>  
 <span class="r10">   33 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">else</span><span class="r18">:</span><span class="r14">                                                   </span>  
 <span class="r10">   34 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">try</span><span class="r18">:</span><span class="r14">                                                </span>  
 <span class="r10">   35 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">from</span><span class="r16"> </span><span class="r17">tqdm.auto</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> tqdm</span><span class="r14">                      </span>  
 <span class="r10">   36 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">except</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">:</span><span class="r14">                                 </span>  
 <span class="r10">   37 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        tqdm </span><span class="r20">=</span><span class="r18"> _faketqdm</span><span class="r14">                                </span>  
 <span class="r10">   38 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   39 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   40 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">.</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> selection, utils, stopwords, scoring, toke</span>  
 <span class="r10">   41 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">.version</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> __version__</span><span class="r14">                        </span>  
 <span class="r10">   42 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">.tokenization</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> tokenize</span><span class="r14">                      </span>  
 <span class="r10">   43 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">.scoring</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> (</span><span class="r14">                                  </span>  
 <span class="r10">   44 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    _select_tfc_scorer,</span><span class="r14">                                 </span>  
 <span class="r10">   45 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    _select_idf_scorer,</span><span class="r14">                                 </span>  
 <span class="r10">   46 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    _build_scores_and_indices_for_matrix,</span><span class="r14">               </span>  
 <span class="r10">   47 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    _calculate_doc_freqs,</span><span class="r14">                               </span>  
 <span class="r10">   48 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    _build_idf_array,</span><span class="r14">                                   </span>  
 <span class="r10">   49 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    _build_nonoccurrence_array,</span><span class="r14">                         </span>  
 <span class="r10">   50 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">)</span><span class="r14">                                                       </span>  
 <span class="r10">   51 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   52 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">logger </span><span class="r20">=</span><span class="r18"> logging</span><span class="r20">.</span><span class="r18">getLogger(</span><span class="r21">&quot;bm25s&quot;</span><span class="r18">)</span><span class="r14">                     </span>  
 <span class="r10">   53 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">logger</span><span class="r20">.</span><span class="r18">setLevel(logging</span><span class="r20">.</span><span class="r18">DEBUG)</span><span class="r14">                          </span>  
 <span class="r10">   54 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   55 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   56 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">class</span><span class="r16"> </span><span class="r17">Results</span><span class="r18">(NamedTuple):</span><span class="r14">                              </span>  
 <span class="r10">   57 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">   58 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    NamedTuple with two fields: documents and scores. Th</span>  
 <span class="r10">   59 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    retrieved documents or indices, while the `scores` f</span>  
 <span class="r10">   60 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    retrieved documents or indices.</span><span class="r14">                     </span>  
 <span class="r10">   61 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">   62 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   63 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    documents: np</span><span class="r20">.</span><span class="r18">ndarray</span><span class="r14">                               </span>  
 <span class="r10">   64 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    scores: np</span><span class="r20">.</span><span class="r18">ndarray</span><span class="r14">                                  </span>  
 <span class="r10">   65 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   66 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">__len__</span><span class="r18">(</span><span class="r22">self</span><span class="r18">):</span><span class="r14">                                  </span>  
 <span class="r10">   67 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">documents)</span><span class="r14">                      </span>  
 <span class="r10">   68 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   69 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r32">@classmethod</span><span class="r14">                                        </span>  
 <span class="r10">   70 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">merge</span><span class="r18">(</span><span class="r22">cls</span><span class="r18">, results: List[</span><span class="r21">&quot;Results&quot;</span><span class="r18">]) </span><span class="r20">-&gt;</span><span class="r18"> </span><span class="r21">&quot;Results</span>  
 <span class="r10">   71 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">   72 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Merge a list of Results objects into a single Re</span>  
 <span class="r10">   73 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">   74 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        documents </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">concatenate([r</span><span class="r20">.</span><span class="r18">documents </span><span class="r15">for</span><span class="r18"> r </span><span class="r23">in</span>  
 <span class="r10">   75 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">concatenate([r</span><span class="r20">.</span><span class="r18">scores </span><span class="r15">for</span><span class="r18"> r </span><span class="r23">in</span><span class="r18"> resul</span>  
 <span class="r10">   76 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r22">cls</span><span class="r18">(documents</span><span class="r20">=</span><span class="r18">documents, scores</span><span class="r20">=</span><span class="r18">scores)</span><span class="r14">  </span>  
 <span class="r10">   77 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   78 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   79 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">get_unique_tokens</span><span class="r18">(</span><span class="r14">                                  </span>  
 <span class="r10">   80 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    corpus_tokens, show_progress</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, leave_progress</span><span class="r20">=</span><span class="r15">Fa</span>  
 <span class="r10">   81 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">):</span><span class="r14">                                                      </span>  
 <span class="r10">   82 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    unique_tokens </span><span class="r20">=</span><span class="r18"> </span><span class="r22">set</span><span class="r18">()</span><span class="r14">                               </span>  
 <span class="r10">   83 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> doc_tokens </span><span class="r23">in</span><span class="r18"> tqdm(</span><span class="r14">                             </span>  
 <span class="r10">   84 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus_tokens, desc</span><span class="r20">=</span><span class="r18">desc, disable</span><span class="r20">=</span><span class="r23">not</span><span class="r18"> show_progr</span>  
 <span class="r10">   85 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">   86 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        unique_tokens</span><span class="r20">.</span><span class="r18">update(doc_tokens)</span><span class="r14">                </span>  
 <span class="r10">   87 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> unique_tokens</span><span class="r14">                                </span>  
 <span class="r10">   88 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   89 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   90 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">is_list_of_list_of_type</span><span class="r18">(obj, type_</span><span class="r20">=</span><span class="r22">int</span><span class="r18">):</span><span class="r14">            </span>  
 <span class="r10">   91 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(obj, </span><span class="r22">list</span><span class="r18">):</span><span class="r14">                       </span>  
 <span class="r10">   92 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                                    </span>  
 <span class="r10">   93 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   94 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(obj) </span><span class="r20">==</span><span class="r18"> </span><span class="r20">0</span><span class="r18">:</span><span class="r14">                                   </span>  
 <span class="r10">   95 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                                    </span>  
 <span class="r10">   96 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   97 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    first_elem </span><span class="r20">=</span><span class="r18"> obj[</span><span class="r20">0</span><span class="r18">]</span><span class="r14">                                 </span>  
 <span class="r10">   98 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(first_elem, </span><span class="r22">list</span><span class="r18">):</span><span class="r14">                </span>  
 <span class="r10">   99 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                                    </span>  
 <span class="r10">  100 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  101 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(first_elem) </span><span class="r20">==</span><span class="r18"> </span><span class="r20">0</span><span class="r18">:</span><span class="r14">                            </span>  
 <span class="r10">  102 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                                    </span>  
 <span class="r10">  103 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  104 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    first_token </span><span class="r20">=</span><span class="r18"> first_elem[</span><span class="r20">0</span><span class="r18">]</span><span class="r14">                         </span>  
 <span class="r10">  105 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(first_token, type_):</span><span class="r14">              </span>  
 <span class="r10">  106 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                                    </span>  
 <span class="r10">  107 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  108 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> </span><span class="r15">True</span><span class="r14">                                         </span>  
 <span class="r10">  109 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  110 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  111 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_is_tuple_of_list_of_tokens</span><span class="r18">(obj):</span><span class="r14">                   </span>  
 <span class="r10">  112 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(obj, </span><span class="r22">tuple</span><span class="r18">):</span><span class="r14">                      </span>  
 <span class="r10">  113 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                                    </span>  
 <span class="r10">  114 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  115 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(obj) </span><span class="r20">==</span><span class="r18"> </span><span class="r20">0</span><span class="r18">:</span><span class="r14">                                   </span>  
 <span class="r10">  116 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                                    </span>  
 <span class="r10">  117 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  118 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    first_elem </span><span class="r20">=</span><span class="r18"> obj[</span><span class="r20">0</span><span class="r18">]</span><span class="r14">                                 </span>  
 <span class="r10">  119 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(first_elem, </span><span class="r22">list</span><span class="r18">):</span><span class="r14">                </span>  
 <span class="r10">  120 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                                    </span>  
 <span class="r10">  121 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  122 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(first_elem) </span><span class="r20">==</span><span class="r18"> </span><span class="r20">0</span><span class="r18">:</span><span class="r14">                            </span>  
 <span class="r10">  123 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                                    </span>  
 <span class="r10">  124 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  125 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    first_token </span><span class="r20">=</span><span class="r18"> first_elem[</span><span class="r20">0</span><span class="r18">]</span><span class="r14">                         </span>  
 <span class="r10">  126 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(first_token, </span><span class="r22">str</span><span class="r18">):</span><span class="r14">                </span>  
 <span class="r10">  127 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                                    </span>  
 <span class="r10">  128 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  129 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> </span><span class="r15">True</span><span class="r14">                                         </span>  
 <span class="r10">  130 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  131 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  132 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">class</span><span class="r16"> </span><span class="r17">BM25</span><span class="r18">:</span><span class="r14">                                             </span>  
 <span class="r10">  133 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">__init__</span><span class="r18">(</span><span class="r14">                                       </span>  
 <span class="r10">  134 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">,</span><span class="r14">                                           </span>  
 <span class="r10">  135 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        k1</span><span class="r20">=1.5</span><span class="r18">,</span><span class="r14">                                         </span>  
 <span class="r10">  136 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        b</span><span class="r20">=0.75</span><span class="r18">,</span><span class="r14">                                         </span>  
 <span class="r10">  137 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        delta</span><span class="r20">=0.5</span><span class="r18">,</span><span class="r14">                                      </span>  
 <span class="r10">  138 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        method</span><span class="r20">=</span><span class="r21">&quot;lucene&quot;</span><span class="r18">,</span><span class="r14">                                </span>  
 <span class="r10">  139 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        idf_method</span><span class="r20">=</span><span class="r15">None</span><span class="r18">,</span><span class="r14">                                </span>  
 <span class="r10">  140 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        dtype</span><span class="r20">=</span><span class="r21">&quot;float32&quot;</span><span class="r18">,</span><span class="r14">                                </span>  
 <span class="r10">  141 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        int_dtype</span><span class="r20">=</span><span class="r21">&quot;int32&quot;</span><span class="r18">,</span><span class="r14">                              </span>  
 <span class="r10">  142 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus</span><span class="r20">=</span><span class="r15">None</span><span class="r18">,</span><span class="r14">                                    </span>  
 <span class="r10">  143 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        backend</span><span class="r20">=</span><span class="r21">&quot;numpy&quot;</span><span class="r18">,</span><span class="r14">                                </span>  
 <span class="r10">  144 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">  145 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  146 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        BM25S initialization.</span><span class="r14">                           </span>  
 <span class="r10">  147 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  148 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  149 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  150 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        k1 : float</span><span class="r14">                                      </span>  
 <span class="r10">  151 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The k1 parameter in the BM25 formula.</span><span class="r14">       </span>  
 <span class="r10">  152 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  153 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        b : float</span><span class="r14">                                       </span>  
 <span class="r10">  154 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The b parameter in the BM25 formula.</span><span class="r14">        </span>  
 <span class="r10">  155 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  156 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        delta : float</span><span class="r14">                                   </span>  
 <span class="r10">  157 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The delta parameter in the BM25L and BM25+ f</span>  
 <span class="r10">  158 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  159 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        method : str</span><span class="r14">                                    </span>  
 <span class="r10">  160 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The method to use for scoring term frequency</span>  
 <span class="r10">  161 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  162 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        idf_method : str</span><span class="r14">                                </span>  
 <span class="r10">  163 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The method to use for scoring inverse docume</span>  
 <span class="r10">  164 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If None, it will use the same method as `met</span>  
 <span class="r10">  165 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            change this parameter.</span><span class="r14">                      </span>  
 <span class="r10">  166 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        dtype : str</span><span class="r14">                                     </span>  
 <span class="r10">  167 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The data type of the BM25 scores.</span><span class="r14">           </span>  
 <span class="r10">  168 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  169 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        int_dtype : str</span><span class="r14">                                 </span>  
 <span class="r10">  170 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The data type of the indices in the BM25 sco</span>  
 <span class="r10">  171 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  172 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        corpus : Iterable[Dict]</span><span class="r14">                         </span>  
 <span class="r10">  173 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The corpus of documents. This is optional an</span>  
 <span class="r10">  174 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            to the snapshot. We expect the corpus to be </span>  
 <span class="r10">  175 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            dictionary represents a document.</span><span class="r14">           </span>  
 <span class="r10">  176 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  177 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        backend : str</span><span class="r14">                                   </span>  
 <span class="r10">  178 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The backend used during retrieval. By defaul</span>  
 <span class="r10">  179 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            only requires numpy and scipy as dependencie</span>  
 <span class="r10">  180 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            to use the numba backend, which requires the</span>  
 <span class="r10">  181 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            the function will use the numba backend if i</span>  
 <span class="r10">  182 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            backend.</span><span class="r14">                                    </span>  
 <span class="r10">  183 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  184 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">k1 </span><span class="r20">=</span><span class="r18"> k1</span><span class="r14">                                    </span>  
 <span class="r10">  185 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">b </span><span class="r20">=</span><span class="r18"> b</span><span class="r14">                                      </span>  
 <span class="r10">  186 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">delta </span><span class="r20">=</span><span class="r18"> delta</span><span class="r14">                              </span>  
 <span class="r10">  187 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">dtype </span><span class="r20">=</span><span class="r18"> dtype</span><span class="r14">                              </span>  
 <span class="r10">  188 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">int_dtype </span><span class="r20">=</span><span class="r18"> int_dtype</span><span class="r14">                      </span>  
 <span class="r10">  189 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">method </span><span class="r20">=</span><span class="r18"> method</span><span class="r14">                            </span>  
 <span class="r10">  190 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">idf_method </span><span class="r20">=</span><span class="r18"> idf_method </span><span class="r15">if</span><span class="r18"> idf_method </span><span class="r23">is</span><span class="r18"> </span><span class="r23">no</span>  
 <span class="r10">  191 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">methods_requiring_nonoccurrence </span><span class="r20">=</span><span class="r18"> (</span><span class="r21">&quot;bm25l&quot;</span><span class="r18">,</span>  
 <span class="r10">  192 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">corpus </span><span class="r20">=</span><span class="r18"> corpus</span><span class="r14">                            </span>  
 <span class="r10">  193 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">_original_version </span><span class="r20">=</span><span class="r18"> __version__</span><span class="r14">            </span>  
 <span class="r10">  194 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  195 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> backend </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;auto&quot;</span><span class="r18">:</span><span class="r14">                           </span>  
 <span class="r10">  196 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">backend </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;numba&quot;</span><span class="r18"> </span><span class="r15">if</span><span class="r18"> selection_jit </span><span class="r23">is</span><span class="r18"> </span><span class="r23">n</span>  
 <span class="r10">  197 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  198 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">backend </span><span class="r20">=</span><span class="r18"> backend</span><span class="r14">                      </span>  
 <span class="r10">  199 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  200 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r32">@staticmethod</span><span class="r14">                                       </span>  
 <span class="r10">  201 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">_infer_corpus_object</span><span class="r18">(corpus):</span><span class="r14">                   </span>  
 <span class="r10">  202 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  203 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Verifies if the corpus is a list of list of stri</span>  
 <span class="r10">  204 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        or a tuple of two lists: first is list of list o</span>  
 <span class="r10">  205 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  206 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">hasattr</span><span class="r18">(corpus, </span><span class="r21">&quot;ids&quot;</span><span class="r18">) </span><span class="r23">and</span><span class="r18"> </span><span class="r22">hasattr</span><span class="r18">(corpus, </span><span class="r21">&quot;v</span>  
 <span class="r10">  207 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> </span><span class="r21">&quot;object&quot;</span><span class="r14">                             </span>  
 <span class="r10">  208 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">elif</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(corpus, </span><span class="r22">tuple</span><span class="r18">) </span><span class="r23">and</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(corpus) </span><span class="r20">=</span>  
 <span class="r10">  209 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            c1, c2 </span><span class="r20">=</span><span class="r18"> corpus</span><span class="r14">                             </span>  
 <span class="r10">  210 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(c1, </span><span class="r22">list</span><span class="r18">) </span><span class="r23">and</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(c2, </span><span class="r22">d</span>  
 <span class="r10">  211 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">return</span><span class="r18"> </span><span class="r21">&quot;tuple&quot;</span><span class="r14">                          </span>  
 <span class="r10">  212 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                       </span>  
 <span class="r10">  213 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                       </span>  
 <span class="r10">  214 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">&quot;Corpus must be a list of list of to</span>  
 <span class="r10">  215 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                )</span><span class="r14">                                       </span>  
 <span class="r10">  216 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">elif</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(corpus, Iterable):</span><span class="r14">              </span>  
 <span class="r10">  217 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> is_list_of_list_of_type(corpus, type_</span><span class="r20">=</span><span class="r22">int</span>  
 <span class="r10">  218 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">return</span><span class="r18"> </span><span class="r21">&quot;token_ids&quot;</span><span class="r14">                      </span>  
 <span class="r10">  219 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                       </span>  
 <span class="r10">  220 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">return</span><span class="r18"> </span><span class="r21">&quot;tokens&quot;</span><span class="r14">                         </span>  
 <span class="r10">  221 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  222 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                           </span>  
 <span class="r10">  223 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">&quot;Corpus must be a list of list of tokens</span>  
 <span class="r10">  224 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  225 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  226 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r32">@staticmethod</span><span class="r14">                                       </span>  
 <span class="r10">  227 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">_compute_relevance_from_scores</span><span class="r18">(</span><span class="r14">                 </span>  
 <span class="r10">  228 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        data: np</span><span class="r20">.</span><span class="r18">ndarray,</span><span class="r14">                               </span>  
 <span class="r10">  229 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indptr: np</span><span class="r20">.</span><span class="r18">ndarray,</span><span class="r14">                             </span>  
 <span class="r10">  230 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices: np</span><span class="r20">.</span><span class="r18">ndarray,</span><span class="r14">                            </span>  
 <span class="r10">  231 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        num_docs: </span><span class="r22">int</span><span class="r18">,</span><span class="r14">                                  </span>  
 <span class="r10">  232 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        query_tokens_ids: np</span><span class="r20">.</span><span class="r18">ndarray,</span><span class="r14">                   </span>  
 <span class="r10">  233 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        dtype: np</span><span class="r20">.</span><span class="r18">dtype,</span><span class="r14">                                </span>  
 <span class="r10">  234 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ) </span><span class="r20">-&gt;</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">ndarray:</span><span class="r14">                                    </span>  
 <span class="r10">  235 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  236 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        This internal static function calculates the rel</span>  
 <span class="r10">  237 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        by using the BM25 scores that have been precompu</span>  
 <span class="r10">  238 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        It is used by the `get_scores_from_ids` method, </span>  
 <span class="r10">  239 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        scores assigned as attributes of the BM25 object</span>  
 <span class="r10">  240 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  241 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  242 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  243 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        data (np.ndarray)</span><span class="r14">                               </span>  
 <span class="r10">  244 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Data array of the BM25 index.</span><span class="r14">               </span>  
 <span class="r10">  245 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        indptr (np.ndarray)</span><span class="r14">                             </span>  
 <span class="r10">  246 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Index pointer array of the BM25 index.</span><span class="r14">      </span>  
 <span class="r10">  247 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        indices (np.ndarray)</span><span class="r14">                            </span>  
 <span class="r10">  248 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Indices array of the BM25 index.</span><span class="r14">            </span>  
 <span class="r10">  249 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        num_docs (int)</span><span class="r14">                                  </span>  
 <span class="r10">  250 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Number of documents in the BM25 index.</span><span class="r14">      </span>  
 <span class="r10">  251 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        query_tokens_ids (np.ndarray)</span><span class="r14">                   </span>  
 <span class="r10">  252 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Array of token IDs to score.</span><span class="r14">                </span>  
 <span class="r10">  253 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        dtype (np.dtype)</span><span class="r14">                                </span>  
 <span class="r10">  254 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Data type for score calculation.</span><span class="r14">            </span>  
 <span class="r10">  255 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  256 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Returns</span><span class="r14">                                         </span>  
 <span class="r10">  257 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        -------</span><span class="r14">                                         </span>  
 <span class="r10">  258 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        np.ndarray</span><span class="r14">                                      </span>  
 <span class="r10">  259 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Array of BM25 relevance scores for a given q</span>  
 <span class="r10">  260 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  261 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Note</span><span class="r14">                                            </span>  
 <span class="r10">  262 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----</span><span class="r14">                                            </span>  
 <span class="r10">  263 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        This function was optimized by the baguetter lib</span>  
 <span class="r10">  264 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        https://github.com/mixedbread-ai/baguetter/blob/</span>  
 <span class="r10">  265 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  266 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indptr_starts </span><span class="r20">=</span><span class="r18"> indptr[query_tokens_ids]</span><span class="r14">        </span>  
 <span class="r10">  267 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indptr_ends </span><span class="r20">=</span><span class="r18"> indptr[query_tokens_ids </span><span class="r20">+</span><span class="r18"> </span><span class="r20">1</span><span class="r18">]</span><span class="r14">      </span>  
 <span class="r10">  268 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  269 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">zeros(num_docs, dtype</span><span class="r20">=</span><span class="r18">dtype)</span><span class="r14">        </span>  
 <span class="r10">  270 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> i </span><span class="r23">in</span><span class="r18"> </span><span class="r22">range</span><span class="r18">(</span><span class="r22">len</span><span class="r18">(query_tokens_ids)):</span><span class="r14">          </span>  
 <span class="r10">  271 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            start, end </span><span class="r20">=</span><span class="r18"> indptr_starts[i], indptr_ends[i</span>  
 <span class="r10">  272 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            np</span><span class="r20">.</span><span class="r18">add</span><span class="r20">.</span><span class="r18">at(scores, indices[start:end], data[s</span>  
 <span class="r10">  273 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  274 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># # The following code is slower with numpy,</span>  
 <span class="r10">  275 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># for j in range(start, end):</span><span class="r14">               </span>  
 <span class="r10">  276 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26">#     scores[indices[j]] += data[j]</span><span class="r14">         </span>  
 <span class="r10">  277 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  278 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> scores</span><span class="r14">                                   </span>  
 <span class="r10">  279 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  280 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">build_index_from_ids</span><span class="r18">(</span><span class="r14">                           </span>  
 <span class="r10">  281 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">,</span><span class="r14">                                           </span>  
 <span class="r10">  282 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        unique_token_ids: List[</span><span class="r22">int</span><span class="r18">],</span><span class="r14">                    </span>  
 <span class="r10">  283 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus_token_ids: List[List[</span><span class="r22">int</span><span class="r18">]],</span><span class="r14">              </span>  
 <span class="r10">  284 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        show_progress</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                             </span>  
 <span class="r10">  285 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        leave_progress</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                           </span>  
 <span class="r10">  286 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">  287 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  288 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Low-level function to build the BM25 index from </span>  
 <span class="r10">  289 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        as well as the `build_index_from_tokens` method.</span>  
 <span class="r10">  290 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        You can override this function if you want to bu</span>  
 <span class="r10">  291 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  292 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  293 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  294 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        unique_token_ids : List[int]</span><span class="r14">                    </span>  
 <span class="r10">  295 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            List of unique token IDs.</span><span class="r14">                   </span>  
 <span class="r10">  296 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  297 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        corpus_token_ids : List[List[int]]</span><span class="r14">              </span>  
 <span class="r10">  298 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            List of list of token IDs for each document.</span>  
 <span class="r10">  299 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  300 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        leave_progress : bool</span><span class="r14">                           </span>  
 <span class="r10">  301 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, the progress bars will remain after</span>  
 <span class="r10">  302 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  303 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   10M </span>│<span class="r1">▁              </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">import</span><span class="r16"> </span><span class="r17">scipy.sparse</span><span class="r16"> </span><span class="r15">as</span><span class="r16"> </span><span class="r17">sp</span><span class="r14">                       </span>  
 <span class="r10">  304 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  305 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">  93%   </span>│<span class="r1">  141M </span>│<span class="r1">▁▁▁▁▁▁▁▁       </span>│<span class="r12">     2 </span>│<span class="r18">        avg_doc_len </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">array([</span><span class="r22">len</span><span class="r18">(doc_ids) </span><span class="r15">for</span><span class="r18"> doc_ids</span>  
 <span class="r10">  306 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        n_docs </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(corpus_token_ids)</span><span class="r14">                  </span>  
 <span class="r10">  307 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        n_vocab </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(unique_token_ids)</span><span class="r14">                 </span>  
 <span class="r10">  308 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  309 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Step 1: Calculate the number of documents cont</span>  
 <span class="r10">  310 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        doc_frequencies </span><span class="r20">=</span><span class="r18"> _calculate_doc_freqs(</span><span class="r14">         </span>  
 <span class="r10">  311 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            corpus_tokens</span><span class="r20">=</span><span class="r18">corpus_token_ids,</span><span class="r14">             </span>  
 <span class="r10">  312 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            unique_tokens</span><span class="r20">=</span><span class="r18">unique_token_ids,</span><span class="r14">             </span>  
 <span class="r10">  313 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            show_progress</span><span class="r20">=</span><span class="r18">show_progress,</span><span class="r14">                </span>  
 <span class="r10">  314 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            leave_progress</span><span class="r20">=</span><span class="r18">leave_progress,</span><span class="r14">              </span>  
 <span class="r10">  315 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  316 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  317 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># preliminary: if the method is one of BM25L or </span>  
 <span class="r10">  318 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">method </span><span class="r23">in</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">methods_requiring_nonoccu</span>  
 <span class="r10">  319 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">nonoccurrence_array </span><span class="r20">=</span><span class="r18"> _build_nonoccurre</span>  
 <span class="r10">  320 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                doc_frequencies</span><span class="r20">=</span><span class="r18">doc_frequencies,</span><span class="r14">        </span>  
 <span class="r10">  321 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                n_docs</span><span class="r20">=</span><span class="r18">n_docs,</span><span class="r14">                          </span>  
 <span class="r10">  322 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                compute_idf_fn</span><span class="r20">=</span><span class="r18">_select_idf_scorer(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">i</span>  
 <span class="r10">  323 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                calculate_tfc_fn</span><span class="r20">=</span><span class="r18">_select_tfc_scorer(</span><span class="r22">self</span>  
 <span class="r10">  324 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                l_d</span><span class="r20">=</span><span class="r18">avg_doc_len,</span><span class="r14">                        </span>  
 <span class="r10">  325 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                l_avg</span><span class="r20">=</span><span class="r18">avg_doc_len,</span><span class="r14">                      </span>  
 <span class="r10">  326 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                k1</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">k1,</span><span class="r14">                             </span>  
 <span class="r10">  327 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                b</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">b,</span><span class="r14">                               </span>  
 <span class="r10">  328 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                delta</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">delta,</span><span class="r14">                       </span>  
 <span class="r10">  329 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                dtype</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">dtype,</span><span class="r14">                       </span>  
 <span class="r10">  330 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  331 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  332 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">nonoccurrence_array </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r14">             </span>  
 <span class="r10">  333 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  334 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Step 2: Calculate the idf for each token using</span>  
 <span class="r10">  335 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        idf_array </span><span class="r20">=</span><span class="r18"> _build_idf_array(</span><span class="r14">                   </span>  
 <span class="r10">  336 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            doc_frequencies</span><span class="r20">=</span><span class="r18">doc_frequencies,</span><span class="r14">            </span>  
 <span class="r10">  337 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            n_docs</span><span class="r20">=</span><span class="r18">n_docs,</span><span class="r14">                              </span>  
 <span class="r10">  338 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            compute_idf_fn</span><span class="r20">=</span><span class="r18">_select_idf_scorer(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">idf_m</span>  
 <span class="r10">  339 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            dtype</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">dtype,</span><span class="r14">                           </span>  
 <span class="r10">  340 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  341 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  342 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Step 3 Calculate the BM25 scores for each toke</span>  
 <span class="r10">  343 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores_flat, doc_idx, vocab_idx </span><span class="r20">=</span><span class="r18"> _build_scores_</span>  
 <span class="r10">  344 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            corpus_token_ids</span><span class="r20">=</span><span class="r18">corpus_token_ids,</span><span class="r14">          </span>  
 <span class="r10">  345 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            idf_array</span><span class="r20">=</span><span class="r18">idf_array,</span><span class="r14">                        </span>  
 <span class="r10">  346 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            avg_doc_len</span><span class="r20">=</span><span class="r18">avg_doc_len,</span><span class="r14">                    </span>  
 <span class="r10">  347 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            doc_frequencies</span><span class="r20">=</span><span class="r18">doc_frequencies,</span><span class="r14">            </span>  
 <span class="r10">  348 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            k1</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">k1,</span><span class="r14">                                 </span>  
 <span class="r10">  349 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            b</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">b,</span><span class="r14">                                   </span>  
 <span class="r10">  350 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            delta</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">delta,</span><span class="r14">                           </span>  
 <span class="r10">  351 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            show_progress</span><span class="r20">=</span><span class="r18">show_progress,</span><span class="r14">                </span>  
 <span class="r10">  352 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            leave_progress</span><span class="r20">=</span><span class="r18">leave_progress,</span><span class="r14">              </span>  
 <span class="r10">  353 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            dtype</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">dtype,</span><span class="r14">                           </span>  
 <span class="r10">  354 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            int_dtype</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">int_dtype,</span><span class="r14">                   </span>  
 <span class="r10">  355 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            method</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">method,</span><span class="r14">                         </span>  
 <span class="r10">  356 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            nonoccurrence_array</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">nonoccurrence_array</span>  
 <span class="r10">  357 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  358 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  359 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Now, we build the sparse matrix</span><span class="r14">               </span>  
 <span class="r10">  360 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">  43%   </span>│<span class="r1"> 1.92G </span>│<span class="r1">▁▁   8%        </span>│<span class="r12">       </span>│<span class="r18">        score_matrix </span><span class="r20">=</span><span class="r18"> sp</span><span class="r20">.</span><span class="r18">csc_matrix(</span><span class="r14">                   </span>  
 <span class="r10">  361 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            (scores_flat, (doc_idx, vocab_idx)),</span><span class="r14">        </span>  
 <span class="r10">  362 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            shape</span><span class="r20">=</span><span class="r18">(n_docs, n_vocab),</span><span class="r14">                    </span>  
 <span class="r10">  363 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            dtype</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">dtype,</span><span class="r14">                           </span>  
 <span class="r10">  364 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  365 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        data </span><span class="r20">=</span><span class="r18"> score_matrix</span><span class="r20">.</span><span class="r18">data</span><span class="r14">                        </span>  
 <span class="r10">  366 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices </span><span class="r20">=</span><span class="r18"> score_matrix</span><span class="r20">.</span><span class="r18">indices</span><span class="r14">                  </span>  
 <span class="r10">  367 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indptr </span><span class="r20">=</span><span class="r18"> score_matrix</span><span class="r20">.</span><span class="r18">indptr</span><span class="r14">                    </span>  
 <span class="r10">  368 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  369 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores </span><span class="r20">=</span><span class="r18"> {</span><span class="r14">                                      </span>  
 <span class="r10">  370 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;data&quot;</span><span class="r18">: data,</span><span class="r14">                               </span>  
 <span class="r10">  371 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;indices&quot;</span><span class="r18">: indices,</span><span class="r14">                         </span>  
 <span class="r10">  372 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;indptr&quot;</span><span class="r18">: indptr,</span><span class="r14">                           </span>  
 <span class="r10">  373 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;num_docs&quot;</span><span class="r18">: n_docs,</span><span class="r14">                         </span>  
 <span class="r10">  374 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        }</span><span class="r14">                                               </span>  
 <span class="r10">  375 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> scores</span><span class="r14">                                   </span>  
 <span class="r10">  376 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  377 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">build_index_from_tokens</span><span class="r18">(</span><span class="r14">                        </span>  
 <span class="r10">  378 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">, corpus_tokens, show_progress</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, leave_p</span>  
 <span class="r10">  379 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">  380 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  381 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Low-level function to build the BM25 index from </span>  
 <span class="r10">  382 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        You can override this function if you want to bu</span>  
 <span class="r10">  383 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  384 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        unique_tokens </span><span class="r20">=</span><span class="r18"> get_unique_tokens(</span><span class="r14">              </span>  
 <span class="r10">  385 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            corpus_tokens,</span><span class="r14">                              </span>  
 <span class="r10">  386 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            show_progress</span><span class="r20">=</span><span class="r18">show_progress,</span><span class="r14">                </span>  
 <span class="r10">  387 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            leave_progress</span><span class="r20">=</span><span class="r18">leave_progress,</span><span class="r14">              </span>  
 <span class="r10">  388 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            desc</span><span class="r20">=</span><span class="r21">&quot;BM25S Create Vocab&quot;</span><span class="r18">,</span><span class="r14">                  </span>  
 <span class="r10">  389 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  390 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        vocab_dict </span><span class="r20">=</span><span class="r18"> {token: i </span><span class="r15">for</span><span class="r18"> i, token </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span>  
 <span class="r10">  391 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        unique_token_ids </span><span class="r20">=</span><span class="r18"> [vocab_dict[token] </span><span class="r15">for</span><span class="r18"> token </span>  
 <span class="r10">  392 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  393 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus_token_ids </span><span class="r20">=</span><span class="r18"> [</span><span class="r14">                            </span>  
 <span class="r10">  394 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            [vocab_dict[token] </span><span class="r15">for</span><span class="r18"> token </span><span class="r23">in</span><span class="r18"> tokens]</span><span class="r14">     </span>  
 <span class="r10">  395 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">for</span><span class="r18"> tokens </span><span class="r23">in</span><span class="r18"> tqdm(</span><span class="r14">                         </span>  
 <span class="r10">  396 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                corpus_tokens,</span><span class="r14">                          </span>  
 <span class="r10">  397 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                desc</span><span class="r20">=</span><span class="r21">&quot;BM25S Convert tokens to indices&quot;</span><span class="r18">,</span><span class="r14"> </span>  
 <span class="r10">  398 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                leave</span><span class="r20">=</span><span class="r18">leave_progress,</span><span class="r14">                   </span>  
 <span class="r10">  399 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                disable</span><span class="r20">=</span><span class="r23">not</span><span class="r18"> show_progress,</span><span class="r14">              </span>  
 <span class="r10">  400 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  401 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        ]</span><span class="r14">                                               </span>  
 <span class="r10">  402 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  403 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">build_index_from_ids(</span><span class="r14">             </span>  
 <span class="r10">  404 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            unique_token_ids</span><span class="r20">=</span><span class="r18">unique_token_ids,</span><span class="r14">          </span>  
 <span class="r10">  405 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            corpus_token_ids</span><span class="r20">=</span><span class="r18">corpus_token_ids,</span><span class="r14">          </span>  
 <span class="r10">  406 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            show_progress</span><span class="r20">=</span><span class="r18">show_progress,</span><span class="r14">                </span>  
 <span class="r10">  407 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            leave_progress</span><span class="r20">=</span><span class="r18">leave_progress,</span><span class="r14">              </span>  
 <span class="r10">  408 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  409 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  410 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> scores, vocab_dict</span><span class="r14">                       </span>  
 <span class="r10">  411 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  412 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">index</span><span class="r18">(</span><span class="r14">                                          </span>  
 <span class="r10">  413 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">,</span><span class="r14">                                           </span>  
 <span class="r10">  414 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus: Union[Iterable, Tuple, tokenization</span><span class="r20">.</span><span class="r18">Toke</span>  
 <span class="r10">  415 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        create_empty_token</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                        </span>  
 <span class="r10">  416 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        show_progress</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                             </span>  
 <span class="r10">  417 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        leave_progress</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                           </span>  
 <span class="r10">  418 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">  419 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  420 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Given a `corpus` of documents, create the BM25 i</span>  
 <span class="r10">  421 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        - An iterable of documents, where each document </span>  
 <span class="r10">  422 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        - A tuple of two elements: the first is the list</span>  
 <span class="r10">  423 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        - An object with the `ids` and `vocab` attribute</span>  
 <span class="r10">  424 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  425 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Given a list of list of tokens, create the BM25 </span>  
 <span class="r10">  426 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  427 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        You can provide either the `corpus_tokens` or th</span>  
 <span class="r10">  428 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        you must also provide the `vocab_dict` dictionar</span>  
 <span class="r10">  429 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        dictionary will be created from the tokens, so y</span>  
 <span class="r10">  430 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  431 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        The `vocab_dict` dictionary is a mapping from to</span>  
 <span class="r10">  432 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        create the sparse matrix representation of the B</span>  
 <span class="r10">  433 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        tokens to their indices.</span><span class="r14">                        </span>  
 <span class="r10">  434 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  435 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  436 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  437 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        corpus : Iterable or Tuple or tokenization.Token</span>  
 <span class="r10">  438 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The corpus of documents. This can be either:</span>  
 <span class="r10">  439 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            - An iterable of documents, where each docum</span>  
 <span class="r10">  440 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            - A tuple of two elements: the first is the </span>  
 <span class="r10">  441 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            - An object with the `ids` and `vocab` attri</span>  
 <span class="r10">  442 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  443 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        create_empty_token : bool</span><span class="r14">                       </span>  
 <span class="r10">  444 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, it will create an empty token, &quot;&quot;, </span>  
 <span class="r10">  445 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            This is added at the end of the vocabulary a</span>  
 <span class="r10">  446 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If False, it will not create an empty token,</span>  
 <span class="r10">  447 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  448 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        show_progress : bool</span><span class="r14">                            </span>  
 <span class="r10">  449 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, a progress bar will be shown. If Fa</span>  
 <span class="r10">  450 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  451 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        leave_progress : bool</span><span class="r14">                           </span>  
 <span class="r10">  452 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, the progress bars will remain after</span>  
 <span class="r10">  453 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  454 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        inferred_corpus_obj </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">_infer_corpus_object(</span>  
 <span class="r10">  455 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  456 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> inferred_corpus_obj </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;tokens&quot;</span><span class="r18">:</span><span class="r14">             </span>  
 <span class="r10">  457 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            logger</span><span class="r20">.</span><span class="r18">debug(msg</span><span class="r20">=</span><span class="r21">&quot;Building index from tokens</span>  
 <span class="r10">  458 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            scores, vocab_dict </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">build_index_from_t</span>  
 <span class="r10">  459 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                corpus, leave_progress</span><span class="r20">=</span><span class="r18">leave_progress, s</span>  
 <span class="r10">  460 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  461 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  462 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> inferred_corpus_obj </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;tuple&quot;</span><span class="r18">:</span><span class="r14">          </span>  
 <span class="r10">  463 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                logger</span><span class="r20">.</span><span class="r18">debug(msg</span><span class="r20">=</span><span class="r21">&quot;Building index from ID</span>  
 <span class="r10">  464 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                corpus_token_ids, vocab_dict </span><span class="r20">=</span><span class="r18"> corpus</span><span class="r14">   </span>  
 <span class="r10">  465 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">elif</span><span class="r18"> inferred_corpus_obj </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;object&quot;</span><span class="r18">:</span><span class="r14">       </span>  
 <span class="r10">  466 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                logger</span><span class="r20">.</span><span class="r18">debug(msg</span><span class="r20">=</span><span class="r21">&quot;Building index from ID</span>  
 <span class="r10">  467 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                corpus_token_ids </span><span class="r20">=</span><span class="r18"> corpus</span><span class="r20">.</span><span class="r18">ids</span><span class="r14">           </span>  
 <span class="r10">  468 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                vocab_dict </span><span class="r20">=</span><span class="r18"> corpus</span><span class="r20">.</span><span class="r18">vocab</span><span class="r14">               </span>  
 <span class="r10">  469 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">elif</span><span class="r18"> inferred_corpus_obj </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;token_ids&quot;</span><span class="r18">:</span><span class="r14">    </span>  
 <span class="r10">  470 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r26"># we need to create a vocab_dict from th</span>  
 <span class="r10">  471 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                logger</span><span class="r20">.</span><span class="r18">debug(msg</span><span class="r20">=</span><span class="r21">&quot;Building index from to</span>  
 <span class="r10">  472 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                corpus_token_ids </span><span class="r20">=</span><span class="r18"> corpus</span><span class="r14">               </span>  
 <span class="r10">  473 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                unique_ids </span><span class="r20">=</span><span class="r18"> </span><span class="r22">set</span><span class="r18">()</span><span class="r14">                      </span>  
 <span class="r10">  474 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">for</span><span class="r18"> doc_ids </span><span class="r23">in</span><span class="r18"> corpus_token_ids:</span><span class="r14">        </span>  
 <span class="r10">  475 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    unique_ids</span><span class="r20">.</span><span class="r18">update(doc_ids)</span><span class="r14">          </span>  
 <span class="r10">  476 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r26"># if there&#x27;s allowed empty token, we nee</span>  
 <span class="r10">  477 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> create_empty_token:</span><span class="r14">                  </span>  
 <span class="r10">  478 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">if</span><span class="r18"> </span><span class="r20">0</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r23">in</span><span class="r18"> unique_ids:</span><span class="r14">             </span>  
 <span class="r10">  479 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        unique_ids</span><span class="r20">.</span><span class="r18">add(</span><span class="r20">0</span><span class="r18">)</span><span class="r14">               </span>  
 <span class="r10">  480 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                               </span>  
 <span class="r10">  481 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        unique_ids</span><span class="r20">.</span><span class="r18">add(</span><span class="r22">max</span><span class="r18">(unique_ids) </span><span class="r20">+</span>  
 <span class="r10">  482 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r14">                                        </span>  
 <span class="r10">  483 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r26"># create the vocab_dict from the unique </span>  
 <span class="r10">  484 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                vocab_dict </span><span class="r20">=</span><span class="r18"> {token_id: i </span><span class="r15">for</span><span class="r18"> i, token_i</span>  
 <span class="r10">  485 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r14">                                        </span>  
 <span class="r10">  486 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                       </span>  
 <span class="r10">  487 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                       </span>  
 <span class="r10">  488 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">&quot;Internal error: Found an invalid co</span>  
 <span class="r10">  489 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                )</span><span class="r14">                                       </span>  
 <span class="r10">  490 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  491 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   16M </span>│<span class="r1">▁              </span>│<span class="r12">       </span>│<span class="r18">            unique_token_ids </span><span class="r20">=</span><span class="r18"> </span><span class="r22">list</span><span class="r18">(vocab_dict</span><span class="r20">.</span><span class="r18">values())</span>  
 <span class="r10">  492 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            scores </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">build_index_from_ids(</span><span class="r14">         </span>  
 <span class="r10">  493 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                unique_token_ids</span><span class="r20">=</span><span class="r18">unique_token_ids,</span><span class="r14">      </span>  
 <span class="r10">  494 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                corpus_token_ids</span><span class="r20">=</span><span class="r18">corpus_token_ids,</span><span class="r14">      </span>  
 <span class="r10">  495 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                leave_progress</span><span class="r20">=</span><span class="r18">leave_progress,</span><span class="r14">          </span>  
 <span class="r10">  496 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                show_progress</span><span class="r20">=</span><span class="r18">show_progress,</span><span class="r14">            </span>  
 <span class="r10">  497 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  498 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  499 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> create_empty_token:</span><span class="r14">                          </span>  
 <span class="r10">  500 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> inferred_corpus_obj </span><span class="r20">!=</span><span class="r18"> </span><span class="r21">&quot;token_ids&quot;</span><span class="r18"> </span><span class="r23">and</span><span class="r18"> </span><span class="r21">&quot;&quot;</span>  
 <span class="r10">  501 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                vocab_dict[</span><span class="r21">&quot;&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r22">max</span><span class="r18">(vocab_dict</span><span class="r20">.</span><span class="r18">values()</span>  
 <span class="r10">  502 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  503 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores </span><span class="r20">=</span><span class="r18"> scores</span><span class="r14">                            </span>  
 <span class="r10">  504 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">vocab_dict </span><span class="r20">=</span><span class="r18"> vocab_dict</span><span class="r14">                    </span>  
 <span class="r10">  505 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  506 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># we create unique token IDs from the vocab_dict</span>  
 <span class="r10">  507 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   96M </span>│<span class="r1">▁▁▁▁▁▁         </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">unique_token_ids_set </span><span class="r20">=</span><span class="r18"> </span><span class="r22">set</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">vocab_dict</span><span class="r20">.</span>  
 <span class="r10">  508 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  509 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">get_tokens_ids</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, query_tokens: List[</span><span class="r22">str</span><span class="r18">]) </span><span class="r20">-&gt;</span>  
 <span class="r10">  510 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  511 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        For a given list of tokens, return the list of t</span>  
 <span class="r10">  512 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        that are not in the vocabulary.</span><span class="r14">                 </span>  
 <span class="r10">  513 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  514 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> [</span><span class="r14">                                        </span>  
 <span class="r10">  515 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">vocab_dict[token] </span><span class="r15">for</span><span class="r18"> token </span><span class="r23">in</span><span class="r18"> query_to</span>  
 <span class="r10">  516 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        ]</span><span class="r14">                                               </span>  
 <span class="r10">  517 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  518 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">get_scores_from_ids</span><span class="r18">(</span><span class="r14">                            </span>  
 <span class="r10">  519 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">, query_tokens_ids: List[</span><span class="r22">int</span><span class="r18">], weight_mask</span><span class="r20">=</span><span class="r15">N</span>  
 <span class="r10">  520 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ) </span><span class="r20">-&gt;</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">ndarray:</span><span class="r14">                                    </span>  
 <span class="r10">  521 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        data </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores[</span><span class="r21">&quot;data&quot;</span><span class="r18">]</span><span class="r14">                      </span>  
 <span class="r10">  522 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores[</span><span class="r21">&quot;indices&quot;</span><span class="r18">]</span><span class="r14">                </span>  
 <span class="r10">  523 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indptr </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores[</span><span class="r21">&quot;indptr&quot;</span><span class="r18">]</span><span class="r14">                  </span>  
 <span class="r10">  524 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        num_docs </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores[</span><span class="r21">&quot;num_docs&quot;</span><span class="r18">]</span><span class="r14">              </span>  
 <span class="r10">  525 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  526 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        dtype </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">dtype(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">dtype)</span><span class="r14">                    </span>  
 <span class="r10">  527 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        int_dtype </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">dtype(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">int_dtype)</span><span class="r14">            </span>  
 <span class="r10">  528 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        query_tokens_ids: np</span><span class="r20">.</span><span class="r18">ndarray </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">asarray(query_</span>  
 <span class="r10">  529 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  530 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        max_token_id </span><span class="r20">=</span><span class="r18"> </span><span class="r22">int</span><span class="r18">(query_tokens_ids</span><span class="r20">.</span><span class="r18">max(initial</span><span class="r20">=</span>  
 <span class="r10">  531 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  532 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> max_token_id </span><span class="r20">&gt;=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(indptr) </span><span class="r20">-</span><span class="r18"> </span><span class="r20">1</span><span class="r18">:</span><span class="r14">             </span>  
 <span class="r10">  533 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                           </span>  
 <span class="r10">  534 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">f&quot;The maximum token ID in the query (</span><span class="r25">{</span><span class="r18">ma</span>  
 <span class="r10">  535 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">&quot;This likely means that the query contai</span>  
 <span class="r10">  536 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  537 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  538 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">_compute_relevance_from_scores(</span><span class="r14">   </span>  
 <span class="r10">  539 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            data</span><span class="r20">=</span><span class="r18">data,</span><span class="r14">                                  </span>  
 <span class="r10">  540 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            indptr</span><span class="r20">=</span><span class="r18">indptr,</span><span class="r14">                              </span>  
 <span class="r10">  541 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            indices</span><span class="r20">=</span><span class="r18">indices,</span><span class="r14">                            </span>  
 <span class="r10">  542 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            num_docs</span><span class="r20">=</span><span class="r18">num_docs,</span><span class="r14">                          </span>  
 <span class="r10">  543 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            query_tokens_ids</span><span class="r20">=</span><span class="r18">query_tokens_ids,</span><span class="r14">          </span>  
 <span class="r10">  544 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            dtype</span><span class="r20">=</span><span class="r18">dtype,</span><span class="r14">                                </span>  
 <span class="r10">  545 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  546 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  547 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> weight_mask </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                     </span>  
 <span class="r10">  548 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># multiply the scores by the weight mask</span><span class="r14">    </span>  
 <span class="r10">  549 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            scores </span><span class="r20">*=</span><span class="r18"> weight_mask</span><span class="r14">                       </span>  
 <span class="r10">  550 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  551 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># if there&#x27;s a non-occurrence array, we need to </span>  
 <span class="r10">  552 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># back to the scores</span><span class="r14">                            </span>  
 <span class="r10">  553 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">nonoccurrence_array </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">        </span>  
 <span class="r10">  554 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            nonoccurrence_scores </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">nonoccurrence_ar</span>  
 <span class="r10">  555 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            scores </span><span class="r20">+=</span><span class="r18"> nonoccurrence_scores</span><span class="r14">              </span>  
 <span class="r10">  556 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  557 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> scores</span><span class="r14">                                   </span>  
 <span class="r10">  558 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  559 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">get_scores</span><span class="r18">(</span><span class="r14">                                     </span>  
 <span class="r10">  560 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">, query_tokens_single: List[</span><span class="r22">str</span><span class="r18">], weight_mas</span>  
 <span class="r10">  561 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ) </span><span class="r20">-&gt;</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">ndarray:</span><span class="r14">                                    </span>  
 <span class="r10">  562 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(query_tokens_single, </span><span class="r22">list</span><span class="r18">):</span><span class="r14">   </span>  
 <span class="r10">  563 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r21">&quot;The query_tokens must be a</span>  
 <span class="r10">  564 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  565 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(query_tokens_single[</span><span class="r20">0</span><span class="r18">], </span><span class="r22">str</span><span class="r18">):</span><span class="r14">     </span>  
 <span class="r10">  566 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            query_tokens_ids </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">get_tokens_ids(query</span>  
 <span class="r10">  567 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">elif</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(query_tokens_single[</span><span class="r20">0</span><span class="r18">], </span><span class="r22">int</span><span class="r18">):</span><span class="r14">   </span>  
 <span class="r10">  568 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># already are token IDs, no need to convert</span><span class="r14"> </span>  
 <span class="r10">  569 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            query_tokens_ids </span><span class="r20">=</span><span class="r18"> query_tokens_single</span><span class="r14">      </span>  
 <span class="r10">  570 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  571 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                           </span>  
 <span class="r10">  572 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">&quot;The query_tokens must be a list of toke</span>  
 <span class="r10">  573 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  574 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  575 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">get_scores_from_ids(query_tokens_ids</span>  
 <span class="r10">  576 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  577 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">_get_top_k_results</span><span class="r18">(</span><span class="r14">                             </span>  
 <span class="r10">  578 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">,</span><span class="r14">                                           </span>  
 <span class="r10">  579 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        query_tokens_single: List[</span><span class="r22">str</span><span class="r18">],</span><span class="r14">                 </span>  
 <span class="r10">  580 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        k: </span><span class="r22">int</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r20">1000</span><span class="r18">,</span><span class="r14">                                  </span>  
 <span class="r10">  581 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        backend</span><span class="r20">=</span><span class="r21">&quot;auto&quot;</span><span class="r18">,</span><span class="r14">                                 </span>  
 <span class="r10">  582 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">sorted</span><span class="r18">: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">False</span><span class="r18">,</span><span class="r14">                           </span>  
 <span class="r10">  583 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        weight_mask: np</span><span class="r20">.</span><span class="r18">ndarray </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r18">,</span><span class="r14">                 </span>  
 <span class="r10">  584 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">  585 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  586 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        This function is used to retrieve the top-k resu</span>  
 <span class="r10">  587 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Since it&#x27;s a hidden function, the user should no</span>  
 <span class="r10">  588 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        may change in the future. Please use the `retrie</span>  
 <span class="r10">  589 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  590 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(query_tokens_single) </span><span class="r20">==</span><span class="r18"> </span><span class="r20">0</span><span class="r18">:</span><span class="r14">               </span>  
 <span class="r10">  591 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            logger</span><span class="r20">.</span><span class="r18">info(</span><span class="r14">                                </span>  
 <span class="r10">  592 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                msg</span><span class="r20">=</span><span class="r21">&quot;The query is empty. This will resul</span>  
 <span class="r10">  593 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  594 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            scores_q </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">zeros(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores[</span><span class="r21">&quot;num_docs&quot;</span><span class="r18">],</span>  
 <span class="r10">  595 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  596 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            scores_q </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">get_scores(query_tokens_sing</span>  
 <span class="r10">  597 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  598 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> backend</span><span class="r20">.</span><span class="r18">startswith(</span><span class="r21">&quot;numba&quot;</span><span class="r18">):</span><span class="r14">                 </span>  
 <span class="r10">  599 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> selection_jit </span><span class="r23">is</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                   </span>  
 <span class="r10">  600 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">(</span><span class="r14">                      </span>  
 <span class="r10">  601 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">&quot;Numba is not installed. Please inst</span>  
 <span class="r10">  602 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                )</span><span class="r14">                                       </span>  
 <span class="r10">  603 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            topk_scores, topk_indices </span><span class="r20">=</span><span class="r18"> selection_jit</span><span class="r20">.</span><span class="r18">to</span>  
 <span class="r10">  604 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                scores_q, k</span><span class="r20">=</span><span class="r18">k, </span><span class="r22">sorted</span><span class="r20">=</span><span class="r22">sorted</span><span class="r18">, backend</span><span class="r20">=</span><span class="r18">ba</span>  
 <span class="r10">  605 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  606 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  607 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            topk_scores, topk_indices </span><span class="r20">=</span><span class="r18"> selection</span><span class="r20">.</span><span class="r18">topk(</span><span class="r14"> </span>  
 <span class="r10">  608 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                scores_q, k</span><span class="r20">=</span><span class="r18">k, </span><span class="r22">sorted</span><span class="r20">=</span><span class="r22">sorted</span><span class="r18">, backend</span><span class="r20">=</span><span class="r18">ba</span>  
 <span class="r10">  609 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  610 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  611 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> topk_scores, topk_indices</span><span class="r14">                </span>  
 <span class="r10">  612 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  613 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">retrieve</span><span class="r18">(</span><span class="r14">                                       </span>  
 <span class="r10">  614 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">,</span><span class="r14">                                           </span>  
 <span class="r10">  615 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        query_tokens: Union[List[List[</span><span class="r22">str</span><span class="r18">]], tokenizatio</span>  
 <span class="r10">  616 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus: List[Any] </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r18">,</span><span class="r14">                       </span>  
 <span class="r10">  617 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        k: </span><span class="r22">int</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r20">10</span><span class="r18">,</span><span class="r14">                                    </span>  
 <span class="r10">  618 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">sorted</span><span class="r18">: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r18">,</span><span class="r14">                            </span>  
 <span class="r10">  619 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        return_as: </span><span class="r22">str</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;tuple&quot;</span><span class="r18">,</span><span class="r14">                       </span>  
 <span class="r10">  620 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        show_progress: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r18">,</span><span class="r14">                     </span>  
 <span class="r10">  621 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        leave_progress: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">False</span><span class="r18">,</span><span class="r14">                   </span>  
 <span class="r10">  622 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        n_threads: </span><span class="r22">int</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r20">0</span><span class="r18">,</span><span class="r14">                             </span>  
 <span class="r10">  623 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        chunksize: </span><span class="r22">int</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r20">50</span><span class="r18">,</span><span class="r14">                            </span>  
 <span class="r10">  624 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        backend_selection: </span><span class="r22">str</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;auto&quot;</span><span class="r18">,</span><span class="r14">                </span>  
 <span class="r10">  625 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        weight_mask: np</span><span class="r20">.</span><span class="r18">ndarray </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r18">,</span><span class="r14">                 </span>  
 <span class="r10">  626 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">  627 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  628 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Retrieve the top-k documents for each query (tok</span>  
 <span class="r10">  629 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  630 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  631 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  632 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        query_tokens : List[List[str]] or bm25s.tokeniza</span>  
 <span class="r10">  633 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            List of list of tokens for each query. If a </span>  
 <span class="r10">  634 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            it will be converted to a list of list of to</span>  
 <span class="r10">  635 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  636 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        corpus : List[str] or np.ndarray</span><span class="r14">                </span>  
 <span class="r10">  637 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            List of &quot;documents&quot; or a numpy array of docu</span>  
 <span class="r10">  638 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            will return the documents instead of the ind</span>  
 <span class="r10">  639 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            the original documents (for example, you can</span>  
 <span class="r10">  640 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            documents here and then retrieve the actual </span>  
 <span class="r10">  641 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  642 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        k : int</span><span class="r14">                                         </span>  
 <span class="r10">  643 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Number of documents to retrieve for each que</span>  
 <span class="r10">  644 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  645 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        batch_size : int</span><span class="r14">                                </span>  
 <span class="r10">  646 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Number of queries to process in each batch. </span>  
 <span class="r10">  647 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            process the queries in batches to speed up t</span>  
 <span class="r10">  648 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  649 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        sorted : bool</span><span class="r14">                                   </span>  
 <span class="r10">  650 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, the function will sort the results </span>  
 <span class="r10">  651 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  652 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        return_as : str</span><span class="r14">                                 </span>  
 <span class="r10">  653 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If return_as=&quot;tuple&quot;, a named tuple with two</span>  
 <span class="r10">  654 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            `documents` and `scores`, which can be acces</span>  
 <span class="r10">  655 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            `result.scores`, or by unpacking, e.g. `docu</span>  
 <span class="r10">  656 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If return_as=&quot;documents&quot;, only the retrieved</span>  
 <span class="r10">  657 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            is not provided) will be returned.</span><span class="r14">          </span>  
 <span class="r10">  658 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  659 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        show_progress : bool</span><span class="r14">                            </span>  
 <span class="r10">  660 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, a progress bar will be shown. If Fa</span>  
 <span class="r10">  661 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  662 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        leave_progress : bool</span><span class="r14">                           </span>  
 <span class="r10">  663 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, the progress bars will remain after</span>  
 <span class="r10">  664 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  665 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        n_threads : int</span><span class="r14">                                 </span>  
 <span class="r10">  666 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Number of jobs to run in parallel. If -1, it</span>  
 <span class="r10">  667 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If 0, it will run the jobs sequentially, wit</span>  
 <span class="r10">  668 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  669 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        chunksize : int</span><span class="r14">                                 </span>  
 <span class="r10">  670 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Number of batches to process in each job in </span>  
 <span class="r10">  671 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  672 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        backend_selection : str</span><span class="r14">                         </span>  
 <span class="r10">  673 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The backend to use for the top-k retrieval. </span>  
 <span class="r10">  674 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If &quot;auto&quot;, it will use JAX if it is availabl</span>  
 <span class="r10">  675 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  676 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        weight_mask : np.ndarray</span><span class="r14">                        </span>  
 <span class="r10">  677 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            A weight mask to filter the documents. If pr</span>  
 <span class="r10">  678 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            documents will be set to 0 to avoid returnin</span>  
 <span class="r10">  679 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  680 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Returns</span><span class="r14">                                         </span>  
 <span class="r10">  681 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        -------</span><span class="r14">                                         </span>  
 <span class="r10">  682 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Results or np.ndarray</span><span class="r14">                           </span>  
 <span class="r10">  683 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If `return_as=&quot;tuple&quot;`, a named tuple with t</span>  
 <span class="r10">  684 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If `return_as=&quot;documents&quot;`, only the retriev</span>  
 <span class="r10">  685 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  686 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Raises</span><span class="r14">                                          </span>  
 <span class="r10">  687 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ------</span><span class="r14">                                          </span>  
 <span class="r10">  688 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ValueError</span><span class="r14">                                      </span>  
 <span class="r10">  689 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If the `query_tokens` is not a list of list </span>  
 <span class="r10">  690 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  691 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ImportError</span><span class="r14">                                     </span>  
 <span class="r10">  692 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If the numba backend is selected but numba i</span>  
 <span class="r10">  693 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  694 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        num_docs </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores[</span><span class="r21">&quot;num_docs&quot;</span><span class="r18">]</span><span class="r14">              </span>  
 <span class="r10">  695 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> k </span><span class="r20">&gt;</span><span class="r18"> num_docs:</span><span class="r14">                                </span>  
 <span class="r10">  696 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                           </span>  
 <span class="r10">  697 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">f&quot;k of </span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21"> is larger than the number of </span>  
 <span class="r10">  698 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">f&quot;, which is </span><span class="r25">{</span><span class="r18">num_docs</span><span class="r25">}</span><span class="r21"> (corpus size sho</span>  
 <span class="r10">  699 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">f&quot; Please set with a smaller k or increa</span>  
 <span class="r10">  700 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  701 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        allowed_return_as </span><span class="r20">=</span><span class="r18"> [</span><span class="r21">&quot;tuple&quot;</span><span class="r18">, </span><span class="r21">&quot;documents&quot;</span><span class="r18">]</span><span class="r14">      </span>  
 <span class="r10">  702 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  703 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> return_as </span><span class="r23">not</span><span class="r18"> </span><span class="r23">in</span><span class="r18"> allowed_return_as:</span><span class="r14">          </span>  
 <span class="r10">  704 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r21">&quot;`return_as` must be either</span>  
 <span class="r10">  705 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  706 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">pass</span><span class="r14">                                        </span>  
 <span class="r10">  707 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  708 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> n_threads </span><span class="r20">==</span><span class="r18"> </span><span class="r20">-1</span><span class="r18">:</span><span class="r14">                             </span>  
 <span class="r10">  709 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            n_threads </span><span class="r20">=</span><span class="r18"> os</span><span class="r20">.</span><span class="r18">cpu_count()</span><span class="r14">                  </span>  
 <span class="r10">  710 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  711 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># if it&#x27;s a list of list of tokens ids (int), we</span>  
 <span class="r10">  712 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> is_list_of_list_of_type(query_tokens, type_</span><span class="r20">=</span><span class="r22">i</span>  
 <span class="r10">  713 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">hasattr</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, </span><span class="r21">&quot;unique_token_ids_set&quot;</span><span class="r18">)</span>  
 <span class="r10">  714 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                       </span>  
 <span class="r10">  715 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">&quot;The unique_token_ids_set attribute </span>  
 <span class="r10">  716 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">&quot;run retriever.load(load_vocab=True)</span>  
 <span class="r10">  717 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                )</span><span class="r14">                                       </span>  
 <span class="r10">  718 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            query_tokens_filtered </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                  </span>  
 <span class="r10">  719 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">for</span><span class="r18"> query </span><span class="r23">in</span><span class="r18"> query_tokens:</span><span class="r14">                  </span>  
 <span class="r10">  720 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                query_filtered </span><span class="r20">=</span><span class="r18"> [</span><span class="r14">                      </span>  
 <span class="r10">  721 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    token_id</span><span class="r14">                            </span>  
 <span class="r10">  722 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">for</span><span class="r18"> token_id </span><span class="r23">in</span><span class="r18"> query</span><span class="r14">               </span>  
 <span class="r10">  723 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">if</span><span class="r18"> token_id </span><span class="r23">in</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">unique_token_ids</span>  
 <span class="r10">  724 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                ]</span><span class="r14">                                       </span>  
 <span class="r10">  725 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(query_filtered) </span><span class="r20">==</span><span class="r18"> </span><span class="r20">0</span><span class="r18">:</span><span class="r14">            </span>  
 <span class="r10">  726 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">if</span><span class="r18"> </span><span class="r21">&quot;&quot;</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r23">in</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">vocab_dict:</span><span class="r14">       </span>  
 <span class="r10">  727 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">               </span>  
 <span class="r10">  728 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                            </span><span class="r21">&quot;The query does not contain </span>  
 <span class="r10">  729 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                            </span><span class="r21">&quot;Please provide a query that</span>  
 <span class="r10">  730 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                            </span><span class="r21">&quot;Alternatively, you can set </span>  
 <span class="r10">  731 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                            </span><span class="r21">&quot;You can also manually add a</span>  
 <span class="r10">  732 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                            </span><span class="r21">&quot;Then, run `retriever.unique</span>  
 <span class="r10">  733 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        )</span><span class="r14">                               </span>  
 <span class="r10">  734 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    query_filtered </span><span class="r20">=</span><span class="r18"> [</span><span class="r22">self</span><span class="r20">.</span><span class="r18">vocab_dict[</span><span class="r21">&quot;&quot;</span>  
 <span class="r10">  735 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  736 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                query_tokens_filtered</span><span class="r20">.</span><span class="r18">append(query_filte</span>  
 <span class="r10">  737 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  738 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            query_tokens </span><span class="r20">=</span><span class="r18"> query_tokens_filtered</span><span class="r14">        </span>  
 <span class="r10">  739 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  740 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(query_tokens, </span><span class="r22">tuple</span><span class="r18">) </span><span class="r23">and</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> _is_t</span>  
 <span class="r10">  741 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            query_tokens</span><span class="r14">                                </span>  
 <span class="r10">  742 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        ):</span><span class="r14">                                              </span>  
 <span class="r10">  743 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(query_tokens) </span><span class="r20">!=</span><span class="r18"> </span><span class="r20">2</span><span class="r18">:</span><span class="r14">                  </span>  
 <span class="r10">  744 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                msg </span><span class="r20">=</span><span class="r18"> (</span><span class="r14">                                 </span>  
 <span class="r10">  745 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">&quot;Expected a list of string or a tupl</span>  
 <span class="r10">  746 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">&quot;list of unique token IDs, &quot;</span><span class="r14">        </span>  
 <span class="r10">  747 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">&quot;and the second element is the list </span>  
 <span class="r10">  748 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">f&quot;Found </span><span class="r25">{</span><span class="r22">len</span><span class="r18">(query_tokens)</span><span class="r25">}</span><span class="r21"> elements</span>  
 <span class="r10">  749 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                )</span><span class="r14">                                       </span>  
 <span class="r10">  750 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(msg)</span><span class="r14">                   </span>  
 <span class="r10">  751 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                       </span>  
 <span class="r10">  752 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                ids, vocab </span><span class="r20">=</span><span class="r18"> query_tokens</span><span class="r14">               </span>  
 <span class="r10">  753 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(ids, Iterable):</span><span class="r14">       </span>  
 <span class="r10">  754 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                   </span>  
 <span class="r10">  755 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r21">&quot;The first element of the tuple </span>  
 <span class="r10">  756 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    )</span><span class="r14">                                   </span>  
 <span class="r10">  757 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(vocab, </span><span class="r22">dict</span><span class="r18">):</span><span class="r14">         </span>  
 <span class="r10">  758 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                   </span>  
 <span class="r10">  759 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r21">&quot;The second element of the tuple</span>  
 <span class="r10">  760 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    )</span><span class="r14">                                   </span>  
 <span class="r10">  761 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                query_tokens </span><span class="r20">=</span><span class="r18"> tokenization</span><span class="r20">.</span><span class="r18">Tokenized(id</span>  
 <span class="r10">  762 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  763 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(query_tokens, tokenization</span><span class="r20">.</span><span class="r18">Tokeniz</span>  
 <span class="r10">  764 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            query_tokens </span><span class="r20">=</span><span class="r18"> tokenization</span><span class="r20">.</span><span class="r18">convert_tokenize</span>  
 <span class="r10">  765 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  766 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus </span><span class="r20">=</span><span class="r18"> corpus </span><span class="r15">if</span><span class="r18"> corpus </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18"> </span><span class="r15">else</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span>  
 <span class="r10">  767 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  768 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> weight_mask </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                     </span>  
 <span class="r10">  769 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(weight_mask, np</span><span class="r20">.</span><span class="r18">ndarray):</span><span class="r14"> </span>  
 <span class="r10">  770 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r21">&quot;weight_mask must be a </span>  
 <span class="r10">  771 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  772 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># check if weight_mask is a 1D array, if not</span>  
 <span class="r10">  773 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> weight_mask</span><span class="r20">.</span><span class="r18">ndim </span><span class="r20">!=</span><span class="r18"> </span><span class="r20">1</span><span class="r18">:</span><span class="r14">                   </span>  
 <span class="r10">  774 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r21">&quot;weight_mask must be a </span>  
 <span class="r10">  775 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  776 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># check if the length of the weight_mask is </span>  
 <span class="r10">  777 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(weight_mask) </span><span class="r20">!=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores[</span><span class="r21">&quot;num_docs</span>  
 <span class="r10">  778 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                       </span>  
 <span class="r10">  779 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">&quot;The length of the weight_mask must </span>  
 <span class="r10">  780 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                )</span><span class="r14">                                       </span>  
 <span class="r10">  781 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  782 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">backend </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;numba&quot;</span><span class="r18">:</span><span class="r14">                     </span>  
 <span class="r10">  783 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> _retrieve_numba_functional </span><span class="r23">is</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">      </span>  
 <span class="r10">  784 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">(</span><span class="r14">                      </span>  
 <span class="r10">  785 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">&quot;Numba is not installed. Please inst</span>  
 <span class="r10">  786 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                )</span><span class="r14">                                       </span>  
 <span class="r10">  787 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  788 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            backend_selection </span><span class="r20">=</span><span class="r18"> (</span><span class="r14">                       </span>  
 <span class="r10">  789 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">&quot;numba&quot;</span><span class="r18"> </span><span class="r15">if</span><span class="r18"> backend_selection </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;auto&quot;</span><span class="r18"> </span><span class="r15">e</span>  
 <span class="r10">  790 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  791 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># if is list of list of int</span><span class="r14">                 </span>  
 <span class="r10">  792 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> is_list_of_list_of_type(query_tokens, typ</span>  
 <span class="r10">  793 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                query_tokens_ids </span><span class="r20">=</span><span class="r18"> query_tokens</span><span class="r14">         </span>  
 <span class="r10">  794 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">elif</span><span class="r18"> is_list_of_list_of_type(query_tokens, t</span>  
 <span class="r10">  795 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                query_tokens_ids </span><span class="r20">=</span><span class="r18"> [</span><span class="r22">self</span><span class="r20">.</span><span class="r18">get_tokens_ids(</span>  
 <span class="r10">  796 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                       </span>  
 <span class="r10">  797 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                       </span>  
 <span class="r10">  798 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r21">&quot;The query_tokens must be a list of </span>  
 <span class="r10">  799 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                )</span><span class="r14">                                       </span>  
 <span class="r10">  800 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  801 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            res </span><span class="r20">=</span><span class="r18"> _retrieve_numba_functional(</span><span class="r14">           </span>  
 <span class="r10">  802 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                query_tokens_ids</span><span class="r20">=</span><span class="r18">query_tokens_ids,</span><span class="r14">      </span>  
 <span class="r10">  803 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                scores</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores,</span><span class="r14">                     </span>  
 <span class="r10">  804 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                corpus</span><span class="r20">=</span><span class="r18">corpus,</span><span class="r14">                          </span>  
 <span class="r10">  805 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                k</span><span class="r20">=</span><span class="r18">k,</span><span class="r14">                                    </span>  
 <span class="r10">  806 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r22">sorted</span><span class="r20">=</span><span class="r22">sorted</span><span class="r18">,</span><span class="r14">                          </span>  
 <span class="r10">  807 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                return_as</span><span class="r20">=</span><span class="r18">return_as,</span><span class="r14">                    </span>  
 <span class="r10">  808 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                show_progress</span><span class="r20">=</span><span class="r18">show_progress,</span><span class="r14">            </span>  
 <span class="r10">  809 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                leave_progress</span><span class="r20">=</span><span class="r18">leave_progress,</span><span class="r14">          </span>  
 <span class="r10">  810 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                n_threads</span><span class="r20">=</span><span class="r18">n_threads,</span><span class="r14">                    </span>  
 <span class="r10">  811 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                chunksize</span><span class="r20">=</span><span class="r15">None</span><span class="r18">,  </span><span class="r26"># chunksize is ignored </span>  
 <span class="r10">  812 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                backend_selection</span><span class="r20">=</span><span class="r18">backend_selection,  </span><span class="r26"># </span>  
 <span class="r10">  813 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                dtype</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">dtype,</span><span class="r14">                       </span>  
 <span class="r10">  814 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                int_dtype</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">int_dtype,</span><span class="r14">               </span>  
 <span class="r10">  815 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                nonoccurrence_array</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">nonoccurrence_a</span>  
 <span class="r10">  816 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                weight_mask</span><span class="r20">=</span><span class="r18">weight_mask,</span><span class="r14">                </span>  
 <span class="r10">  817 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  818 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  819 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> return_as </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;tuple&quot;</span><span class="r18">:</span><span class="r14">                    </span>  
 <span class="r10">  820 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">return</span><span class="r18"> Results(documents</span><span class="r20">=</span><span class="r18">res[</span><span class="r20">0</span><span class="r18">], scores</span><span class="r20">=</span>  
 <span class="r10">  821 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                       </span>  
 <span class="r10">  822 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">return</span><span class="r18"> res</span><span class="r14">                              </span>  
 <span class="r10">  823 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  824 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        tqdm_kwargs </span><span class="r20">=</span><span class="r18"> {</span><span class="r14">                                 </span>  
 <span class="r10">  825 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;total&quot;</span><span class="r18">: </span><span class="r22">len</span><span class="r18">(query_tokens),</span><span class="r14">                 </span>  
 <span class="r10">  826 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;desc&quot;</span><span class="r18">: </span><span class="r21">&quot;BM25S Retrieve&quot;</span><span class="r18">,</span><span class="r14">                   </span>  
 <span class="r10">  827 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;leave&quot;</span><span class="r18">: leave_progress,</span><span class="r14">                    </span>  
 <span class="r10">  828 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;disable&quot;</span><span class="r18">: </span><span class="r23">not</span><span class="r18"> show_progress,</span><span class="r14">               </span>  
 <span class="r10">  829 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        }</span><span class="r14">                                               </span>  
 <span class="r10">  830 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        topk_fn </span><span class="r20">=</span><span class="r18"> partial(</span><span class="r14">                              </span>  
 <span class="r10">  831 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">_get_top_k_results,</span><span class="r14">                    </span>  
 <span class="r10">  832 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            k</span><span class="r20">=</span><span class="r18">k,</span><span class="r14">                                        </span>  
 <span class="r10">  833 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">sorted</span><span class="r20">=</span><span class="r22">sorted</span><span class="r18">,</span><span class="r14">                              </span>  
 <span class="r10">  834 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            backend</span><span class="r20">=</span><span class="r18">backend_selection,</span><span class="r14">                  </span>  
 <span class="r10">  835 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            weight_mask</span><span class="r20">=</span><span class="r18">weight_mask,</span><span class="r14">                    </span>  
 <span class="r10">  836 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  837 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  838 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> n_threads </span><span class="r20">==</span><span class="r18"> </span><span class="r20">0</span><span class="r18">:</span><span class="r14">                              </span>  
 <span class="r10">  839 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># Use a simple map function to retrieve the </span>  
 <span class="r10">  840 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            out </span><span class="r20">=</span><span class="r18"> tqdm(</span><span class="r22">map</span><span class="r18">(topk_fn, query_tokens), </span><span class="r20">**</span><span class="r18">tqd</span>  
 <span class="r10">  841 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  842 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># Use concurrent.futures.ProcessPoolExecutor</span>  
 <span class="r10">  843 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">with</span><span class="r18"> ThreadPoolExecutor(max_workers</span><span class="r20">=</span><span class="r18">n_thread</span>  
 <span class="r10">  844 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                process_map </span><span class="r20">=</span><span class="r18"> executor</span><span class="r20">.</span><span class="r18">map(</span><span class="r14">             </span>  
 <span class="r10">  845 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    topk_fn,</span><span class="r14">                            </span>  
 <span class="r10">  846 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    query_tokens,</span><span class="r14">                       </span>  
 <span class="r10">  847 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    chunksize</span><span class="r20">=</span><span class="r18">chunksize,</span><span class="r14">                </span>  
 <span class="r10">  848 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                )</span><span class="r14">                                       </span>  
 <span class="r10">  849 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                out </span><span class="r20">=</span><span class="r18"> </span><span class="r22">list</span><span class="r18">(tqdm(process_map, </span><span class="r20">**</span><span class="r18">tqdm_kwar</span>  
 <span class="r10">  850 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  851 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores, indices </span><span class="r20">=</span><span class="r18"> </span><span class="r22">zip</span><span class="r18">(</span><span class="r20">*</span><span class="r18">out)</span><span class="r14">                     </span>  
 <span class="r10">  852 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores, indices </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">array(scores), np</span><span class="r20">.</span><span class="r18">array(ind</span>  
 <span class="r10">  853 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  854 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus </span><span class="r20">=</span><span class="r18"> corpus </span><span class="r15">if</span><span class="r18"> corpus </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18"> </span><span class="r15">else</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span>  
 <span class="r10">  855 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  856 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> corpus </span><span class="r23">is</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                              </span>  
 <span class="r10">  857 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            retrieved_docs </span><span class="r20">=</span><span class="r18"> indices</span><span class="r14">                    </span>  
 <span class="r10">  858 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  859 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># if it is a JsonlCorpus object, we do not n</span>  
 <span class="r10">  860 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(corpus, utils</span><span class="r20">.</span><span class="r18">corpus</span><span class="r20">.</span><span class="r18">JsonlCorp</span>  
 <span class="r10">  861 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                retrieved_docs </span><span class="r20">=</span><span class="r18"> corpus[indices]</span><span class="r14">        </span>  
 <span class="r10">  862 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">elif</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(corpus, np</span><span class="r20">.</span><span class="r18">ndarray) </span><span class="r23">and</span><span class="r18"> corp</span>  
 <span class="r10">  863 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                retrieved_docs </span><span class="r20">=</span><span class="r18"> corpus[indices]</span><span class="r14">        </span>  
 <span class="r10">  864 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                       </span>  
 <span class="r10">  865 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                index_flat </span><span class="r20">=</span><span class="r18"> indices</span><span class="r20">.</span><span class="r18">flatten()</span><span class="r20">.</span><span class="r18">tolist()</span><span class="r14"> </span>  
 <span class="r10">  866 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                results </span><span class="r20">=</span><span class="r18"> [corpus[i] </span><span class="r15">for</span><span class="r18"> i </span><span class="r23">in</span><span class="r18"> index_flat</span>  
 <span class="r10">  867 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                retrieved_docs </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">array(results)</span><span class="r20">.</span><span class="r18">resha</span>  
 <span class="r10">  868 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  869 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> return_as </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;tuple&quot;</span><span class="r18">:</span><span class="r14">                        </span>  
 <span class="r10">  870 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> Results(documents</span><span class="r20">=</span><span class="r18">retrieved_docs, sco</span>  
 <span class="r10">  871 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">elif</span><span class="r18"> return_as </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;documents&quot;</span><span class="r18">:</span><span class="r14">                  </span>  
 <span class="r10">  872 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> retrieved_docs</span><span class="r14">                       </span>  
 <span class="r10">  873 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  874 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r21">&quot;`return_as` must be either</span>  
 <span class="r10">  875 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  876 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">save</span><span class="r18">(</span><span class="r14">                                           </span>  
 <span class="r10">  877 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">,</span><span class="r14">                                           </span>  
 <span class="r10">  878 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir,</span><span class="r14">                                       </span>  
 <span class="r10">  879 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus</span><span class="r20">=</span><span class="r15">None</span><span class="r18">,</span><span class="r14">                                    </span>  
 <span class="r10">  880 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        data_name</span><span class="r20">=</span><span class="r21">&quot;data.csc.index.npy&quot;</span><span class="r18">,</span><span class="r14">                 </span>  
 <span class="r10">  881 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices_name</span><span class="r20">=</span><span class="r21">&quot;indices.csc.index.npy&quot;</span><span class="r18">,</span><span class="r14">           </span>  
 <span class="r10">  882 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indptr_name</span><span class="r20">=</span><span class="r21">&quot;indptr.csc.index.npy&quot;</span><span class="r18">,</span><span class="r14">             </span>  
 <span class="r10">  883 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        vocab_name</span><span class="r20">=</span><span class="r21">&quot;vocab.index.json&quot;</span><span class="r18">,</span><span class="r14">                  </span>  
 <span class="r10">  884 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        params_name</span><span class="r20">=</span><span class="r21">&quot;params.index.json&quot;</span><span class="r18">,</span><span class="r14">                </span>  
 <span class="r10">  885 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        nnoc_name</span><span class="r20">=</span><span class="r21">&quot;nonoccurrence_array.index.npy&quot;</span><span class="r18">,</span><span class="r14">      </span>  
 <span class="r10">  886 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus_name</span><span class="r20">=</span><span class="r21">&quot;corpus.jsonl&quot;</span><span class="r18">,</span><span class="r14">                     </span>  
 <span class="r10">  887 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        allow_pickle</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                             </span>  
 <span class="r10">  888 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">  889 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  890 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Save the BM25S index to the `save_dir` directory</span>  
 <span class="r10">  891 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        the indices array, the indptr array, the vocab d</span>  
 <span class="r10">  892 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  893 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  894 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  895 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        save_dir : str</span><span class="r14">                                  </span>  
 <span class="r10">  896 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The directory where the BM25S index will be </span>  
 <span class="r10">  897 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  898 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        corpus : List[Dict]</span><span class="r14">                             </span>  
 <span class="r10">  899 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The corpus of documents. If provided, it wil</span>  
 <span class="r10">  900 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  901 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        corpus_name : str</span><span class="r14">                               </span>  
 <span class="r10">  902 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that will contain the c</span>  
 <span class="r10">  903 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  904 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        data_name : str</span><span class="r14">                                 </span>  
 <span class="r10">  905 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that will contain the d</span>  
 <span class="r10">  906 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  907 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        indices_name : str</span><span class="r14">                              </span>  
 <span class="r10">  908 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that will contain the i</span>  
 <span class="r10">  909 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  910 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        indptr_name : str</span><span class="r14">                               </span>  
 <span class="r10">  911 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that will contain the i</span>  
 <span class="r10">  912 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  913 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        vocab_name : str</span><span class="r14">                                </span>  
 <span class="r10">  914 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that will contain the v</span>  
 <span class="r10">  915 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  916 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        params_name : str</span><span class="r14">                               </span>  
 <span class="r10">  917 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that will contain the p</span>  
 <span class="r10">  918 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  919 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        nnoc_name : str</span><span class="r14">                                 </span>  
 <span class="r10">  920 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that will contain the n</span>  
 <span class="r10">  921 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  922 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        allow_pickle : bool</span><span class="r14">                             </span>  
 <span class="r10">  923 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, the arrays will be saved using pick</span>  
 <span class="r10">  924 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            in a more efficient format, but they will no</span>  
 <span class="r10">  925 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  926 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Save the self.vocab_dict and self.score_matrix</span>  
 <span class="r10">  927 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir </span><span class="r20">=</span><span class="r18"> Path(save_dir)</span><span class="r14">                       </span>  
 <span class="r10">  928 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir</span><span class="r20">.</span><span class="r18">mkdir(parents</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, exist_ok</span><span class="r20">=</span><span class="r15">True</span><span class="r18">)</span><span class="r14">     </span>  
 <span class="r10">  929 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  930 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Save the scores arrays</span><span class="r14">                        </span>  
 <span class="r10">  931 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        data_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> data_name</span><span class="r14">                </span>  
 <span class="r10">  932 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> indices_name</span><span class="r14">          </span>  
 <span class="r10">  933 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indptr_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> indptr_name</span><span class="r14">            </span>  
 <span class="r10">  934 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  935 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        np</span><span class="r20">.</span><span class="r18">save(data_path, </span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores[</span><span class="r21">&quot;data&quot;</span><span class="r18">], allow_pi</span>  
 <span class="r10">  936 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        np</span><span class="r20">.</span><span class="r18">save(indices_path, </span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores[</span><span class="r21">&quot;indices&quot;</span><span class="r18">], al</span>  
 <span class="r10">  937 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        np</span><span class="r20">.</span><span class="r18">save(indptr_path, </span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores[</span><span class="r21">&quot;indptr&quot;</span><span class="r18">], allo</span>  
 <span class="r10">  938 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  939 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># save nonoccurrence array if it exists</span><span class="r14">         </span>  
 <span class="r10">  940 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">nonoccurrence_array </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">        </span>  
 <span class="r10">  941 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            nnm_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> nnoc_name</span><span class="r14">             </span>  
 <span class="r10">  942 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            np</span><span class="r20">.</span><span class="r18">save(nnm_path, </span><span class="r22">self</span><span class="r20">.</span><span class="r18">nonoccurrence_array, </span>  
 <span class="r10">  943 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  944 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Save the vocab dictionary</span><span class="r14">                     </span>  
 <span class="r10">  945 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        vocab_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> vocab_name</span><span class="r14">              </span>  
 <span class="r10">  946 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  947 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(vocab_path, </span><span class="r21">&quot;wt&quot;</span><span class="r18">, encoding</span><span class="r20">=</span><span class="r21">&quot;utf-8&quot;</span><span class="r18">) </span><span class="r15">as</span>  
 <span class="r10">  948 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   55M </span>│<span class="r1">▁▁▁▁           </span>│<span class="r12">       </span>│<span class="r18">            f</span><span class="r20">.</span><span class="r18">write(json_functions</span><span class="r20">.</span><span class="r18">dumps(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">vocab_dict</span>  
 <span class="r10">  949 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  950 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Save the parameters</span><span class="r14">                           </span>  
 <span class="r10">  951 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        params_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> params_name</span><span class="r14">            </span>  
 <span class="r10">  952 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        params </span><span class="r20">=</span><span class="r18"> </span><span class="r22">dict</span><span class="r18">(</span><span class="r14">                                  </span>  
 <span class="r10">  953 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            k1</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">k1,</span><span class="r14">                                 </span>  
 <span class="r10">  954 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            b</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">b,</span><span class="r14">                                   </span>  
 <span class="r10">  955 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            delta</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">delta,</span><span class="r14">                           </span>  
 <span class="r10">  956 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            method</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">method,</span><span class="r14">                         </span>  
 <span class="r10">  957 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            idf_method</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">idf_method,</span><span class="r14">                 </span>  
 <span class="r10">  958 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            dtype</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">dtype,</span><span class="r14">                           </span>  
 <span class="r10">  959 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            int_dtype</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">int_dtype,</span><span class="r14">                   </span>  
 <span class="r10">  960 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            num_docs</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores[</span><span class="r21">&quot;num_docs&quot;</span><span class="r18">],</span><span class="r14">           </span>  
 <span class="r10">  961 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            version</span><span class="r20">=</span><span class="r18">__version__,</span><span class="r14">                        </span>  
 <span class="r10">  962 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            backend</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">backend,</span><span class="r14">                       </span>  
 <span class="r10">  963 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  964 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(params_path, </span><span class="r21">&quot;w&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">               </span>  
 <span class="r10">  965 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            json</span><span class="r20">.</span><span class="r18">dump(params, f, indent</span><span class="r20">=4</span><span class="r18">)</span><span class="r14">              </span>  
 <span class="r10">  966 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  967 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus </span><span class="r20">=</span><span class="r18"> corpus </span><span class="r15">if</span><span class="r18"> corpus </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18"> </span><span class="r15">else</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span>  
 <span class="r10">  968 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  969 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> corpus </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                          </span>  
 <span class="r10">  970 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(save_dir </span><span class="r20">/</span><span class="r18"> corpus_name, </span><span class="r21">&quot;wt&quot;</span><span class="r18">, enco</span>  
 <span class="r10">  971 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r26"># if it&#x27;s not an iterable, we skip</span><span class="r14">      </span>  
 <span class="r10">  972 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(corpus, Iterable):</span><span class="r14">    </span>  
 <span class="r10">  973 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    logging</span><span class="r20">.</span><span class="r18">warning(</span><span class="r14">                    </span>  
 <span class="r10">  974 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r21">&quot;The corpus is not an iterable. </span>  
 <span class="r10">  975 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    )</span><span class="r14">                                   </span>  
 <span class="r10">  976 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  977 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">                </span><span class="r15">for</span><span class="r18"> i, doc </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span><span class="r18">(corpus):</span><span class="r14">        </span>  
 <span class="r10">  978 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     1 </span>│<span class="r18">                    </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(doc, </span><span class="r22">str</span><span class="r18">):</span><span class="r14">            </span>  
 <span class="r10">  979 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        doc </span><span class="r20">=</span><span class="r18"> {</span><span class="r21">&quot;id&quot;</span><span class="r18">: i, </span><span class="r21">&quot;text&quot;</span><span class="r18">: doc}</span><span class="r14">    </span>  
 <span class="r10">  980 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">                    </span><span class="r15">elif</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(doc, (</span><span class="r22">dict</span><span class="r18">, </span><span class="r22">list</span><span class="r18">, </span><span class="r22">tu</span>  
 <span class="r10">  981 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">                        doc </span><span class="r20">=</span><span class="r18"> doc</span><span class="r14">                       </span>  
 <span class="r10">  982 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                               </span>  
 <span class="r10">  983 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        logging</span><span class="r20">.</span><span class="r18">warning(</span><span class="r14">                </span>  
 <span class="r10">  984 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                            </span><span class="r21">f&quot;Document at index </span><span class="r25">{</span><span class="r18">i</span><span class="r25">}</span><span class="r21"> is n</span>  
 <span class="r10">  985 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        )</span><span class="r14">                               </span>  
 <span class="r10">  986 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r15">continue</span><span class="r14">                        </span>  
 <span class="r10">  987 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  988 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">                    </span><span class="r15">try</span><span class="r18">:</span><span class="r14">                                </span>  
 <span class="r10">  989 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     1 </span>│<span class="r18">                        doc_str </span><span class="r20">=</span><span class="r18"> json_functions</span><span class="r20">.</span><span class="r18">dumps(d</span>  
 <span class="r10">  990 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">except</span><span class="r18"> </span><span class="r31">Exception</span><span class="r18"> </span><span class="r15">as</span><span class="r18"> e:</span><span class="r14">              </span>  
 <span class="r10">  991 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        logging</span><span class="r20">.</span><span class="r18">warning(</span><span class="r21">f&quot;Error saving d</span>  
 <span class="r10">  992 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                               </span>  
 <span class="r10">  993 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   10M </span>│<span class="r1">▁              </span>│<span class="r12">     6 </span>│<span class="r18">                        f</span><span class="r20">.</span><span class="r18">write(doc_str </span><span class="r20">+</span><span class="r18"> </span><span class="r21">&quot;</span><span class="r33">\n</span><span class="r21">&quot;</span><span class="r18">)</span><span class="r14">         </span>  
 <span class="r10">  994 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  995 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># also save corpus.mmindex</span><span class="r14">                  </span>  
 <span class="r10">  996 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            mmidx </span><span class="r20">=</span><span class="r18"> utils</span><span class="r20">.</span><span class="r18">corpus</span><span class="r20">.</span><span class="r18">find_newline_positions(</span>  
 <span class="r10">  997 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            utils</span><span class="r20">.</span><span class="r18">corpus</span><span class="r20">.</span><span class="r18">save_mmindex(mmidx, path</span><span class="r20">=</span><span class="r18">save_d</span>  
 <span class="r10">  998 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  999 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">load_scores</span><span class="r18">(</span><span class="r14">                                    </span>  
 <span class="r10"> 1000 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">,</span><span class="r14">                                           </span>  
 <span class="r10"> 1001 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir,</span><span class="r14">                                       </span>  
 <span class="r10"> 1002 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        data_name</span><span class="r20">=</span><span class="r21">&quot;data.csc.index.npy&quot;</span><span class="r18">,</span><span class="r14">                 </span>  
 <span class="r10"> 1003 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices_name</span><span class="r20">=</span><span class="r21">&quot;indices.csc.index.npy&quot;</span><span class="r18">,</span><span class="r14">           </span>  
 <span class="r10"> 1004 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indptr_name</span><span class="r20">=</span><span class="r21">&quot;indptr.csc.index.npy&quot;</span><span class="r18">,</span><span class="r14">             </span>  
 <span class="r10"> 1005 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        num_docs</span><span class="r20">=</span><span class="r15">None</span><span class="r18">,</span><span class="r14">                                  </span>  
 <span class="r10"> 1006 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        mmap</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                                     </span>  
 <span class="r10"> 1007 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        allow_pickle</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                             </span>  
 <span class="r10"> 1008 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10"> 1009 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10"> 1010 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Load the scores arrays from the BM25 index. This</span>  
 <span class="r10"> 1011 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        the scores arrays separately from the vocab dict</span>  
 <span class="r10"> 1012 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1013 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        This is called internally by the `load` method, </span>  
 <span class="r10"> 1014 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1015 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10"> 1016 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10"> 1017 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        data_name : str</span><span class="r14">                                 </span>  
 <span class="r10"> 1018 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that contains the data </span>  
 <span class="r10"> 1019 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1020 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        indices_name : str</span><span class="r14">                              </span>  
 <span class="r10"> 1021 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that contains the indic</span>  
 <span class="r10"> 1022 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1023 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        indptr_name : str</span><span class="r14">                               </span>  
 <span class="r10"> 1024 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that contains the indpt</span>  
 <span class="r10"> 1025 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1026 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        mmap : bool</span><span class="r14">                                     </span>  
 <span class="r10"> 1027 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Whether to use Memory-map for the np.load fu</span>  
 <span class="r10"> 1028 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, the arrays will be memory-mapped, u</span>  
 <span class="r10"> 1029 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            do not fit into memory.</span><span class="r14">                     </span>  
 <span class="r10"> 1030 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1031 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        allow_pickle : bool</span><span class="r14">                             </span>  
 <span class="r10"> 1032 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, the arrays will be loaded using pic</span>  
 <span class="r10"> 1033 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            in a more efficient format, but they will no</span>  
 <span class="r10"> 1034 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10"> 1035 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir </span><span class="r20">=</span><span class="r18"> Path(save_dir)</span><span class="r14">                       </span>  
 <span class="r10"> 1036 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1037 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        data_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> data_name</span><span class="r14">                </span>  
 <span class="r10"> 1038 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> indices_name</span><span class="r14">          </span>  
 <span class="r10"> 1039 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indptr_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> indptr_name</span><span class="r14">            </span>  
 <span class="r10"> 1040 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1041 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        mmap_mode </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;r&quot;</span><span class="r18"> </span><span class="r15">if</span><span class="r18"> mmap </span><span class="r15">else</span><span class="r18"> </span><span class="r15">None</span><span class="r14">               </span>  
 <span class="r10"> 1042 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        data </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">load(data_path, allow_pickle</span><span class="r20">=</span><span class="r18">allow_pic</span>  
 <span class="r10"> 1043 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">load(indices_path, allow_pickle</span><span class="r20">=</span><span class="r18">all</span>  
 <span class="r10"> 1044 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indptr </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">load(indptr_path, allow_pickle</span><span class="r20">=</span><span class="r18">allow</span>  
 <span class="r10"> 1045 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1046 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores </span><span class="r20">=</span><span class="r18"> {}</span><span class="r14">                                     </span>  
 <span class="r10"> 1047 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores[</span><span class="r21">&quot;data&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> data</span><span class="r14">                           </span>  
 <span class="r10"> 1048 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores[</span><span class="r21">&quot;indices&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> indices</span><span class="r14">                     </span>  
 <span class="r10"> 1049 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores[</span><span class="r21">&quot;indptr&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> indptr</span><span class="r14">                       </span>  
 <span class="r10"> 1050 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores[</span><span class="r21">&quot;num_docs&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> num_docs</span><span class="r14">                   </span>  
 <span class="r10"> 1051 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1052 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">scores </span><span class="r20">=</span><span class="r18"> scores</span><span class="r14">                            </span>  
 <span class="r10"> 1053 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1054 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r32">@classmethod</span><span class="r14">                                        </span>  
 <span class="r10"> 1055 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">load</span><span class="r18">(</span><span class="r14">                                           </span>  
 <span class="r10"> 1056 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">cls</span><span class="r18">,</span><span class="r14">                                            </span>  
 <span class="r10"> 1057 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir,</span><span class="r14">                                       </span>  
 <span class="r10"> 1058 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        data_name</span><span class="r20">=</span><span class="r21">&quot;data.csc.index.npy&quot;</span><span class="r18">,</span><span class="r14">                 </span>  
 <span class="r10"> 1059 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices_name</span><span class="r20">=</span><span class="r21">&quot;indices.csc.index.npy&quot;</span><span class="r18">,</span><span class="r14">           </span>  
 <span class="r10"> 1060 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indptr_name</span><span class="r20">=</span><span class="r21">&quot;indptr.csc.index.npy&quot;</span><span class="r18">,</span><span class="r14">             </span>  
 <span class="r10"> 1061 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        vocab_name</span><span class="r20">=</span><span class="r21">&quot;vocab.index.json&quot;</span><span class="r18">,</span><span class="r14">                  </span>  
 <span class="r10"> 1062 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        params_name</span><span class="r20">=</span><span class="r21">&quot;params.index.json&quot;</span><span class="r18">,</span><span class="r14">                </span>  
 <span class="r10"> 1063 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        nnoc_name</span><span class="r20">=</span><span class="r21">&quot;nonoccurrence_array.index.npy&quot;</span><span class="r18">,</span><span class="r14">      </span>  
 <span class="r10"> 1064 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus_name</span><span class="r20">=</span><span class="r21">&quot;corpus.jsonl&quot;</span><span class="r18">,</span><span class="r14">                     </span>  
 <span class="r10"> 1065 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        load_corpus</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                              </span>  
 <span class="r10"> 1066 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        mmap</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                                     </span>  
 <span class="r10"> 1067 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        allow_pickle</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                             </span>  
 <span class="r10"> 1068 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        load_vocab</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                                </span>  
 <span class="r10"> 1069 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10"> 1070 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10"> 1071 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Load a BM25S index that was saved using the `sav</span>  
 <span class="r10"> 1072 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        This returns a BM25S object with the saved param</span>  
 <span class="r10"> 1073 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        which can be directly used for retrieval.</span><span class="r14">       </span>  
 <span class="r10"> 1074 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1075 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10"> 1076 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10"> 1077 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        save_dir : str</span><span class="r14">                                  </span>  
 <span class="r10"> 1078 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The directory where the BM25S index was save</span>  
 <span class="r10"> 1079 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1080 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        data_name : str</span><span class="r14">                                 </span>  
 <span class="r10"> 1081 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that contains the data </span>  
 <span class="r10"> 1082 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1083 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        indices_name : str</span><span class="r14">                              </span>  
 <span class="r10"> 1084 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that contains the indic</span>  
 <span class="r10"> 1085 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1086 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        indptr_name : str</span><span class="r14">                               </span>  
 <span class="r10"> 1087 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that contains the indpt</span>  
 <span class="r10"> 1088 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1089 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        vocab_name : str</span><span class="r14">                                </span>  
 <span class="r10"> 1090 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that contains the vocab</span>  
 <span class="r10"> 1091 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1092 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        params_name : str</span><span class="r14">                               </span>  
 <span class="r10"> 1093 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that contains the param</span>  
 <span class="r10"> 1094 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1095 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        nnoc_name : str</span><span class="r14">                                 </span>  
 <span class="r10"> 1096 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that contains the non-o</span>  
 <span class="r10"> 1097 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1098 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        corpus_name : str</span><span class="r14">                               </span>  
 <span class="r10"> 1099 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the file that contains the corpu</span>  
 <span class="r10"> 1100 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1101 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        load_corpus : bool</span><span class="r14">                              </span>  
 <span class="r10"> 1102 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, the corpus will be loaded from the </span>  
 <span class="r10"> 1103 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1104 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        mmap : bool</span><span class="r14">                                     </span>  
 <span class="r10"> 1105 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Whether to use Memory-map for the np.load fu</span>  
 <span class="r10"> 1106 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, the arrays will be memory-mapped, u</span>  
 <span class="r10"> 1107 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            do not fit into memory.</span><span class="r14">                     </span>  
 <span class="r10"> 1108 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1109 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        allow_pickle : bool</span><span class="r14">                             </span>  
 <span class="r10"> 1110 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, the arrays will be loaded using pic</span>  
 <span class="r10"> 1111 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            in a more efficient format, but they will no</span>  
 <span class="r10"> 1112 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1113 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        load_vocab : bool</span><span class="r14">                               </span>  
 <span class="r10"> 1114 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If True, the vocab dictionary will be loaded</span>  
 <span class="r10"> 1115 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            will not be loaded, and the `vocab_dict` att</span>  
 <span class="r10"> 1116 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10"> 1117 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(mmap, </span><span class="r22">bool</span><span class="r18">):</span><span class="r14">                  </span>  
 <span class="r10"> 1118 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r21">&quot;`mmap` must be a boolean&quot;</span><span class="r18">)</span>  
 <span class="r10"> 1119 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1120 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Load the BM25 index from the save_dir</span><span class="r14">         </span>  
 <span class="r10"> 1121 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir </span><span class="r20">=</span><span class="r18"> Path(save_dir)</span><span class="r14">                       </span>  
 <span class="r10"> 1122 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1123 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Load the parameters</span><span class="r14">                           </span>  
 <span class="r10"> 1124 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        params_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> params_name</span><span class="r14">            </span>  
 <span class="r10"> 1125 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(params_path, </span><span class="r21">&quot;r&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">               </span>  
 <span class="r10"> 1126 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            params: </span><span class="r22">dict</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> json_functions</span><span class="r20">.</span><span class="r18">loads(f</span><span class="r20">.</span><span class="r18">read()</span>  
 <span class="r10"> 1127 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1128 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Load the vocab dictionary</span><span class="r14">                     </span>  
 <span class="r10"> 1129 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> load_vocab:</span><span class="r14">                                  </span>  
 <span class="r10"> 1130 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            vocab_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> vocab_name</span><span class="r14">          </span>  
 <span class="r10"> 1131 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(vocab_path, </span><span class="r21">&quot;r&quot;</span><span class="r18">, encoding</span><span class="r20">=</span><span class="r21">&quot;utf-8&quot;</span><span class="r18">)</span>  
 <span class="r10"> 1132 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                vocab_dict: </span><span class="r22">dict</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> json_functions</span><span class="r20">.</span><span class="r18">loads(</span>  
 <span class="r10"> 1133 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10"> 1134 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            vocab_dict </span><span class="r20">=</span><span class="r18"> {}</span><span class="r14">                             </span>  
 <span class="r10"> 1135 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1136 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        original_version </span><span class="r20">=</span><span class="r18"> params</span><span class="r20">.</span><span class="r18">pop(</span><span class="r21">&quot;version&quot;</span><span class="r18">, </span><span class="r15">None</span><span class="r18">)</span><span class="r14">  </span>  
 <span class="r10"> 1137 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        num_docs </span><span class="r20">=</span><span class="r18"> params</span><span class="r20">.</span><span class="r18">pop(</span><span class="r21">&quot;num_docs&quot;</span><span class="r18">, </span><span class="r15">None</span><span class="r18">)</span><span class="r14">         </span>  
 <span class="r10"> 1138 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1139 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        bm25_obj </span><span class="r20">=</span><span class="r18"> </span><span class="r22">cls</span><span class="r18">(</span><span class="r20">**</span><span class="r18">params)</span><span class="r14">                        </span>  
 <span class="r10"> 1140 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        bm25_obj</span><span class="r20">.</span><span class="r18">vocab_dict </span><span class="r20">=</span><span class="r18"> vocab_dict</span><span class="r14">                </span>  
 <span class="r10"> 1141 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        bm25_obj</span><span class="r20">.</span><span class="r18">_original_version </span><span class="r20">=</span><span class="r18"> original_version</span><span class="r14">   </span>  
 <span class="r10"> 1142 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        bm25_obj</span><span class="r20">.</span><span class="r18">unique_token_ids_set </span><span class="r20">=</span><span class="r18"> </span><span class="r22">set</span><span class="r18">(bm25_obj</span><span class="r20">.</span><span class="r18">voc</span>  
 <span class="r10"> 1143 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1144 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        bm25_obj</span><span class="r20">.</span><span class="r18">load_scores(</span><span class="r14">                           </span>  
 <span class="r10"> 1145 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            save_dir</span><span class="r20">=</span><span class="r18">save_dir,</span><span class="r14">                          </span>  
 <span class="r10"> 1146 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            data_name</span><span class="r20">=</span><span class="r18">data_name,</span><span class="r14">                        </span>  
 <span class="r10"> 1147 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            indices_name</span><span class="r20">=</span><span class="r18">indices_name,</span><span class="r14">                  </span>  
 <span class="r10"> 1148 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            indptr_name</span><span class="r20">=</span><span class="r18">indptr_name,</span><span class="r14">                    </span>  
 <span class="r10"> 1149 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            mmap</span><span class="r20">=</span><span class="r18">mmap,</span><span class="r14">                                  </span>  
 <span class="r10"> 1150 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            num_docs</span><span class="r20">=</span><span class="r18">num_docs,</span><span class="r14">                          </span>  
 <span class="r10"> 1151 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            allow_pickle</span><span class="r20">=</span><span class="r18">allow_pickle,</span><span class="r14">                  </span>  
 <span class="r10"> 1152 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10"> 1153 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1154 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> load_corpus:</span><span class="r14">                                 </span>  
 <span class="r10"> 1155 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># load the model from the snapshot</span><span class="r14">          </span>  
 <span class="r10"> 1156 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># if a corpus.jsonl file exists, load it</span><span class="r14">    </span>  
 <span class="r10"> 1157 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            corpus_file </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> corpus_name</span><span class="r14">        </span>  
 <span class="r10"> 1158 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> os</span><span class="r20">.</span><span class="r18">path</span><span class="r20">.</span><span class="r18">exists(corpus_file):</span><span class="r14">             </span>  
 <span class="r10"> 1159 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> mmap </span><span class="r23">is</span><span class="r18"> </span><span class="r15">True</span><span class="r18">:</span><span class="r14">                        </span>  
 <span class="r10"> 1160 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    corpus </span><span class="r20">=</span><span class="r18"> utils</span><span class="r20">.</span><span class="r18">corpus</span><span class="r20">.</span><span class="r18">JsonlCorpus(co</span>  
 <span class="r10"> 1161 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                   </span>  
 <span class="r10"> 1162 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    corpus </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                         </span>  
 <span class="r10"> 1163 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(corpus_file, </span><span class="r21">&quot;r&quot;</span><span class="r18">, encoding</span>  
 <span class="r10"> 1164 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r15">for</span><span class="r18"> line </span><span class="r23">in</span><span class="r18"> f:</span><span class="r14">                  </span>  
 <span class="r10"> 1165 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                            doc </span><span class="r20">=</span><span class="r18"> json_functions</span><span class="r20">.</span><span class="r18">loads(l</span>  
 <span class="r10"> 1166 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                            corpus</span><span class="r20">.</span><span class="r18">append(doc)</span><span class="r14">          </span>  
 <span class="r10"> 1167 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1168 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                bm25_obj</span><span class="r20">.</span><span class="r18">corpus </span><span class="r20">=</span><span class="r18"> corpus</span><span class="r14">                </span>  
 <span class="r10"> 1169 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1170 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># if the method is one of BM25L or BM25+, we nee</span>  
 <span class="r10"> 1171 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># if it does not exist, we raise an error</span><span class="r14">       </span>  
 <span class="r10"> 1172 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> bm25_obj</span><span class="r20">.</span><span class="r18">method </span><span class="r23">in</span><span class="r18"> bm25_obj</span><span class="r20">.</span><span class="r18">methods_requiring</span>  
 <span class="r10"> 1173 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            nnm_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> nnoc_name</span><span class="r14">             </span>  
 <span class="r10"> 1174 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> nnm_path</span><span class="r20">.</span><span class="r18">exists():</span><span class="r14">                       </span>  
 <span class="r10"> 1175 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                bm25_obj</span><span class="r20">.</span><span class="r18">nonoccurrence_array </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">load(</span><span class="r14"> </span>  
 <span class="r10"> 1176 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    nnm_path, allow_pickle</span><span class="r20">=</span><span class="r18">allow_pickle</span><span class="r14"> </span>  
 <span class="r10"> 1177 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                )</span><span class="r14">                                       </span>  
 <span class="r10"> 1178 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                       </span>  
 <span class="r10"> 1179 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">FileNotFoundError</span><span class="r18">(</span><span class="r21">f&quot;Non-occurrence</span>  
 <span class="r10"> 1180 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10"> 1181 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            bm25_obj</span><span class="r20">.</span><span class="r18">nonoccurrence_array </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r14">         </span>  
 <span class="r10"> 1182 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1183 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> bm25_obj</span><span class="r14">                                 </span>  
 <span class="r10"> 1184 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1185 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">activate_numba_scorer</span><span class="r18">(</span><span class="r22">self</span><span class="r18">):</span><span class="r14">                    </span>  
 <span class="r10"> 1186 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10"> 1187 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Activate the Numba scorer for the BM25 index. Th</span>  
 <span class="r10"> 1188 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        compilation to the `_compute_relevance_from_scor</span>  
 <span class="r10"> 1189 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        up the scoring process. This will have an impact</span>  
 <span class="r10"> 1190 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        method and the `get_scores` method. The first ti</span>  
 <span class="r10"> 1191 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        it will be slower, as the function will be compi</span>  
 <span class="r10"> 1192 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        will be faster.</span><span class="r14">                                 </span>  
 <span class="r10"> 1193 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1194 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        This function requires the `numba` package to be</span>  
 <span class="r10"> 1195 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        an ImportError will be raised. You can install N</span>  
 <span class="r10"> 1196 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1197 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Behind the scenes, this will reassign the `_comp</span>  
 <span class="r10"> 1198 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        to the JIT-compiled version of the function.</span><span class="r14">    </span>  
 <span class="r10"> 1199 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10"> 1200 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">try</span><span class="r18">:</span><span class="r14">                                            </span>  
 <span class="r10"> 1201 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">from</span><span class="r16"> </span><span class="r17">numba</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> njit</span><span class="r14">                      </span>  
 <span class="r10"> 1202 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">except</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">:</span><span class="r14">                             </span>  
 <span class="r10"> 1203 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">(</span><span class="r14">                          </span>  
 <span class="r10"> 1204 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">&quot;Numba is not installed. Please install </span>  
 <span class="r10"> 1205 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10"> 1206 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1207 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">from</span><span class="r16"> </span><span class="r17">.scoring</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> _compute_relevance_from_sco</span>  
 <span class="r10"> 1208 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10"> 1209 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">_compute_relevance_from_scores </span><span class="r20">=</span><span class="r18"> njit(</span><span class="r14">     </span>  
 <span class="r10"> 1210 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            _compute_relevance_from_scores_jit_ready</span><span class="r14">    </span>  
 <span class="r10"> 1211 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10"> 1212 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
       ╵       ╵       ╵       ╵        ╵       ╵               ╵       ╵                                                          
Top PEAK memory consumption, by line:
<span class="r1">(1)   360:  1967 MB</span>                                                                                                                 
<span class="r1">(2)   305:   141 MB</span>                                                                                                                 
<span class="r1">(3)   507:    96 MB</span>                                                                                                                 
<span class="r1">(4)   948:    55 MB</span>                                                                                                                 
<span class="r1">(5)   491:    16 MB</span>                                                                                                                 
<span class="r30">             /home/team-054/dkozlov/bm25s/bm25s/numba/selection.py: % of time =   0.00% (0.000ms) out of 21m:32.451s.              </span>
       ╷       ╷       ╷       ╷        ╷       ╷               ╷       ╷                                                          
 <span class="r2">      </span>│<span class="r3">Time</span><span class="r2">   </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r4">Memory</span><span class="r2">  </span>│<span class="r4">––––––</span><span class="r2"> </span>│<span class="r4">–––––––––––</span><span class="r2">    </span>│<span class="r5">Copy</span><span class="r2">   </span>│<span class="r2">                                                         </span> 
 <span class="r2"> </span><span class="r6">Line</span><span class="r2"> </span>│<span class="r7">Python</span><span class="r2"> </span>│<span class="r7">native</span><span class="r2"> </span>│<span class="r7">system</span><span class="r2"> </span>│<span class="r8">Python</span><span class="r2">  </span>│<span class="r8">peak</span><span class="r2">   </span>│<span class="r8">timeline</span><span class="r4">/%</span><span class="r2">     </span>│<span class="r9">(MB/s)</span><span class="r2"> </span>│<span class="r2">/home/team-054/dkozlov/bm25s/bm25s/numba/selection.py    </span> 
╺━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r10">    1 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                     </span>  
 <span class="r10">    2 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">Acknowledgement:</span><span class="r14">                                        </span>  
 <span class="r10">    3 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">numba_unsorted_top_k is taken from retriv. The original </span>  
 <span class="r10">    4 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">https://github.com/AmenRa/retriv/blob/v0.2.1/retriv/util</span>  
 <span class="r10">    5 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    6 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">numba_sorted_top_k was created based on numba_unsorted_t</span>  
 <span class="r10">    7 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                     </span>  
 <span class="r10">    8 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    9 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">numpy</span><span class="r16"> </span><span class="r15">as</span><span class="r16"> </span><span class="r17">np</span><span class="r14">                                      </span>  
 <span class="r10">   10 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   10M </span>│<span class="r1">▁              </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">numba</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> njit</span><span class="r14">                                  </span>  
 <span class="r10">   11 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   12 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   13 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r32">@njit</span><span class="r18">()</span><span class="r14">                                                 </span>  
 <span class="r10">   14 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_numba_unsorted_top_k_legacy</span><span class="r18">(array: np</span><span class="r20">.</span><span class="r18">ndarray, k: </span><span class="r22">i</span>  
 <span class="r10">   15 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    top_k_values </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">zeros(k, dtype</span><span class="r20">=</span><span class="r18">np</span><span class="r20">.</span><span class="r18">float32)</span><span class="r14">        </span>  
 <span class="r10">   16 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    top_k_indices </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">zeros(k, dtype</span><span class="r20">=</span><span class="r18">np</span><span class="r20">.</span><span class="r18">int32)</span><span class="r14">         </span>  
 <span class="r10">   17 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   18 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    min_value </span><span class="r20">=</span><span class="r18"> </span><span class="r20">0.0</span><span class="r14">                                     </span>  
 <span class="r10">   19 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    min_value_idx </span><span class="r20">=</span><span class="r18"> </span><span class="r20">0</span><span class="r14">                                   </span>  
 <span class="r10">   20 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   21 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> i, value </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span><span class="r18">(array):</span><span class="r14">                   </span>  
 <span class="r10">   22 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> value </span><span class="r20">&gt;</span><span class="r18"> min_value:</span><span class="r14">                           </span>  
 <span class="r10">   23 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            top_k_values[min_value_idx] </span><span class="r20">=</span><span class="r18"> value</span><span class="r14">         </span>  
 <span class="r10">   24 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            top_k_indices[min_value_idx] </span><span class="r20">=</span><span class="r18"> i</span><span class="r14">            </span>  
 <span class="r10">   25 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            min_value_idx </span><span class="r20">=</span><span class="r18"> top_k_values</span><span class="r20">.</span><span class="r18">argmin()</span><span class="r14">       </span>  
 <span class="r10">   26 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            min_value </span><span class="r20">=</span><span class="r18"> top_k_values[min_value_idx]</span><span class="r14">     </span>  
 <span class="r10">   27 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   28 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> top_k_values, top_k_indices</span><span class="r14">                  </span>  
 <span class="r10">   29 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   30 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   31 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r32">@njit</span><span class="r18">()</span><span class="r14">                                                 </span>  
 <span class="r10">   32 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">sift_down</span><span class="r18">(values, indices, startpos, pos):</span><span class="r14">          </span>  
 <span class="r10">   33 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    new_value </span><span class="r20">=</span><span class="r18"> values[pos]</span><span class="r14">                             </span>  
 <span class="r10">   34 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    new_index </span><span class="r20">=</span><span class="r18"> indices[pos]</span><span class="r14">                            </span>  
 <span class="r10">   35 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">while</span><span class="r18"> pos </span><span class="r20">&gt;</span><span class="r18"> startpos:</span><span class="r14">                               </span>  
 <span class="r10">   36 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        parentpos </span><span class="r20">=</span><span class="r18"> (pos </span><span class="r20">-</span><span class="r18"> </span><span class="r20">1</span><span class="r18">) </span><span class="r20">&gt;&gt;</span><span class="r18"> </span><span class="r20">1</span><span class="r14">                      </span>  
 <span class="r10">   37 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        parent_value </span><span class="r20">=</span><span class="r18"> values[parentpos]</span><span class="r14">                </span>  
 <span class="r10">   38 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> new_value </span><span class="r20">&lt;</span><span class="r18"> parent_value:</span><span class="r14">                    </span>  
 <span class="r10">   39 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            values[pos] </span><span class="r20">=</span><span class="r18"> parent_value</span><span class="r14">                  </span>  
 <span class="r10">   40 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            indices[pos] </span><span class="r20">=</span><span class="r18"> indices[parentpos]</span><span class="r14">           </span>  
 <span class="r10">   41 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            pos </span><span class="r20">=</span><span class="r18"> parentpos</span><span class="r14">                             </span>  
 <span class="r10">   42 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">continue</span><span class="r14">                                    </span>  
 <span class="r10">   43 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">break</span><span class="r14">                                           </span>  
 <span class="r10">   44 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    values[pos] </span><span class="r20">=</span><span class="r18"> new_value</span><span class="r14">                             </span>  
 <span class="r10">   45 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indices[pos] </span><span class="r20">=</span><span class="r18"> new_index</span><span class="r14">                            </span>  
 <span class="r10">   46 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   47 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   48 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r32">@njit</span><span class="r18">()</span><span class="r14">                                                 </span>  
 <span class="r10">   49 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">sift_up</span><span class="r18">(values, indices, pos, length):</span><span class="r14">              </span>  
 <span class="r10">   50 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    startpos </span><span class="r20">=</span><span class="r18"> pos</span><span class="r14">                                      </span>  
 <span class="r10">   51 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    new_value </span><span class="r20">=</span><span class="r18"> values[pos]</span><span class="r14">                             </span>  
 <span class="r10">   52 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    new_index </span><span class="r20">=</span><span class="r18"> indices[pos]</span><span class="r14">                            </span>  
 <span class="r10">   53 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    childpos </span><span class="r20">=</span><span class="r18"> </span><span class="r20">2</span><span class="r18"> </span><span class="r20">*</span><span class="r18"> pos </span><span class="r20">+</span><span class="r18"> </span><span class="r20">1</span><span class="r14">                              </span>  
 <span class="r10">   54 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">while</span><span class="r18"> childpos </span><span class="r20">&lt;</span><span class="r18"> length:</span><span class="r14">                            </span>  
 <span class="r10">   55 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        rightpos </span><span class="r20">=</span><span class="r18"> childpos </span><span class="r20">+</span><span class="r18"> </span><span class="r20">1</span><span class="r14">                         </span>  
 <span class="r10">   56 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> rightpos </span><span class="r20">&lt;</span><span class="r18"> length </span><span class="r23">and</span><span class="r18"> values[rightpos] </span><span class="r20">&lt;</span><span class="r18"> valu</span>  
 <span class="r10">   57 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            childpos </span><span class="r20">=</span><span class="r18"> rightpos</span><span class="r14">                         </span>  
 <span class="r10">   58 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        values[pos] </span><span class="r20">=</span><span class="r18"> values[childpos]</span><span class="r14">                  </span>  
 <span class="r10">   59 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices[pos] </span><span class="r20">=</span><span class="r18"> indices[childpos]</span><span class="r14">                </span>  
 <span class="r10">   60 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        pos </span><span class="r20">=</span><span class="r18"> childpos</span><span class="r14">                                  </span>  
 <span class="r10">   61 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        childpos </span><span class="r20">=</span><span class="r18"> </span><span class="r20">2</span><span class="r18"> </span><span class="r20">*</span><span class="r18"> pos </span><span class="r20">+</span><span class="r18"> </span><span class="r20">1</span><span class="r14">                          </span>  
 <span class="r10">   62 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    values[pos] </span><span class="r20">=</span><span class="r18"> new_value</span><span class="r14">                             </span>  
 <span class="r10">   63 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indices[pos] </span><span class="r20">=</span><span class="r18"> new_index</span><span class="r14">                            </span>  
 <span class="r10">   64 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    sift_down(values, indices, startpos, pos)</span><span class="r14">           </span>  
 <span class="r10">   65 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   66 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   67 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r32">@njit</span><span class="r18">()</span><span class="r14">                                                 </span>  
 <span class="r10">   68 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">heap_push</span><span class="r18">(values, indices, value, index, length):</span><span class="r14">   </span>  
 <span class="r10">   69 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    values[length] </span><span class="r20">=</span><span class="r18"> value</span><span class="r14">                              </span>  
 <span class="r10">   70 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indices[length] </span><span class="r20">=</span><span class="r18"> index</span><span class="r14">                             </span>  
 <span class="r10">   71 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    sift_down(values, indices, </span><span class="r20">0</span><span class="r18">, length)</span><span class="r14">               </span>  
 <span class="r10">   72 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   73 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   74 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r32">@njit</span><span class="r18">()</span><span class="r14">                                                 </span>  
 <span class="r10">   75 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">heap_pop</span><span class="r18">(values, indices, length):</span><span class="r14">                  </span>  
 <span class="r10">   76 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    return_value </span><span class="r20">=</span><span class="r18"> values[</span><span class="r20">0</span><span class="r18">]</span><span class="r14">                            </span>  
 <span class="r10">   77 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    return_index </span><span class="r20">=</span><span class="r18"> indices[</span><span class="r20">0</span><span class="r18">]</span><span class="r14">                           </span>  
 <span class="r10">   78 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    last_value </span><span class="r20">=</span><span class="r18"> values[length </span><span class="r20">-</span><span class="r18"> </span><span class="r20">1</span><span class="r18">]</span><span class="r14">                     </span>  
 <span class="r10">   79 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    last_index </span><span class="r20">=</span><span class="r18"> indices[length </span><span class="r20">-</span><span class="r18"> </span><span class="r20">1</span><span class="r18">]</span><span class="r14">                    </span>  
 <span class="r10">   80 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    values[</span><span class="r20">0</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> last_value</span><span class="r14">                              </span>  
 <span class="r10">   81 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indices[</span><span class="r20">0</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> last_index</span><span class="r14">                             </span>  
 <span class="r10">   82 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    sift_up(values, indices, </span><span class="r20">0</span><span class="r18">, length </span><span class="r20">-</span><span class="r18"> </span><span class="r20">1</span><span class="r18">)</span><span class="r14">             </span>  
 <span class="r10">   83 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> return_value, return_index</span><span class="r14">                   </span>  
 <span class="r10">   84 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   85 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   86 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r32">@njit</span><span class="r18">()</span><span class="r14">                                                 </span>  
 <span class="r10">   87 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_numba_sorted_top_k</span><span class="r18">(array: np</span><span class="r20">.</span><span class="r18">ndarray, k: </span><span class="r22">int</span><span class="r18">, </span><span class="r22">sorte</span>  
 <span class="r10">   88 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    n </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(array)</span><span class="r14">                                      </span>  
 <span class="r10">   89 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> k </span><span class="r20">&gt;</span><span class="r18"> n:</span><span class="r14">                                           </span>  
 <span class="r10">   90 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        k </span><span class="r20">=</span><span class="r18"> n</span><span class="r14">                                           </span>  
 <span class="r10">   91 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   92 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    values </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">zeros(k, dtype</span><span class="r20">=</span><span class="r18">array</span><span class="r20">.</span><span class="r18">dtype)  </span><span class="r26"># aka score</span>  
 <span class="r10">   93 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indices </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">zeros(k, dtype</span><span class="r20">=</span><span class="r18">np</span><span class="r20">.</span><span class="r18">int32)</span><span class="r14">               </span>  
 <span class="r10">   94 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    length </span><span class="r20">=</span><span class="r18"> </span><span class="r20">0</span><span class="r14">                                          </span>  
 <span class="r10">   95 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   96 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> i, value </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span><span class="r18">(array):</span><span class="r14">                   </span>  
 <span class="r10">   97 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> length </span><span class="r20">&lt;</span><span class="r18"> k:</span><span class="r14">                                  </span>  
 <span class="r10">   98 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            heap_push(values, indices, value, i, length)</span>  
 <span class="r10">   99 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            length </span><span class="r20">+=</span><span class="r18"> </span><span class="r20">1</span><span class="r14">                                 </span>  
 <span class="r10">  100 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  101 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> value </span><span class="r20">&gt;</span><span class="r18"> values[</span><span class="r20">0</span><span class="r18">]:</span><span class="r14">                       </span>  
 <span class="r10">  102 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                values[</span><span class="r20">0</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> value</span><span class="r14">                       </span>  
 <span class="r10">  103 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                indices[</span><span class="r20">0</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> i</span><span class="r14">                          </span>  
 <span class="r10">  104 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                sift_up(values, indices, </span><span class="r20">0</span><span class="r18">, length)</span><span class="r14">     </span>  
 <span class="r10">  105 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  106 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r22">sorted</span><span class="r18">:</span><span class="r14">                                          </span>  
 <span class="r10">  107 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># # This is the original code for sorting, we ca</span>  
 <span class="r10">  108 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># # to let numpy handle the sorting</span><span class="r14">             </span>  
 <span class="r10">  109 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># top_k_values = np.zeros(k, dtype=array.dtype)</span><span class="r14"> </span>  
 <span class="r10">  110 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># top_k_indices = np.zeros(k, dtype=np.int32)</span><span class="r14">   </span>  
 <span class="r10">  111 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  112 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># for i in range(k - 1, -1, -1):</span><span class="r14">                </span>  
 <span class="r10">  113 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26">#     top_k_values[i], top_k_indices[i] = heap_p</span>  
 <span class="r10">  114 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26">#     length -= 1</span><span class="r14">                               </span>  
 <span class="r10">  115 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># values = top_k_values</span><span class="r14">                         </span>  
 <span class="r10">  116 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># indices = top_k_indices</span><span class="r14">                       </span>  
 <span class="r10">  117 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  118 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># This is the new code that uses numpy to sort t</span>  
 <span class="r10">  119 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># using the heap to sort them.</span><span class="r14">                  </span>  
 <span class="r10">  120 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        sorted_indices </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">flip(np</span><span class="r20">.</span><span class="r18">argsort(values))</span><span class="r14">    </span>  
 <span class="r10">  121 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices </span><span class="r20">=</span><span class="r18"> indices[sorted_indices]</span><span class="r14">               </span>  
 <span class="r10">  122 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        values </span><span class="r20">=</span><span class="r18"> values[sorted_indices]</span><span class="r14">                 </span>  
 <span class="r10">  123 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  124 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> values, indices</span><span class="r14">                              </span>  
 <span class="r10">  125 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  126 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  127 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">topk</span><span class="r18">(query_scores, k, backend</span><span class="r20">=</span><span class="r21">&quot;numba&quot;</span><span class="r18">, </span><span class="r22">sorted</span><span class="r20">=</span><span class="r15">True</span><span class="r18">):</span>  
 <span class="r10">  128 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  129 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    This function is used to retrieve the top-k results </span>  
 <span class="r10">  130 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    on a 1-dimensional array of scores.</span><span class="r14">                 </span>  
 <span class="r10">  131 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  132 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> backend </span><span class="r23">not</span><span class="r18"> </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;numba&quot;</span><span class="r18">]:</span><span class="r14">                        </span>  
 <span class="r10">  133 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                               </span>  
 <span class="r10">  134 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;Invalid backend. Only &#x27;numba&#x27; is supported.</span>  
 <span class="r10">  135 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  136 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> backend </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;numba&quot;</span><span class="r18">:</span><span class="r14">                            </span>  
 <span class="r10">  137 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        uns_scores, uns_indices </span><span class="r20">=</span><span class="r18"> _numba_sorted_top_k(qu</span>  
 <span class="r10">  138 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">sorted</span><span class="r18">:</span><span class="r14">                                      </span>  
 <span class="r10">  139 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            sorted_inds </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">flip(np</span><span class="r20">.</span><span class="r18">argsort(uns_scores)</span>  
 <span class="r10">  140 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            query_inds </span><span class="r20">=</span><span class="r18"> uns_indices[sorted_inds]</span><span class="r14">       </span>  
 <span class="r10">  141 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            query_scores </span><span class="r20">=</span><span class="r18"> uns_scores[sorted_inds]</span><span class="r14">      </span>  
 <span class="r10">  142 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  143 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            query_inds </span><span class="r20">=</span><span class="r18"> uns_indices</span><span class="r14">                    </span>  
 <span class="r10">  144 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            query_scores </span><span class="r20">=</span><span class="r18"> uns_scores</span><span class="r14">                   </span>  
 <span class="r10">  145 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r14">                                                </span>  
 <span class="r10">  146 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> query_scores, query_inds</span><span class="r14">                 </span>  
 <span class="r10">  147 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  148 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                               </span>  
 <span class="r10">  149 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r21">&quot;Invalid backend. Only &#x27;numba&#x27; </span>  
 <span class="r10">  150 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
       ╵       ╵       ╵       ╵        ╵       ╵               ╵       ╵                                                          
Top PEAK memory consumption, by line:
<span class="r1">(1)    10:    10 MB</span>                                                                                                                 
<span class="r30">                 /home/team-054/dkozlov/bm25s/bm25s/scoring.py: % of time =   0.00% (0.000ms) out of 21m:32.451s.                  </span>
       ╷       ╷       ╷       ╷        ╷       ╷               ╷       ╷                                                          
 <span class="r2">      </span>│<span class="r3">Time</span><span class="r2">   </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r4">Memory</span><span class="r2">  </span>│<span class="r4">––––––</span><span class="r2"> </span>│<span class="r4">–––––––––––</span><span class="r2">    </span>│<span class="r5">Copy</span><span class="r2">   </span>│<span class="r2">                                                         </span> 
 <span class="r2"> </span><span class="r6">Line</span><span class="r2"> </span>│<span class="r7">Python</span><span class="r2"> </span>│<span class="r7">native</span><span class="r2"> </span>│<span class="r7">system</span><span class="r2"> </span>│<span class="r8">Python</span><span class="r2">  </span>│<span class="r8">peak</span><span class="r2">   </span>│<span class="r8">timeline</span><span class="r4">/%</span><span class="r2">     </span>│<span class="r9">(MB/s)</span><span class="r2"> </span>│<span class="r2">/home/team-054/dkozlov/bm25s/bm25s/scoring.py            </span> 
╺━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r10">    1 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">collections</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> Counter</span><span class="r14">                         </span>  
 <span class="r10">    2 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">math</span><span class="r14">                                             </span>  
 <span class="r10">    3 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    4 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">numpy</span><span class="r16"> </span><span class="r15">as</span><span class="r16"> </span><span class="r17">np</span><span class="r14">                                      </span>  
 <span class="r10">    5 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    6 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">try</span><span class="r18">:</span><span class="r14">                                                    </span>  
 <span class="r10">    7 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">from</span><span class="r16"> </span><span class="r17">tqdm.auto</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> tqdm</span><span class="r14">                          </span>  
 <span class="r10">    8 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">except</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">:</span><span class="r14">                                     </span>  
 <span class="r10">    9 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   10 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">tqdm</span><span class="r18">(iterable, </span><span class="r20">*</span><span class="r18">args, </span><span class="r20">**</span><span class="r18">kwargs):</span><span class="r14">                </span>  
 <span class="r10">   11 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> iterable</span><span class="r14">                                 </span>  
 <span class="r10">   12 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   13 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   14 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_calculate_doc_freqs</span><span class="r18">(</span><span class="r14">                               </span>  
 <span class="r10">   15 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    corpus_tokens, unique_tokens, show_progress</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, le</span>  
 <span class="r10">   16 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">) </span><span class="r20">-&gt;</span><span class="r18"> </span><span class="r22">dict</span><span class="r18">:</span><span class="r14">                                              </span>  
 <span class="r10">   17 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">   18 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Document Frequency, aka DF, is the number of documen</span>  
 <span class="r10">   19 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    This function return a dictionary with the document </span>  
 <span class="r10">   20 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    why it is called `doc_frequencies`.</span><span class="r14">                 </span>  
 <span class="r10">   21 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">   22 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   96M </span>│<span class="r1">▁▁▁▁▁▁         </span>│<span class="r12">       </span>│<span class="r18">    unique_tokens </span><span class="r20">=</span><span class="r18"> </span><span class="r22">set</span><span class="r18">(unique_tokens)</span><span class="r14">                  </span>  
 <span class="r10">   23 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   24 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># Now that we have all the unique tokens, we can cou</span>  
 <span class="r10">   25 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># documents that contain each token</span><span class="r14">                 </span>  
 <span class="r10">   26 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  120M </span>│<span class="r1">▁▁▁▁▁▁▁        </span>│<span class="r12">       </span>│<span class="r18">    doc_frequencies </span><span class="r20">=</span><span class="r18"> {token: </span><span class="r20">0</span><span class="r18"> </span><span class="r15">for</span><span class="r18"> token </span><span class="r23">in</span><span class="r18"> unique_toke</span>  
 <span class="r10">   27 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   28 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> doc_tokens </span><span class="r23">in</span><span class="r18"> tqdm(</span><span class="r14">                             </span>  
 <span class="r10">   29 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus_tokens,</span><span class="r14">                                  </span>  
 <span class="r10">   30 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        leave</span><span class="r20">=</span><span class="r18">leave_progress,</span><span class="r14">                           </span>  
 <span class="r10">   31 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        disable</span><span class="r20">=</span><span class="r23">not</span><span class="r18"> show_progress,</span><span class="r14">                      </span>  
 <span class="r10">   32 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        desc</span><span class="r20">=</span><span class="r21">&quot;BM25S Count Tokens&quot;</span><span class="r18">,</span><span class="r14">                      </span>  
 <span class="r10">   33 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">   34 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   35 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># get intersection of unique tokens and the toke</span>  
 <span class="r10">   36 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">        shared_tokens </span><span class="r20">=</span><span class="r18"> unique_tokens</span><span class="r20">.</span><span class="r18">intersection(doc_t</span>  
 <span class="r10">   37 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   38 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># for each token in the document, we increment t</span>  
 <span class="r10">   39 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># This is a simple way to count the number of do</span>  
 <span class="r10">   40 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">    60 </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> token </span><span class="r23">in</span><span class="r18"> shared_tokens:</span><span class="r14">                     </span>  
 <span class="r10">   41 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">    54 </span>│<span class="r18">            doc_frequencies[token] </span><span class="r20">+=</span><span class="r18"> </span><span class="r20">1</span><span class="r14">                 </span>  
 <span class="r10">   42 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   43 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> doc_frequencies</span><span class="r14">                              </span>  
 <span class="r10">   44 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   45 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   46 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_build_idf_array</span><span class="r18">(</span><span class="r14">                                   </span>  
 <span class="r10">   47 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    doc_frequencies: </span><span class="r22">dict</span><span class="r18">,</span><span class="r14">                              </span>  
 <span class="r10">   48 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    n_docs: </span><span class="r22">int</span><span class="r18">,</span><span class="r14">                                        </span>  
 <span class="r10">   49 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    compute_idf_fn: </span><span class="r22">callable</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r18">,</span><span class="r14">                    </span>  
 <span class="r10">   50 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    dtype</span><span class="r20">=</span><span class="r21">&quot;float32&quot;</span><span class="r18">,</span><span class="r14">                                    </span>  
 <span class="r10">   51 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">) </span><span class="r20">-&gt;</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">ndarray:</span><span class="r14">                                        </span>  
 <span class="r10">   52 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    n_vocab </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(doc_frequencies)</span><span class="r14">                      </span>  
 <span class="r10">   53 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    idf_array </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">zeros(n_vocab, dtype</span><span class="r20">=</span><span class="r18">dtype)</span><span class="r14">          </span>  
 <span class="r10">   54 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   55 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> token_id, df </span><span class="r23">in</span><span class="r18"> doc_frequencies</span><span class="r20">.</span><span class="r18">items():</span><span class="r14">        </span>  
 <span class="r10">   56 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> df </span><span class="r20">!=</span><span class="r18"> </span><span class="r20">0</span><span class="r18">:</span><span class="r14">                                     </span>  
 <span class="r10">   57 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            idf_array[token_id] </span><span class="r20">=</span><span class="r18"> compute_idf_fn(df, N</span><span class="r20">=</span><span class="r18">n</span>  
 <span class="r10">   58 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   59 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> idf_array</span><span class="r14">                                    </span>  
 <span class="r10">   60 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   61 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   62 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_build_nonoccurrence_array</span><span class="r18">(</span><span class="r14">                         </span>  
 <span class="r10">   63 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    doc_frequencies: </span><span class="r22">dict</span><span class="r18">,</span><span class="r14">                              </span>  
 <span class="r10">   64 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    n_docs: </span><span class="r22">int</span><span class="r18">,</span><span class="r14">                                        </span>  
 <span class="r10">   65 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    compute_idf_fn: </span><span class="r22">callable</span><span class="r18">,</span><span class="r14">                           </span>  
 <span class="r10">   66 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    calculate_tfc_fn: </span><span class="r22">callable</span><span class="r18">,</span><span class="r14">                         </span>  
 <span class="r10">   67 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    l_d,</span><span class="r14">                                                </span>  
 <span class="r10">   68 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    l_avg,</span><span class="r14">                                              </span>  
 <span class="r10">   69 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    k1,</span><span class="r14">                                                 </span>  
 <span class="r10">   70 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    b,</span><span class="r14">                                                  </span>  
 <span class="r10">   71 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    delta,</span><span class="r14">                                              </span>  
 <span class="r10">   72 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    dtype</span><span class="r20">=</span><span class="r21">&quot;float32&quot;</span><span class="r18">,</span><span class="r14">                                    </span>  
 <span class="r10">   73 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">) </span><span class="r20">-&gt;</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">ndarray:</span><span class="r14">                                        </span>  
 <span class="r10">   74 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">   75 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    The non-occurrence array is used to store the idf sc</span>  
 <span class="r10">   76 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    document. This is useful for BM25L and BM25+ variant</span>  
 <span class="r10">   77 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    score for tokens that do not occur in the document, </span>  
 <span class="r10">   78 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    final score.</span><span class="r14">                                        </span>  
 <span class="r10">   79 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   80 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    The nonoccurence array has length |V|, where V is th</span>  
 <span class="r10">   81 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   82 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    The `compute_idf_fn` is the function to calculate th</span>  
 <span class="r10">   83 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    in the document. The `calculate_tfc_fn` is the funct</span>  
 <span class="r10">   84 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    of the BM25 score, which is used to calculate the fi</span>  
 <span class="r10">   85 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    document.</span><span class="r14">                                           </span>  
 <span class="r10">   86 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">   87 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    n_vocab </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(doc_frequencies)</span><span class="r14">                      </span>  
 <span class="r10">   88 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    nonoccurrence_array </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">zeros(n_vocab, dtype</span><span class="r20">=</span><span class="r18">dtype)</span>  
 <span class="r10">   89 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   90 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> token_id, df </span><span class="r23">in</span><span class="r18"> doc_frequencies</span><span class="r20">.</span><span class="r18">items():</span><span class="r14">        </span>  
 <span class="r10">   91 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> df </span><span class="r20">!=</span><span class="r18"> </span><span class="r20">0</span><span class="r18">:</span><span class="r14">                                     </span>  
 <span class="r10">   92 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            idf </span><span class="r20">=</span><span class="r18"> compute_idf_fn(df, N</span><span class="r20">=</span><span class="r18">n_docs)</span><span class="r14">          </span>  
 <span class="r10">   93 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            tfc </span><span class="r20">=</span><span class="r18"> calculate_tfc_fn(</span><span class="r14">                     </span>  
 <span class="r10">   94 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                tf_array</span><span class="r20">=0</span><span class="r18">, l_d</span><span class="r20">=</span><span class="r18">l_d, l_avg</span><span class="r20">=</span><span class="r18">l_avg, k1</span><span class="r20">=</span><span class="r18">k1,</span>  
 <span class="r10">   95 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">   96 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            nonoccurrence_array[token_id] </span><span class="r20">=</span><span class="r18"> idf </span><span class="r20">*</span><span class="r18"> tfc</span><span class="r14">   </span>  
 <span class="r10">   97 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   98 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> nonoccurrence_array</span><span class="r14">                          </span>  
 <span class="r10">   99 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  100 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  101 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_score_tfc_robertson</span><span class="r18">(tf_array, l_d, l_avg, k1, b, de</span>  
 <span class="r10">  102 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  103 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Computes the term frequency component of the BM25 sc</span>  
 <span class="r10">  104 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Implementation: https://cs.uwaterloo.ca/~jimmylin/pu</span>  
 <span class="r10">  105 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  106 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># idf component is given by the idf_array</span><span class="r14">           </span>  
 <span class="r10">  107 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># we calculate the term-frequency component (tfc)</span><span class="r14">   </span>  
 <span class="r10">  108 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> tf_array </span><span class="r20">/</span><span class="r18"> (k1 </span><span class="r20">*</span><span class="r18"> ((</span><span class="r20">1</span><span class="r18"> </span><span class="r20">-</span><span class="r18"> b) </span><span class="r20">+</span><span class="r18"> b </span><span class="r20">*</span><span class="r18"> l_d </span><span class="r20">/</span><span class="r18"> l_avg) </span>  
 <span class="r10">  109 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  110 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  111 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_score_tfc_lucene</span><span class="r18">(tf_array, l_d, l_avg, k1, b, delta</span>  
 <span class="r10">  112 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  113 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Computes the term frequency component of the BM25 sc</span>  
 <span class="r10">  114 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Implementation: https://cs.uwaterloo.ca/~jimmylin/pu</span>  
 <span class="r10">  115 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  116 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> _score_tfc_robertson(tf_array, l_d, l_avg, k1</span>  
 <span class="r10">  117 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  118 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  119 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_score_tfc_atire</span><span class="r18">(tf_array, l_d, l_avg, k1, b, delta</span><span class="r20">=</span>  
 <span class="r10">  120 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  121 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Computes the term frequency component of the BM25 sc</span>  
 <span class="r10">  122 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Implementation: https://cs.uwaterloo.ca/~jimmylin/pu</span>  
 <span class="r10">  123 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  124 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># idf component is given by the idf_array</span><span class="r14">           </span>  
 <span class="r10">  125 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># we calculate the term-frequency component (tfc)</span><span class="r14">   </span>  
 <span class="r10">  126 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> (tf_array </span><span class="r20">*</span><span class="r18"> (k1 </span><span class="r20">+</span><span class="r18"> </span><span class="r20">1</span><span class="r18">)) </span><span class="r20">/</span><span class="r18"> (tf_array </span><span class="r20">+</span><span class="r18"> k1 </span><span class="r20">*</span><span class="r18"> (</span><span class="r20">1</span><span class="r18"> </span><span class="r20">-</span>  
 <span class="r10">  127 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  128 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  129 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_score_tfc_bm25l</span><span class="r18">(tf_array, l_d, l_avg, k1, b, delta)</span>  
 <span class="r10">  130 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  131 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Computes the term frequency component of the BM25 sc</span>  
 <span class="r10">  132 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Implementation: https://cs.uwaterloo.ca/~jimmylin/pu</span>  
 <span class="r10">  133 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  134 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    c_array </span><span class="r20">=</span><span class="r18"> tf_array </span><span class="r20">/</span><span class="r18"> (</span><span class="r20">1</span><span class="r18"> </span><span class="r20">-</span><span class="r18"> b </span><span class="r20">+</span><span class="r18"> b </span><span class="r20">*</span><span class="r18"> l_d </span><span class="r20">/</span><span class="r18"> l_avg)</span><span class="r14">      </span>  
 <span class="r10">  135 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> ((k1 </span><span class="r20">+</span><span class="r18"> </span><span class="r20">1</span><span class="r18">) </span><span class="r20">*</span><span class="r18"> (c_array </span><span class="r20">+</span><span class="r18"> delta)) </span><span class="r20">/</span><span class="r18"> (k1 </span><span class="r20">+</span><span class="r18"> c_arra</span>  
 <span class="r10">  136 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  137 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  138 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_score_tfc_bm25plus</span><span class="r18">(tf_array, l_d, l_avg, k1, b, del</span>  
 <span class="r10">  139 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  140 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Computes the term frequency component of the BM25 sc</span>  
 <span class="r10">  141 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Implementation: https://cs.uwaterloo.ca/~jimmylin/pu</span>  
 <span class="r10">  142 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  143 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    num </span><span class="r20">=</span><span class="r18"> (k1 </span><span class="r20">+</span><span class="r18"> </span><span class="r20">1</span><span class="r18">) </span><span class="r20">*</span><span class="r18"> tf_array</span><span class="r14">                           </span>  
 <span class="r10">  144 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    den </span><span class="r20">=</span><span class="r18"> k1 </span><span class="r20">*</span><span class="r18"> (</span><span class="r20">1</span><span class="r18"> </span><span class="r20">-</span><span class="r18"> b </span><span class="r20">+</span><span class="r18"> b </span><span class="r20">*</span><span class="r18"> l_d </span><span class="r20">/</span><span class="r18"> l_avg) </span><span class="r20">+</span><span class="r18"> tf_array</span><span class="r14">     </span>  
 <span class="r10">  145 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> (num </span><span class="r20">/</span><span class="r18"> den) </span><span class="r20">+</span><span class="r18"> delta</span><span class="r14">                          </span>  
 <span class="r10">  146 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  147 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  148 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_select_tfc_scorer</span><span class="r18">(method) </span><span class="r20">-&gt;</span><span class="r18"> </span><span class="r22">callable</span><span class="r18">:</span><span class="r14">             </span>  
 <span class="r10">  149 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> method </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;robertson&quot;</span><span class="r18">:</span><span class="r14">                           </span>  
 <span class="r10">  150 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> _score_tfc_robertson</span><span class="r14">                     </span>  
 <span class="r10">  151 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> method </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;lucene&quot;</span><span class="r18">:</span><span class="r14">                            </span>  
 <span class="r10">  152 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> _score_tfc_lucene</span><span class="r14">                        </span>  
 <span class="r10">  153 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> method </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;atire&quot;</span><span class="r18">:</span><span class="r14">                             </span>  
 <span class="r10">  154 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> _score_tfc_atire</span><span class="r14">                         </span>  
 <span class="r10">  155 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> method </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;bm25l&quot;</span><span class="r18">:</span><span class="r14">                             </span>  
 <span class="r10">  156 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> _score_tfc_bm25l</span><span class="r14">                         </span>  
 <span class="r10">  157 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> method </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;bm25+&quot;</span><span class="r18">:</span><span class="r14">                             </span>  
 <span class="r10">  158 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> _score_tfc_bm25plus</span><span class="r14">                      </span>  
 <span class="r10">  159 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                               </span>  
 <span class="r10">  160 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        error_msg </span><span class="r20">=</span><span class="r18"> </span><span class="r21">f&quot;Invalid score_tfc value: </span><span class="r25">{</span><span class="r18">method</span><span class="r25">}</span><span class="r21">.</span>  
 <span class="r10">  161 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(error_msg)</span><span class="r14">                     </span>  
 <span class="r10">  162 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  163 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  164 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_score_idf_robertson</span><span class="r18">(df, N, allow_negative</span><span class="r20">=</span><span class="r15">False</span><span class="r18">):</span><span class="r14">  </span>  
 <span class="r10">  165 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  166 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Computes the inverse document frequency component of</span>  
 <span class="r10">  167 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Implementation: https://cs.uwaterloo.ca/~jimmylin/pu</span>  
 <span class="r10">  168 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  169 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    inner </span><span class="r20">=</span><span class="r18"> (N </span><span class="r20">-</span><span class="r18"> df </span><span class="r20">+</span><span class="r18"> </span><span class="r20">0.5</span><span class="r18">) </span><span class="r20">/</span><span class="r18"> (df </span><span class="r20">+</span><span class="r18"> </span><span class="r20">0.5</span><span class="r18">)</span><span class="r14">                 </span>  
 <span class="r10">  170 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> allow_negative </span><span class="r23">and</span><span class="r18"> inner </span><span class="r20">&lt;</span><span class="r18"> </span><span class="r20">1</span><span class="r18">:</span><span class="r14">                </span>  
 <span class="r10">  171 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        inner </span><span class="r20">=</span><span class="r18"> </span><span class="r20">1</span><span class="r14">                                       </span>  
 <span class="r10">  172 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  173 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> math</span><span class="r20">.</span><span class="r18">log(inner)</span><span class="r14">                              </span>  
 <span class="r10">  174 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  175 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  176 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_score_idf_lucene</span><span class="r18">(df, N):</span><span class="r14">                           </span>  
 <span class="r10">  177 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  178 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Computes the inverse document frequency component of</span>  
 <span class="r10">  179 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Implementation: https://cs.uwaterloo.ca/~jimmylin/pu</span>  
 <span class="r10">  180 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  181 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> math</span><span class="r20">.</span><span class="r18">log(</span><span class="r20">1</span><span class="r18"> </span><span class="r20">+</span><span class="r18"> (N </span><span class="r20">-</span><span class="r18"> df </span><span class="r20">+</span><span class="r18"> </span><span class="r20">0.5</span><span class="r18">) </span><span class="r20">/</span><span class="r18"> (df </span><span class="r20">+</span><span class="r18"> </span><span class="r20">0.5</span><span class="r18">))</span><span class="r14">    </span>  
 <span class="r10">  182 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  183 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  184 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_score_idf_atire</span><span class="r18">(df, N):</span><span class="r14">                            </span>  
 <span class="r10">  185 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  186 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Computes the inverse document frequency component of</span>  
 <span class="r10">  187 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Implementation: https://cs.uwaterloo.ca/~jimmylin/pu</span>  
 <span class="r10">  188 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  189 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> math</span><span class="r20">.</span><span class="r18">log(N </span><span class="r20">/</span><span class="r18"> df)</span><span class="r14">                             </span>  
 <span class="r10">  190 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  191 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  192 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_score_idf_bm25l</span><span class="r18">(df, N):</span><span class="r14">                            </span>  
 <span class="r10">  193 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  194 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Computes the inverse document frequency component of</span>  
 <span class="r10">  195 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Implementation: https://cs.uwaterloo.ca/~jimmylin/pu</span>  
 <span class="r10">  196 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  197 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> math</span><span class="r20">.</span><span class="r18">log((N </span><span class="r20">+</span><span class="r18"> </span><span class="r20">1</span><span class="r18">) </span><span class="r20">/</span><span class="r18"> (df </span><span class="r20">+</span><span class="r18"> </span><span class="r20">0.5</span><span class="r18">))</span><span class="r14">               </span>  
 <span class="r10">  198 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  199 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  200 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_score_idf_bm25plus</span><span class="r18">(df, N):</span><span class="r14">                         </span>  
 <span class="r10">  201 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  202 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Computes the inverse document frequency component of</span>  
 <span class="r10">  203 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Implementation: https://cs.uwaterloo.ca/~jimmylin/pu</span>  
 <span class="r10">  204 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  205 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> math</span><span class="r20">.</span><span class="r18">log((N </span><span class="r20">+</span><span class="r18"> </span><span class="r20">1</span><span class="r18">) </span><span class="r20">/</span><span class="r18"> df)</span><span class="r14">                       </span>  
 <span class="r10">  206 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  207 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  208 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_select_idf_scorer</span><span class="r18">(method) </span><span class="r20">-&gt;</span><span class="r18"> </span><span class="r22">callable</span><span class="r18">:</span><span class="r14">             </span>  
 <span class="r10">  209 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> method </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;robertson&quot;</span><span class="r18">:</span><span class="r14">                           </span>  
 <span class="r10">  210 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> _score_idf_robertson</span><span class="r14">                     </span>  
 <span class="r10">  211 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> method </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;lucene&quot;</span><span class="r18">:</span><span class="r14">                            </span>  
 <span class="r10">  212 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> _score_idf_lucene</span><span class="r14">                        </span>  
 <span class="r10">  213 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> method </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;atire&quot;</span><span class="r18">:</span><span class="r14">                             </span>  
 <span class="r10">  214 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> _score_idf_atire</span><span class="r14">                         </span>  
 <span class="r10">  215 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> method </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;bm25l&quot;</span><span class="r18">:</span><span class="r14">                             </span>  
 <span class="r10">  216 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> _score_idf_bm25l</span><span class="r14">                         </span>  
 <span class="r10">  217 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> method </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;bm25+&quot;</span><span class="r18">:</span><span class="r14">                             </span>  
 <span class="r10">  218 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> _score_idf_bm25plus</span><span class="r14">                      </span>  
 <span class="r10">  219 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                               </span>  
 <span class="r10">  220 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        error_msg </span><span class="r20">=</span><span class="r18"> </span><span class="r21">f&quot;Invalid score_idf_inner value: </span><span class="r25">{</span><span class="r18">me</span>  
 <span class="r10">  221 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(error_msg)</span><span class="r14">                     </span>  
 <span class="r10">  222 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  223 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  224 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_get_counts_from_token_ids</span><span class="r18">(token_ids, dtype, int_dty</span>  
 <span class="r10">  225 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     6 </span>│<span class="r18">    token_counter </span><span class="r20">=</span><span class="r18"> Counter(token_ids)</span><span class="r14">                  </span>  
 <span class="r10">  226 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    voc_ind </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">array(</span><span class="r22">list</span><span class="r18">(token_counter</span><span class="r20">.</span><span class="r18">keys()), dtype</span>  
 <span class="r10">  227 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    tf_array </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">array(</span><span class="r22">list</span><span class="r18">(token_counter</span><span class="r20">.</span><span class="r18">values()), dt</span>  
 <span class="r10">  228 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  229 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> voc_ind, tf_array</span><span class="r14">                            </span>  
 <span class="r10">  230 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  231 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  232 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_build_scores_and_indices_for_matrix</span><span class="r18">(</span><span class="r14">               </span>  
 <span class="r10">  233 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    corpus_token_ids,</span><span class="r14">                                   </span>  
 <span class="r10">  234 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    idf_array,</span><span class="r14">                                          </span>  
 <span class="r10">  235 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    avg_doc_len,</span><span class="r14">                                        </span>  
 <span class="r10">  236 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    doc_frequencies,</span><span class="r14">                                    </span>  
 <span class="r10">  237 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    k1,</span><span class="r14">                                                 </span>  
 <span class="r10">  238 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    b,</span><span class="r14">                                                  </span>  
 <span class="r10">  239 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    delta,</span><span class="r14">                                              </span>  
 <span class="r10">  240 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    nonoccurrence_array,</span><span class="r14">                                </span>  
 <span class="r10">  241 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    method</span><span class="r20">=</span><span class="r21">&quot;robertson&quot;</span><span class="r18">,</span><span class="r14">                                 </span>  
 <span class="r10">  242 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    dtype</span><span class="r20">=</span><span class="r21">&quot;float32&quot;</span><span class="r18">,</span><span class="r14">                                    </span>  
 <span class="r10">  243 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    int_dtype</span><span class="r20">=</span><span class="r21">&quot;int32&quot;</span><span class="r18">,</span><span class="r14">                                  </span>  
 <span class="r10">  244 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    show_progress</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                                 </span>  
 <span class="r10">  245 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    leave_progress</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                               </span>  
 <span class="r10">  246 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">):</span><span class="r14">                                                      </span>  
 <span class="r10">  247 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    array_size </span><span class="r20">=</span><span class="r18"> </span><span class="r22">sum</span><span class="r18">(doc_frequencies</span><span class="r20">.</span><span class="r18">values())</span><span class="r14">          </span>  
 <span class="r10">  248 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  249 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># We create 3 arrays to store the scores, document i</span>  
 <span class="r10">  250 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># The length is at most n_tokens, remaining elements</span>  
 <span class="r10">  251 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  987M </span>│<span class="r1">▁   4%         </span>│<span class="r12">       </span>│<span class="r18">    scores </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">empty(array_size, dtype</span><span class="r20">=</span><span class="r18">dtype)</span><span class="r14">          </span>  
 <span class="r10">  252 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">  980M </span>│<span class="r1">▁   4%         </span>│<span class="r12">       </span>│<span class="r18">    doc_indices </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">empty(array_size, dtype</span><span class="r20">=</span><span class="r18">int_dtype)</span><span class="r14"> </span>  
 <span class="r10">  253 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">  980M </span>│<span class="r1">▁   4%         </span>│<span class="r12">       </span>│<span class="r18">    voc_indices </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">empty(array_size, dtype</span><span class="r20">=</span><span class="r18">int_dtype)</span><span class="r14"> </span>  
 <span class="r10">  254 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  255 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    calculate_tfc </span><span class="r20">=</span><span class="r18"> _select_tfc_scorer(method)</span><span class="r14">          </span>  
 <span class="r10">  256 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  257 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    i </span><span class="r20">=</span><span class="r18"> </span><span class="r20">0</span><span class="r14">                                               </span>  
 <span class="r10">  258 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> doc_idx, token_ids </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span><span class="r18">(</span><span class="r14">                </span>  
 <span class="r10">  259 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        tqdm(</span><span class="r14">                                           </span>  
 <span class="r10">  260 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            corpus_token_ids,</span><span class="r14">                           </span>  
 <span class="r10">  261 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            desc</span><span class="r20">=</span><span class="r21">&quot;BM25S Compute Scores&quot;</span><span class="r18">,</span><span class="r14">                </span>  
 <span class="r10">  262 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            disable</span><span class="r20">=</span><span class="r23">not</span><span class="r18"> show_progress,</span><span class="r14">                  </span>  
 <span class="r10">  263 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            leave</span><span class="r20">=</span><span class="r18">leave_progress,</span><span class="r14">                       </span>  
 <span class="r10">  264 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  265 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">  266 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">        doc_len </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(token_ids)</span><span class="r14">                        </span>  
 <span class="r10">  267 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  268 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Get the term frequency array for the document</span><span class="r14"> </span>  
 <span class="r10">  269 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Note: tokens might contain duplicates, we use </span>  
 <span class="r10">  270 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     5 </span>│<span class="r18">        voc_ind_doc, tf_array </span><span class="r20">=</span><span class="r18"> _get_counts_from_token_i</span>  
 <span class="r10">  271 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">            token_ids, dtype</span><span class="r20">=</span><span class="r18">dtype, int_dtype</span><span class="r20">=</span><span class="r18">int_dtype</span><span class="r14"> </span>  
 <span class="r10">  272 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  273 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  274 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Calculate the BM25 score for each token in the</span>  
 <span class="r10">  275 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     3 </span>│<span class="r18">        tfc </span><span class="r20">=</span><span class="r18"> calculate_tfc(</span><span class="r14">                            </span>  
 <span class="r10">  276 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">            tf_array</span><span class="r20">=</span><span class="r18">tf_array, l_d</span><span class="r20">=</span><span class="r18">doc_len, l_avg</span><span class="r20">=</span><span class="r18">avg_do</span>  
 <span class="r10">  277 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  278 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">        idf </span><span class="r20">=</span><span class="r18"> idf_array[voc_ind_doc]</span><span class="r14">                    </span>  
 <span class="r10">  279 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     3 </span>│<span class="r18">        scores_doc </span><span class="r20">=</span><span class="r18"> idf </span><span class="r20">*</span><span class="r18"> tfc</span><span class="r14">                          </span>  
 <span class="r10">  280 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  281 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># If the method is uses a non-occurrence score a</span>  
 <span class="r10">  282 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># the non-occurrence score from the scores</span><span class="r14">      </span>  
 <span class="r10">  283 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> method </span><span class="r23">in</span><span class="r18"> (</span><span class="r21">&quot;bm25l&quot;</span><span class="r18">, </span><span class="r21">&quot;bm25+&quot;</span><span class="r18">):</span><span class="r14">                </span>  
 <span class="r10">  284 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            scores_doc </span><span class="r20">-=</span><span class="r18"> nonoccurrence_array[voc_ind_do</span>  
 <span class="r10">  285 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  286 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Update the arrays with the new scores, documen</span>  
 <span class="r10">  287 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">        doc_len </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(scores_doc)</span><span class="r14">                       </span>  
 <span class="r10">  288 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">        start, end </span><span class="r20">=</span><span class="r18"> i, i </span><span class="r20">+</span><span class="r18"> doc_len</span><span class="r14">                     </span>  
 <span class="r10">  289 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">        i </span><span class="r20">=</span><span class="r18"> end</span><span class="r14">                                         </span>  
 <span class="r10">  290 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  291 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     3 </span>│<span class="r18">        doc_indices[start:end] </span><span class="r20">=</span><span class="r18"> doc_idx</span><span class="r14">                </span>  
 <span class="r10">  292 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">        voc_indices[start:end] </span><span class="r20">=</span><span class="r18"> voc_ind_doc</span><span class="r14">            </span>  
 <span class="r10">  293 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     1 </span>│<span class="r18">        scores[start:end] </span><span class="r20">=</span><span class="r18"> scores_doc</span><span class="r14">                  </span>  
 <span class="r10">  294 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  295 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> scores, doc_indices, voc_indices</span><span class="r14">             </span>  
 <span class="r10">  296 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  297 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  298 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_compute_relevance_from_scores_legacy</span><span class="r18">(</span><span class="r14">              </span>  
 <span class="r10">  299 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    data, indptr, indices, num_docs, query_tokens_ids, d</span>  
 <span class="r10">  300 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">):</span><span class="r14">                                                      </span>  
 <span class="r10">  301 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  302 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    The legacy implementation of the `_compute_relevance</span>  
 <span class="r10">  303 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    be faster than the new implementation for some cases</span>  
 <span class="r10">  304 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    numba acceleration, as it uses python lists. This fu</span>  
 <span class="r10">  305 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    and comparison purposes.</span><span class="r14">                            </span>  
 <span class="r10">  306 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  307 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># First, we use the query_token_ids to select the re</span>  
 <span class="r10">  308 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    query_tokens_ids </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">array(query_tokens_ids, dtype</span><span class="r20">=</span>  
 <span class="r10">  309 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indptr_starts </span><span class="r20">=</span><span class="r18"> indptr[query_tokens_ids]</span><span class="r14">            </span>  
 <span class="r10">  310 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indptr_ends </span><span class="r20">=</span><span class="r18"> indptr[query_tokens_ids </span><span class="r20">+</span><span class="r18"> </span><span class="r20">1</span><span class="r18">]</span><span class="r14">          </span>  
 <span class="r10">  311 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  312 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    scores_lists </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                                   </span>  
 <span class="r10">  313 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indices_lists </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                                  </span>  
 <span class="r10">  314 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  315 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> i, (start, end) </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span><span class="r18">(</span><span class="r22">zip</span><span class="r18">(indptr_starts, </span>  
 <span class="r10">  316 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        scores_lists</span><span class="r20">.</span><span class="r18">append(data[start:end])</span><span class="r14">            </span>  
 <span class="r10">  317 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indices_lists</span><span class="r20">.</span><span class="r18">append(indices[start:end])</span><span class="r14">        </span>  
 <span class="r10">  318 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  319 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># combine the lists into a single array</span><span class="r14">             </span>  
 <span class="r10">  320 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  321 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    scores </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">zeros(num_docs, dtype</span><span class="r20">=</span><span class="r18">dtype)</span><span class="r14">            </span>  
 <span class="r10">  322 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(scores_lists) </span><span class="r20">==</span><span class="r18"> </span><span class="r20">0</span><span class="r18">:</span><span class="r14">                          </span>  
 <span class="r10">  323 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> scores</span><span class="r14">                                   </span>  
 <span class="r10">  324 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  325 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    scores_flat </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">concatenate(scores_lists)</span><span class="r14">          </span>  
 <span class="r10">  326 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indices_flat </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">concatenate(indices_lists)</span><span class="r14">        </span>  
 <span class="r10">  327 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    np</span><span class="r20">.</span><span class="r18">add</span><span class="r20">.</span><span class="r18">at(scores, indices_flat, scores_flat)</span><span class="r14">        </span>  
 <span class="r10">  328 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  329 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> scores</span><span class="r14">                                       </span>  
 <span class="r10">  330 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  331 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_compute_relevance_from_scores_jit_ready</span><span class="r18">(</span><span class="r14">           </span>  
 <span class="r10">  332 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    data: np</span><span class="r20">.</span><span class="r18">ndarray,</span><span class="r14">                                   </span>  
 <span class="r10">  333 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indptr: np</span><span class="r20">.</span><span class="r18">ndarray,</span><span class="r14">                                 </span>  
 <span class="r10">  334 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indices: np</span><span class="r20">.</span><span class="r18">ndarray,</span><span class="r14">                                </span>  
 <span class="r10">  335 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    num_docs: </span><span class="r22">int</span><span class="r18">,</span><span class="r14">                                      </span>  
 <span class="r10">  336 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    query_tokens_ids: np</span><span class="r20">.</span><span class="r18">ndarray,</span><span class="r14">                       </span>  
 <span class="r10">  337 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    dtype: np</span><span class="r20">.</span><span class="r18">dtype,</span><span class="r14">                                    </span>  
 <span class="r10">  338 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">) </span><span class="r20">-&gt;</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">ndarray:</span><span class="r14">                                        </span>  
 <span class="r10">  339 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  340 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    This internal static function calculates the relevan</span>  
 <span class="r10">  341 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    by using the BM25 scores that have been precomputed </span>  
 <span class="r10">  342 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    This version is ready for JIT compilation with numba</span>  
 <span class="r10">  343 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  344 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indptr_starts </span><span class="r20">=</span><span class="r18"> indptr[query_tokens_ids]</span><span class="r14">            </span>  
 <span class="r10">  345 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indptr_ends </span><span class="r20">=</span><span class="r18"> indptr[query_tokens_ids </span><span class="r20">+</span><span class="r18"> </span><span class="r20">1</span><span class="r18">]</span><span class="r14">          </span>  
 <span class="r10">  346 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  347 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    scores </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">zeros(num_docs, dtype</span><span class="r20">=</span><span class="r18">dtype)</span><span class="r14">            </span>  
 <span class="r10">  348 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> i </span><span class="r23">in</span><span class="r18"> </span><span class="r22">range</span><span class="r18">(</span><span class="r22">len</span><span class="r18">(query_tokens_ids)):</span><span class="r14">              </span>  
 <span class="r10">  349 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        start, end </span><span class="r20">=</span><span class="r18"> indptr_starts[i], indptr_ends[i]</span><span class="r14">   </span>  
 <span class="r10">  350 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># The following code is slower with numpy, but f</span>  
 <span class="r10">  351 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> j </span><span class="r23">in</span><span class="r18"> </span><span class="r22">range</span><span class="r18">(start, end):</span><span class="r14">                     </span>  
 <span class="r10">  352 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            scores[indices[j]] </span><span class="r20">+=</span><span class="r18"> data[j]</span><span class="r14">               </span>  
 <span class="r10">  353 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  354 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> scores</span><span class="r14">                                       </span>  
       ╵       ╵       ╵       ╵        ╵       ╵               ╵       ╵                                                          
Top PEAK memory consumption, by line:
<span class="r1">(1)   251:   987 MB</span>                                                                                                                 
<span class="r1">(2)   252:   980 MB</span>                                                                                                                 
<span class="r1">(3)   253:   980 MB</span>                                                                                                                 
<span class="r1">(4)    26:   120 MB</span>                                                                                                                 
<span class="r1">(5)    22:    96 MB</span>                                                                                                                 
<span class="r30">               /home/team-054/dkozlov/bm25s/bm25s/tokenization.py: % of time =   0.00% (0.000ms) out of 21m:32.451s.               </span>
       ╷       ╷       ╷       ╷        ╷       ╷               ╷       ╷                                                          
 <span class="r2">      </span>│<span class="r3">Time</span><span class="r2">   </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r4">Memory</span><span class="r2">  </span>│<span class="r4">––––––</span><span class="r2"> </span>│<span class="r4">–––––––––––</span><span class="r2">    </span>│<span class="r5">Copy</span><span class="r2">   </span>│<span class="r2">                                                         </span> 
 <span class="r2"> </span><span class="r6">Line</span><span class="r2"> </span>│<span class="r7">Python</span><span class="r2"> </span>│<span class="r7">native</span><span class="r2"> </span>│<span class="r7">system</span><span class="r2"> </span>│<span class="r8">Python</span><span class="r2">  </span>│<span class="r8">peak</span><span class="r2">   </span>│<span class="r8">timeline</span><span class="r4">/%</span><span class="r2">     </span>│<span class="r9">(MB/s)</span><span class="r2"> </span>│<span class="r2">/home/team-054/dkozlov/bm25s/bm25s/tokenization.py       </span> 
╺━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r10">    1 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">ast</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> Tuple</span><span class="r14">                                   </span>  
 <span class="r10">    2 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">pathlib</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> Path</span><span class="r14">                                </span>  
 <span class="r10">    3 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">re</span><span class="r14">                                               </span>  
 <span class="r10">    4 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">typing</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> Any, Dict, List, Union, Callable, Nam</span>  
 <span class="r10">    5 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">typing</span><span class="r14">                                           </span>  
 <span class="r10">    6 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    7 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">bm25s.utils</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> json_functions</span><span class="r14">                  </span>  
 <span class="r10">    8 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    9 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">try</span><span class="r18">:</span><span class="r14">                                                    </span>  
 <span class="r10">   10 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">from</span><span class="r16"> </span><span class="r17">tqdm.auto</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> tqdm</span><span class="r14">                          </span>  
 <span class="r10">   11 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">except</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">:</span><span class="r14">                                     </span>  
 <span class="r10">   12 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   13 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">tqdm</span><span class="r18">(iterable, </span><span class="r20">*</span><span class="r18">args, </span><span class="r20">**</span><span class="r18">kwargs):</span><span class="r14">                </span>  
 <span class="r10">   14 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> iterable</span><span class="r14">                                 </span>  
 <span class="r10">   15 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   16 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   17 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">.stopwords</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> (</span><span class="r14">                                </span>  
 <span class="r10">   18 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_EN,</span><span class="r14">                                       </span>  
 <span class="r10">   19 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_EN_PLUS,</span><span class="r14">                                  </span>  
 <span class="r10">   20 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_GERMAN,</span><span class="r14">                                   </span>  
 <span class="r10">   21 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_DUTCH,</span><span class="r14">                                    </span>  
 <span class="r10">   22 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_FRENCH,</span><span class="r14">                                   </span>  
 <span class="r10">   23 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_SPANISH,</span><span class="r14">                                  </span>  
 <span class="r10">   24 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_PORTUGUESE,</span><span class="r14">                               </span>  
 <span class="r10">   25 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_ITALIAN,</span><span class="r14">                                  </span>  
 <span class="r10">   26 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_RUSSIAN,</span><span class="r14">                                  </span>  
 <span class="r10">   27 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_SWEDISH,</span><span class="r14">                                  </span>  
 <span class="r10">   28 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_NORWEGIAN,</span><span class="r14">                                </span>  
 <span class="r10">   29 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    STOPWORDS_CHINESE,</span><span class="r14">                                  </span>  
 <span class="r10">   30 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">)</span><span class="r14">                                                       </span>  
 <span class="r10">   31 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   32 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   33 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">class</span><span class="r16"> </span><span class="r17">Tokenized</span><span class="r18">(NamedTuple):</span><span class="r14">                            </span>  
 <span class="r10">   34 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">   35 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    NamedTuple with two fields: ids and vocab. The ids f</span>  
 <span class="r10">   36 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    for each document. The vocab field is a dictionary m</span>  
 <span class="r10">   37 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    vocabulary.</span><span class="r14">                                         </span>  
 <span class="r10">   38 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">   39 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   40 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ids: List[List[</span><span class="r22">int</span><span class="r18">]]</span><span class="r14">                                </span>  
 <span class="r10">   41 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    vocab: Dict[</span><span class="r22">str</span><span class="r18">, </span><span class="r22">int</span><span class="r18">]</span><span class="r14">                               </span>  
 <span class="r10">   42 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   43 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">__repr__</span><span class="r18">(</span><span class="r22">self</span><span class="r18">):</span><span class="r14">                                 </span>  
 <span class="r10">   44 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">   45 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Returns:</span><span class="r14">                                        </span>  
 <span class="r10">   46 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            a string representation of the class.</span><span class="r14">       </span>  
 <span class="r10">   47 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            for example, for a small corpus, it would be</span>  
 <span class="r10">   48 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            ----</span><span class="r14">                                        </span>  
 <span class="r10">   49 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Tokenized(</span><span class="r14">                                  </span>  
 <span class="r10">   50 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">              &quot;ids&quot;: [</span><span class="r14">                                  </span>  
 <span class="r10">   51 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                0: [0, 1, 2, 3]</span><span class="r14">                         </span>  
 <span class="r10">   52 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">              ],</span><span class="r14">                                        </span>  
 <span class="r10">   53 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">              &quot;vocab&quot;: [</span><span class="r14">                                </span>  
 <span class="r10">   54 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;&#x27;: 4</span><span class="r14">                                   </span>  
 <span class="r10">   55 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;cat&#x27;: 0</span><span class="r14">                                </span>  
 <span class="r10">   56 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;feline&#x27;: 1</span><span class="r14">                             </span>  
 <span class="r10">   57 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;likes&#x27;: 2</span><span class="r14">                              </span>  
 <span class="r10">   58 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;purr&#x27;: 3</span><span class="r14">                               </span>  
 <span class="r10">   59 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">              ],</span><span class="r14">                                        </span>  
 <span class="r10">   60 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            )</span><span class="r14">                                           </span>  
 <span class="r10">   61 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            ----</span><span class="r14">                                        </span>  
 <span class="r10">   62 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   63 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            and, for example, for a large corpus, it wou</span>  
 <span class="r10">   64 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            ----</span><span class="r14">                                        </span>  
 <span class="r10">   65 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Tokenized(</span><span class="r14">                                  </span>  
 <span class="r10">   66 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">              &quot;ids&quot;: [</span><span class="r14">                                  </span>  
 <span class="r10">   67 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                0: [0, 1, 2, 3]</span><span class="r14">                         </span>  
 <span class="r10">   68 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                1: [4, 5, 6, 7, 8, 9]</span><span class="r14">                   </span>  
 <span class="r10">   69 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                2: [10, 11, 12, 13, 14]</span><span class="r14">                 </span>  
 <span class="r10">   70 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                3: [15, 16, 17, 18, 19]</span><span class="r14">                 </span>  
 <span class="r10">   71 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                4: [0, 1, 2, 3, 0, 20, 21, 22, 23, 24, .</span>  
 <span class="r10">   72 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                5: [0, 1, 2, 3]</span><span class="r14">                         </span>  
 <span class="r10">   73 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                6: [4, 5, 6, 7, 8, 9]</span><span class="r14">                   </span>  
 <span class="r10">   74 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                7: [10, 11, 12, 13, 14]</span><span class="r14">                 </span>  
 <span class="r10">   75 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                8: [15, 16, 17, 18, 19]</span><span class="r14">                 </span>  
 <span class="r10">   76 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                9: [0, 1, 2, 3, 0, 20, 21, 22, 23, 24, .</span>  
 <span class="r10">   77 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                ... (total 500000 docs)</span><span class="r14">                 </span>  
 <span class="r10">   78 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">              ],</span><span class="r14">                                        </span>  
 <span class="r10">   79 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">              &quot;vocab&quot;: [</span><span class="r14">                                </span>  
 <span class="r10">   80 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;&#x27;: 29</span><span class="r14">                                  </span>  
 <span class="r10">   81 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;animal&#x27;: 12</span><span class="r14">                            </span>  
 <span class="r10">   82 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;beautiful&#x27;: 11</span><span class="r14">                         </span>  
 <span class="r10">   83 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;best&#x27;: 6</span><span class="r14">                               </span>  
 <span class="r10">   84 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;bird&#x27;: 10</span><span class="r14">                              </span>  
 <span class="r10">   85 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;can&#x27;: 13</span><span class="r14">                               </span>  
 <span class="r10">   86 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;carefully&#x27;: 27</span><span class="r14">                         </span>  
 <span class="r10">   87 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;casually&#x27;: 28</span><span class="r14">                          </span>  
 <span class="r10">   88 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;cat&#x27;: 0</span><span class="r14">                                </span>  
 <span class="r10">   89 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                &#x27;creature&#x27;: 16</span><span class="r14">                          </span>  
 <span class="r10">   90 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">                ... (total 30 tokens)</span><span class="r14">                   </span>  
 <span class="r10">   91 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">              ],</span><span class="r14">                                        </span>  
 <span class="r10">   92 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            )</span><span class="r14">                                           </span>  
 <span class="r10">   93 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            ----</span><span class="r14">                                        </span>  
 <span class="r10">   94 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">   95 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        lines_print_max_num </span><span class="r20">=</span><span class="r18"> </span><span class="r20">10</span><span class="r14">                        </span>  
 <span class="r10">   96 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        single_doc_print_max_len </span><span class="r20">=</span><span class="r18"> </span><span class="r20">10</span><span class="r14">                   </span>  
 <span class="r10">   97 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        lines </span><span class="r20">=</span><span class="r18"> [</span><span class="r21">&quot;Tokenized(&quot;</span><span class="r18">, </span><span class="r21">&#x27;  &quot;ids&quot;: [&#x27;</span><span class="r18">]</span><span class="r14">            </span>  
 <span class="r10">   98 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> doc_idx, document </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">ids[:lin</span>  
 <span class="r10">   99 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            preview </span><span class="r20">=</span><span class="r18"> document[:single_doc_print_max_len</span>  
 <span class="r10">  100 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(document) </span><span class="r20">&gt;</span><span class="r18"> single_doc_print_max_len:</span>  
 <span class="r10">  101 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                preview </span><span class="r20">+=</span><span class="r18"> [</span><span class="r21">&quot;...&quot;</span><span class="r18">]</span><span class="r14">                      </span>  
 <span class="r10">  102 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            lines</span><span class="r20">.</span><span class="r18">append(</span><span class="r21">f&quot;    </span><span class="r25">{</span><span class="r18">doc_idx</span><span class="r25">}</span><span class="r21">: [</span><span class="r25">{</span><span class="r21">&#x27;, &#x27;</span><span class="r20">.</span><span class="r18">join([</span><span class="r22">s</span>  
 <span class="r10">  103 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">ids) </span><span class="r20">&gt;</span><span class="r18"> lines_print_max_num:</span><span class="r14">         </span>  
 <span class="r10">  104 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            lines</span><span class="r20">.</span><span class="r18">append(</span><span class="r21">f&quot;    ... (total </span><span class="r25">{</span><span class="r22">len</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">ids)</span>  
 <span class="r10">  105 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        lines</span><span class="r20">.</span><span class="r18">append(</span><span class="r21">f&#x27;  ],</span><span class="r33">\n</span><span class="r21">  &quot;vocab&quot;: [&#x27;</span><span class="r18">)</span><span class="r14">             </span>  
 <span class="r10">  106 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        vocab_keys </span><span class="r20">=</span><span class="r18"> </span><span class="r22">sorted</span><span class="r18">(</span><span class="r22">list</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">vocab</span><span class="r20">.</span><span class="r18">keys()))</span><span class="r14">    </span>  
 <span class="r10">  107 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> vocab_idx, key_ </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span><span class="r18">(vocab_keys[:lin</span>  
 <span class="r10">  108 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            val_ </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">vocab[key_]</span><span class="r14">                     </span>  
 <span class="r10">  109 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            lines</span><span class="r20">.</span><span class="r18">append(</span><span class="r21">f&quot;    </span><span class="r25">{</span><span class="r18">key_</span><span class="r25">!r}</span><span class="r21">: </span><span class="r25">{</span><span class="r18">val_</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">)</span><span class="r14">       </span>  
 <span class="r10">  110 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(</span><span class="r22">list</span><span class="r18">(vocab_keys)) </span><span class="r20">&gt;</span><span class="r18"> </span><span class="r20">10</span><span class="r18">:</span><span class="r14">                  </span>  
 <span class="r10">  111 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            lines</span><span class="r20">.</span><span class="r18">append(</span><span class="r21">f&quot;    ... (total </span><span class="r25">{</span><span class="r22">len</span><span class="r18">(vocab_key</span>  
 <span class="r10">  112 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        lines</span><span class="r20">.</span><span class="r18">append(</span><span class="r21">&quot;  ],</span><span class="r33">\n</span><span class="r21">)&quot;</span><span class="r18">)</span><span class="r14">                         </span>  
 <span class="r10">  113 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r21">&quot;</span><span class="r33">\n</span><span class="r21">&quot;</span><span class="r20">.</span><span class="r18">join(lines)</span><span class="r14">                         </span>  
 <span class="r10">  114 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  115 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  116 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">class</span><span class="r16"> </span><span class="r17">Tokenizer</span><span class="r18">:</span><span class="r14">                                        </span>  
 <span class="r10">  117 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  118 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Tokenizer class for tokenizing a list of strings and</span>  
 <span class="r10">  119 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  120 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Parameters</span><span class="r14">                                          </span>  
 <span class="r10">  121 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    ----------</span><span class="r14">                                          </span>  
 <span class="r10">  122 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    lower : bool, optional</span><span class="r14">                              </span>  
 <span class="r10">  123 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Whether to convert the text to lowercase before </span>  
 <span class="r10">  124 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  125 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    splitter : Union[str, Callable], optional</span><span class="r14">           </span>  
 <span class="r10">  126 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        If a string is provided, the tokenizer will inte</span>  
 <span class="r10">  127 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        and use the `re.compile` function to compile the</span>  
 <span class="r10">  128 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        to split the text. If a callable is provided, th</span>  
 <span class="r10">  129 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        split the text. The callable should take a strin</span>  
 <span class="r10">  130 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  131 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    stopwords : Union[str, List[str]], optional</span><span class="r14">         </span>  
 <span class="r10">  132 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        The list of stopwords to remove from the text. I</span>  
 <span class="r10">  133 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        the function will use the default English stopwo</span>  
 <span class="r10">  134 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        no stopwords will be removed. If a list of strin</span>  
 <span class="r10">  135 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        use the list of strings as stopwords.</span><span class="r14">           </span>  
 <span class="r10">  136 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  137 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    stemmer : Callable, optional</span><span class="r14">                        </span>  
 <span class="r10">  138 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        The stemmer to use for stemming the tokens. It i</span>  
 <span class="r10">  139 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        to use the PyStemmer library for stemming, but y</span>  
 <span class="r10">  140 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        takes a list of strings and returns a list of st</span>  
 <span class="r10">  141 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  142 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  143 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">__init__</span><span class="r18">(</span><span class="r14">                                       </span>  
 <span class="r10">  144 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">,</span><span class="r14">                                           </span>  
 <span class="r10">  145 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        lower: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r18">,</span><span class="r14">                             </span>  
 <span class="r10">  146 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        splitter: Union[</span><span class="r22">str</span><span class="r18">, Callable] </span><span class="r20">=</span><span class="r18"> </span><span class="r21">r&quot;(?u)\b\w\w+\b</span>  
 <span class="r10">  147 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        stopwords: Union[</span><span class="r22">str</span><span class="r18">, List[</span><span class="r22">str</span><span class="r18">]] </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;english&quot;</span><span class="r18">,</span><span class="r14">   </span>  
 <span class="r10">  148 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        stemmer: Callable </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r18">,  </span><span class="r26"># type: ignore</span><span class="r14">       </span>  
 <span class="r10">  149 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">  150 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">lower </span><span class="r20">=</span><span class="r18"> lower</span><span class="r14">                              </span>  
 <span class="r10">  151 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(splitter, </span><span class="r22">str</span><span class="r18">):</span><span class="r14">                   </span>  
 <span class="r10">  152 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            splitter </span><span class="r20">=</span><span class="r18"> re</span><span class="r20">.</span><span class="r18">compile(splitter)</span><span class="r20">.</span><span class="r18">findall</span><span class="r14">     </span>  
 <span class="r10">  153 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">callable</span><span class="r18">(splitter):</span><span class="r14">                      </span>  
 <span class="r10">  154 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r21">&quot;splitter must be a callabl</span>  
 <span class="r10">  155 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  156 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Exception handling for stemmer when we are usi</span>  
 <span class="r10">  157 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">hasattr</span><span class="r18">(stemmer, </span><span class="r21">&quot;stemWord&quot;</span><span class="r18">):</span><span class="r14">                </span>  
 <span class="r10">  158 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            stemmer </span><span class="r20">=</span><span class="r18"> stemmer</span><span class="r20">.</span><span class="r18">stemWord</span><span class="r14">                  </span>  
 <span class="r10">  159 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r22">callable</span><span class="r18">(stemmer) </span><span class="r23">and</span><span class="r18"> stemmer </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span>  
 <span class="r10">  160 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r21">&quot;stemmer must be callable o</span>  
 <span class="r10">  161 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  162 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stopwords </span><span class="r20">=</span><span class="r18"> _infer_stopwords(stopwords)</span><span class="r14">    </span>  
 <span class="r10">  163 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">splitter </span><span class="r20">=</span><span class="r18"> splitter</span><span class="r14">                        </span>  
 <span class="r10">  164 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stemmer </span><span class="r20">=</span><span class="r18"> stemmer</span><span class="r14">                          </span>  
 <span class="r10">  165 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  166 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">reset_vocab()</span><span class="r14">                              </span>  
 <span class="r10">  167 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  168 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">reset_vocab</span><span class="r18">(</span><span class="r22">self</span><span class="r18">):</span><span class="r14">                              </span>  
 <span class="r10">  169 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  170 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Reset the vocabulary dictionaries to empty dicti</span>  
 <span class="r10">  171 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        tokenize a new set of texts without reusing the </span>  
 <span class="r10">  172 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  173 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_stem </span><span class="r20">=</span><span class="r18"> {}  </span><span class="r26"># word -&gt; stemmed word, </span>  
 <span class="r10">  174 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stem_to_sid </span><span class="r20">=</span><span class="r18"> {}  </span><span class="r26"># stem -&gt; stemmed id, e.g</span>  
 <span class="r10">  175 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># word -&gt; {stemmed, unstemmed} id, e.g. &quot;apple&quot; </span>  
 <span class="r10">  176 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id </span><span class="r20">=</span><span class="r18"> {}</span><span class="r14">                            </span>  
 <span class="r10">  177 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  178 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">save_vocab</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, save_dir: </span><span class="r22">str</span><span class="r18">, vocab_name: </span><span class="r22">str</span><span class="r18"> </span>  
 <span class="r10">  179 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  180 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Save the vocabulary dictionaries to a file. The </span>  
 <span class="r10">  181 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  182 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  183 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  184 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        save_dir : str</span><span class="r14">                                  </span>  
 <span class="r10">  185 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The directory where the vocabulary file is s</span>  
 <span class="r10">  186 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        </span><span class="r14">                                                </span>  
 <span class="r10">  187 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        vocab_name : str, optional</span><span class="r14">                      </span>  
 <span class="r10">  188 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the vocabulary file. Default is </span>  
 <span class="r10">  189 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            sure to not use the same name as the vocab.i</span>  
 <span class="r10">  190 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            model, as it will overwrite the vocab.index.</span>  
 <span class="r10">  191 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  192 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir: Path </span><span class="r20">=</span><span class="r18"> Path(save_dir)</span><span class="r14">                 </span>  
 <span class="r10">  193 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> vocab_name</span><span class="r14">                    </span>  
 <span class="r10">  194 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  195 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir</span><span class="r20">.</span><span class="r18">mkdir(parents</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, exist_ok</span><span class="r20">=</span><span class="r15">True</span><span class="r18">)</span><span class="r14">     </span>  
 <span class="r10">  196 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(path, </span><span class="r21">&quot;w&quot;</span><span class="r18">, encoding</span><span class="r20">=</span><span class="r21">&#x27;utf-8&#x27;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">    </span>  
 <span class="r10">  197 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            d </span><span class="r20">=</span><span class="r18"> {</span><span class="r14">                                       </span>  
 <span class="r10">  198 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">&quot;word_to_stem&quot;</span><span class="r18">: </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_stem,</span><span class="r14">      </span>  
 <span class="r10">  199 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">&quot;stem_to_sid&quot;</span><span class="r18">: </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stem_to_sid,</span><span class="r14">        </span>  
 <span class="r10">  200 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r21">&quot;word_to_id&quot;</span><span class="r18">: </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id,</span><span class="r14">          </span>  
 <span class="r10">  201 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            }</span><span class="r14">                                           </span>  
 <span class="r10">  202 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  193M </span>│<span class="r1">▁▁▁▁           </span>│<span class="r12">       </span>│<span class="r18">            f</span><span class="r20">.</span><span class="r18">write(json_functions</span><span class="r20">.</span><span class="r18">dumps(d, ensure_ascii</span>  
 <span class="r10">  203 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r14">                                                </span>  
 <span class="r10">  204 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">load_vocab</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, save_dir: </span><span class="r22">str</span><span class="r18">, vocab_name: </span><span class="r22">str</span><span class="r18"> </span>  
 <span class="r10">  205 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  206 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Load the vocabulary dictionaries from a file. Th</span>  
 <span class="r10">  207 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  208 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  209 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  210 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        save_dir : str</span><span class="r14">                                  </span>  
 <span class="r10">  211 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The directory where the vocabulary file is s</span>  
 <span class="r10">  212 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        </span><span class="r14">                                                </span>  
 <span class="r10">  213 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        vocab_name : str, optional</span><span class="r14">                      </span>  
 <span class="r10">  214 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the vocabulary file.</span><span class="r14">            </span>  
 <span class="r10">  215 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        </span><span class="r14">                                                </span>  
 <span class="r10">  216 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Note</span><span class="r14">                                            </span>  
 <span class="r10">  217 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----</span><span class="r14">                                            </span>  
 <span class="r10">  218 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        The vocabulary file should be saved in JSON form</span>  
 <span class="r10">  219 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        - word_to_stem: a dictionary mapping words to th</span>  
 <span class="r10">  220 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        - stem_to_sid: a dictionary mapping stemmed word</span>  
 <span class="r10">  221 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        - word_to_id: a dictionary mapping words to thei</span>  
 <span class="r10">  222 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  223 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        path </span><span class="r20">=</span><span class="r18"> Path(save_dir) </span><span class="r20">/</span><span class="r18"> vocab_name</span><span class="r14">              </span>  
 <span class="r10">  224 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  225 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(path, </span><span class="r21">&quot;r&quot;</span><span class="r18">, encoding</span><span class="r20">=</span><span class="r21">&#x27;utf-8&#x27;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">    </span>  
 <span class="r10">  226 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            d </span><span class="r20">=</span><span class="r18"> json_functions</span><span class="r20">.</span><span class="r18">loads(f</span><span class="r20">.</span><span class="r18">read())</span><span class="r14">          </span>  
 <span class="r10">  227 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_stem </span><span class="r20">=</span><span class="r18"> d[</span><span class="r21">&quot;word_to_stem&quot;</span><span class="r18">]</span><span class="r14">       </span>  
 <span class="r10">  228 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stem_to_sid </span><span class="r20">=</span><span class="r18"> d[</span><span class="r21">&quot;stem_to_sid&quot;</span><span class="r18">]</span><span class="r14">         </span>  
 <span class="r10">  229 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id </span><span class="r20">=</span><span class="r18"> d[</span><span class="r21">&quot;word_to_id&quot;</span><span class="r18">]</span><span class="r14">           </span>  
 <span class="r10">  230 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r14">                                                    </span>  
 <span class="r10">  231 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">save_stopwords</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, save_dir: </span><span class="r22">str</span><span class="r18">, stopwords_na</span>  
 <span class="r10">  232 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  233 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Save the stopwords to a file. The file is saved </span>  
 <span class="r10">  234 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  235 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  236 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  237 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        save_dir : str</span><span class="r14">                                  </span>  
 <span class="r10">  238 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The directory where the stopwords file is sa</span>  
 <span class="r10">  239 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        </span><span class="r14">                                                </span>  
 <span class="r10">  240 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        stopwords_name : str, optional</span><span class="r14">                  </span>  
 <span class="r10">  241 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the stopwords file. Default is &quot;</span>  
 <span class="r10">  242 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  243 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir: Path </span><span class="r20">=</span><span class="r18"> Path(save_dir)</span><span class="r14">                 </span>  
 <span class="r10">  244 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> stopwords_name</span><span class="r14">                </span>  
 <span class="r10">  245 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  246 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir</span><span class="r20">.</span><span class="r18">mkdir(parents</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, exist_ok</span><span class="r20">=</span><span class="r15">True</span><span class="r18">)</span><span class="r14">     </span>  
 <span class="r10">  247 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(path, </span><span class="r21">&quot;w&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">                      </span>  
 <span class="r10">  248 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            f</span><span class="r20">.</span><span class="r18">write(json_functions</span><span class="r20">.</span><span class="r18">dumps(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">stopwords)</span>  
 <span class="r10">  249 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r14">                                                    </span>  
 <span class="r10">  250 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">load_stopwords</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, save_dir: </span><span class="r22">str</span><span class="r18">, stopwords_na</span>  
 <span class="r10">  251 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  252 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Load the stopwords from a file. The file should </span>  
 <span class="r10">  253 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  254 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  255 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  256 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        save_dir : str</span><span class="r14">                                  </span>  
 <span class="r10">  257 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The directory where the stopwords file is sa</span>  
 <span class="r10">  258 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        </span><span class="r14">                                                </span>  
 <span class="r10">  259 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        stopwords_name : str, optional</span><span class="r14">                  </span>  
 <span class="r10">  260 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The name of the stopwords file.</span><span class="r14">             </span>  
 <span class="r10">  261 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  262 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        path </span><span class="r20">=</span><span class="r18"> Path(save_dir) </span><span class="r20">/</span><span class="r18"> stopwords_name</span><span class="r14">          </span>  
 <span class="r10">  263 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  264 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(path, </span><span class="r21">&quot;r&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">                      </span>  
 <span class="r10">  265 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stopwords </span><span class="r20">=</span><span class="r18"> json_functions</span><span class="r20">.</span><span class="r18">loads(f</span><span class="r20">.</span><span class="r18">read</span>  
 <span class="r10">  266 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  267 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">streaming_tokenize</span><span class="r18">(</span><span class="r14">                             </span>  
 <span class="r10">  268 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">, texts: List[</span><span class="r22">str</span><span class="r18">], update_vocab: Union[</span><span class="r22">bool</span>  
 <span class="r10">  269 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):</span><span class="r14">                                                  </span>  
 <span class="r10">  270 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  271 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Tokenize a list of strings and return a generato</span>  
 <span class="r10">  272 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  273 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  274 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  275 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        texts : List[str]</span><span class="r14">                               </span>  
 <span class="r10">  276 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            A list of strings to tokenize.</span><span class="r14">              </span>  
 <span class="r10">  277 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  278 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        update_vocab : bool, optional</span><span class="r14">                   </span>  
 <span class="r10">  279 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Whether to update the vocabulary dictionary </span>  
 <span class="r10">  280 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            the different dictionaries making up the voc</span>  
 <span class="r10">  281 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            new tokens. If False, the function will not </span>  
 <span class="r10">  282 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            a stemmer and the stemmed word is in the ste</span>  
 <span class="r10">  283 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            the function will never update the vocabular</span>  
 <span class="r10">  284 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            the stem_to_sid dictionary. Note that update</span>  
 <span class="r10">  285 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            in this method, only in the `tokenize` metho</span>  
 <span class="r10">  286 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        </span><span class="r14">                                                </span>  
 <span class="r10">  287 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        allow_empty : bool, optional</span><span class="r14">                    </span>  
 <span class="r10">  288 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Whether to allow the splitter to return an e</span>  
 <span class="r10">  289 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            will return an empty list, which may cause i</span>  
 <span class="r10">  290 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            an empty list. If True, the splitter will re</span>  
 <span class="r10">  291 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  292 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        stopwords_set </span><span class="r20">=</span><span class="r18"> </span><span class="r22">set</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">stopwords) </span><span class="r15">if</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stop</span>  
 <span class="r10">  293 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        using_stopwords </span><span class="r20">=</span><span class="r18"> stopwords_set </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r14">     </span>  
 <span class="r10">  294 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        using_stemmer </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stemmer </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r14">        </span>  
 <span class="r10">  295 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r14">                                            </span>  
 <span class="r10">  296 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> allow_empty </span><span class="r23">is</span><span class="r18"> </span><span class="r15">True</span><span class="r18"> </span><span class="r23">and</span><span class="r18"> update_vocab </span><span class="r23">is</span><span class="r18"> </span><span class="r15">True</span><span class="r18"> </span>  
 <span class="r10">  297 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            idx </span><span class="r20">=</span><span class="r18"> </span><span class="r22">max</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id</span><span class="r20">.</span><span class="r18">values(), default</span><span class="r20">=</span>  
 <span class="r10">  298 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id[</span><span class="r21">&quot;&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> idx</span><span class="r14">                   </span>  
 <span class="r10">  299 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r14">                                            </span>  
 <span class="r10">  300 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> using_stemmer:</span><span class="r14">                           </span>  
 <span class="r10">  301 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> </span><span class="r21">&quot;&quot;</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r23">in</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_stem:</span><span class="r14">         </span>  
 <span class="r10">  302 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_stem[</span><span class="r21">&quot;&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;&quot;</span><span class="r14">          </span>  
 <span class="r10">  303 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> </span><span class="r21">&quot;&quot;</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r23">in</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stem_to_sid:</span><span class="r14">          </span>  
 <span class="r10">  304 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stem_to_sid[</span><span class="r21">&quot;&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> idx</span><span class="r14">          </span>  
 <span class="r10">  305 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r14">                                                </span>  
 <span class="r10">  306 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> text </span><span class="r23">in</span><span class="r18"> texts:</span><span class="r14">                              </span>  
 <span class="r10">  307 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">lower:</span><span class="r14">                              </span>  
 <span class="r10">  308 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  650M </span>│<span class="r1">▁▁▁▁▁▁▁▁▁   3% </span>│<span class="r12">       </span>│<span class="r18">                text </span><span class="r20">=</span><span class="r18"> text</span><span class="r20">.</span><span class="r18">lower()</span><span class="r14">                     </span>  
 <span class="r10">  309 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  310 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1"> 2.53G </span>│<span class="r1">▁▁▁▁▁▁▁▁▁  11% </span>│<span class="r12">     3 </span>│<span class="r18">            splitted_words </span><span class="r20">=</span><span class="r18"> </span><span class="r22">list</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">splitter(text))</span><span class="r14">  </span>  
 <span class="r10">  311 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  312 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> allow_empty </span><span class="r23">is</span><span class="r18"> </span><span class="r15">True</span><span class="r18"> </span><span class="r23">and</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(splitted_word</span>  
 <span class="r10">  313 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                splitted_words </span><span class="r20">=</span><span class="r18"> [</span><span class="r21">&quot;&quot;</span><span class="r18">]</span><span class="r14">                   </span>  
 <span class="r10">  314 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r14">                                            </span>  
 <span class="r10">  315 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            doc_ids </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                                </span>  
 <span class="r10">  316 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">for</span><span class="r18"> word </span><span class="r23">in</span><span class="r18"> splitted_words:</span><span class="r14">                 </span>  
 <span class="r10">  317 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> word </span><span class="r23">in</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id:</span><span class="r14">             </span>  
 <span class="r10">  318 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    wid </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id[word]</span><span class="r14">         </span>  
 <span class="r10">  319 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    doc_ids</span><span class="r20">.</span><span class="r18">append(wid)</span><span class="r14">                 </span>  
 <span class="r10">  320 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">continue</span><span class="r14">                            </span>  
 <span class="r10">  321 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  322 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> using_stopwords </span><span class="r23">and</span><span class="r18"> word </span><span class="r23">in</span><span class="r18"> stopwords</span>  
 <span class="r10">  323 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">continue</span><span class="r14">                            </span>  
 <span class="r10">  324 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  325 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r26"># We are always updating the word_to_ste</span>  
 <span class="r10">  326 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r26"># words that we have never seen before c</span>  
 <span class="r10">  327 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r26"># possibility that the stemmed ID is alr</span>  
 <span class="r10">  328 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> using_stemmer:</span><span class="r14">                       </span>  
 <span class="r10">  329 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">if</span><span class="r18"> word </span><span class="r23">in</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_stem:</span><span class="r14">       </span>  
 <span class="r10">  330 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        stem </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_stem[word]</span><span class="r14">  </span>  
 <span class="r10">  331 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                               </span>  
 <span class="r10">  332 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  352M </span>│<span class="r1">▁▁▁▁▁▁▁▁▁   1% </span>│<span class="r12">       </span>│<span class="r18">                        stem </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stemmer(word)</span><span class="r14">       </span>  
 <span class="r10">  333 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  157M </span>│<span class="r1">▁▁▁▁▁▁▁▁       </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_stem[word] </span><span class="r20">=</span><span class="r18"> stem</span><span class="r14">  </span>  
 <span class="r10">  334 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  335 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r26"># if the stem is already in the stem</span>  
 <span class="r10">  336 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r26"># and update the word_to_id dictiona</span>  
 <span class="r10">  337 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r26"># in which case we skip this word</span><span class="r14">   </span>  
 <span class="r10">  338 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">if</span><span class="r18"> update_vocab </span><span class="r20">!=</span><span class="r18"> </span><span class="r21">&quot;never&quot;</span><span class="r18"> </span><span class="r23">and</span><span class="r18"> stem </span>  
 <span class="r10">  339 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        sid </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stem_to_sid[stem]</span><span class="r14">    </span>  
 <span class="r10">  340 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id[word] </span><span class="r20">=</span><span class="r18"> sid</span><span class="r14">     </span>  
 <span class="r10">  341 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        doc_ids</span><span class="r20">.</span><span class="r18">append(sid)</span><span class="r14">             </span>  
 <span class="r10">  342 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  343 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">elif</span><span class="r18"> update_vocab </span><span class="r23">is</span><span class="r18"> </span><span class="r15">True</span><span class="r18">:</span><span class="r14">          </span>  
 <span class="r10">  344 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        sid </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">stem_to_sid)</span><span class="r14">     </span>  
 <span class="r10">  345 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  148M </span>│<span class="r1">▁▁▁▁▁▁▁▁       </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stem_to_sid[stem] </span><span class="r20">=</span><span class="r18"> sid</span><span class="r14">    </span>  
 <span class="r10">  346 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  110M </span>│<span class="r1">▁▁▁▁▁▁         </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id[word] </span><span class="r20">=</span><span class="r18"> sid</span><span class="r14">     </span>  
 <span class="r10">  347 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        doc_ids</span><span class="r20">.</span><span class="r18">append(sid)</span><span class="r14">             </span>  
 <span class="r10">  348 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                   </span>  
 <span class="r10">  349 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r26"># if we are not using a stemmer, we </span>  
 <span class="r10">  350 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r26"># directly rather than going through</span>  
 <span class="r10">  351 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">if</span><span class="r18"> update_vocab </span><span class="r23">is</span><span class="r18"> </span><span class="r15">True</span><span class="r18"> </span><span class="r23">and</span><span class="r18"> word </span><span class="r23">not</span>  
 <span class="r10">  352 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        wid </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id)</span><span class="r14">      </span>  
 <span class="r10">  353 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id[word] </span><span class="r20">=</span><span class="r18"> wid</span><span class="r14">     </span>  
 <span class="r10">  354 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        doc_ids</span><span class="r20">.</span><span class="r18">append(wid)</span><span class="r14">             </span>  
 <span class="r10">  355 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  356 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(doc_ids) </span><span class="r20">==</span><span class="r18"> </span><span class="r20">0</span><span class="r18"> </span><span class="r23">and</span><span class="r18"> allow_empty </span><span class="r23">is</span><span class="r18"> </span><span class="r15">True</span>  
 <span class="r10">  357 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                doc_ids </span><span class="r20">=</span><span class="r18"> [</span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id[</span><span class="r21">&quot;&quot;</span><span class="r18">]]</span><span class="r14">         </span>  
 <span class="r10">  358 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r14">                                            </span>  
 <span class="r10">  359 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">yield</span><span class="r18"> doc_ids</span><span class="r14">                               </span>  
 <span class="r10">  360 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  361 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">tokenize</span><span class="r18">(</span><span class="r14">                                       </span>  
 <span class="r10">  362 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r18">,</span><span class="r14">                                           </span>  
 <span class="r10">  363 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        texts: List[</span><span class="r22">str</span><span class="r18">],</span><span class="r14">                               </span>  
 <span class="r10">  364 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        update_vocab: Union[</span><span class="r22">bool</span><span class="r18">, </span><span class="r22">str</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;if_empty&quot;</span><span class="r18">,</span><span class="r14">    </span>  
 <span class="r10">  365 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        leave_progress: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">False</span><span class="r18">,</span><span class="r14">                   </span>  
 <span class="r10">  366 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        show_progress: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r18">,</span><span class="r14">                     </span>  
 <span class="r10">  367 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        length: Union[</span><span class="r22">int</span><span class="r18">, </span><span class="r15">None</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r18">,</span><span class="r14">                </span>  
 <span class="r10">  368 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        return_as: </span><span class="r22">str</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;ids&quot;</span><span class="r18">,</span><span class="r14">                         </span>  
 <span class="r10">  369 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        allow_empty: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r18">,</span><span class="r14">                       </span>  
 <span class="r10">  370 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ) </span><span class="r20">-&gt;</span><span class="r18"> Union[List[List[</span><span class="r22">int</span><span class="r18">]], List[List[</span><span class="r22">str</span><span class="r18">]], typing</span><span class="r20">.</span>  
 <span class="r10">  371 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  372 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Tokenize a list of strings and return the token </span>  
 <span class="r10">  373 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  374 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  375 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  376 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        texts : List[str]</span><span class="r14">                               </span>  
 <span class="r10">  377 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            A list of strings to tokenize.</span><span class="r14">              </span>  
 <span class="r10">  378 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  379 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        update_vocab : bool, optional</span><span class="r14">                   </span>  
 <span class="r10">  380 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Whether to update the vocabulary dictionary </span>  
 <span class="r10">  381 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            the different dictionaries making up the voc</span>  
 <span class="r10">  382 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            new tokens. If False, the vocabulary will no</span>  
 <span class="r10">  383 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            and the stemmed word is in the stem_to_sid d</span>  
 <span class="r10">  384 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            the function will only update the vocabulary</span>  
 <span class="r10">  385 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            function is called for the first time, or if</span>  
 <span class="r10">  386 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            the `reset_vocab` method. If update_vocab=&quot;n</span>  
 <span class="r10">  387 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            be updated, even if the stemmed word is in t</span>  
 <span class="r10">  388 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            this if you are sure that the stemmed words </span>  
 <span class="r10">  389 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  390 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        leave_progress : bool, optional</span><span class="r14">                 </span>  
 <span class="r10">  391 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Whether to leave the progress bar after comp</span>  
 <span class="r10">  392 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            will disappear after completion. If True, th</span>  
 <span class="r10">  393 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  394 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        show_progress : bool, optional</span><span class="r14">                  </span>  
 <span class="r10">  395 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Whether to show the progress bar for tokeniz</span>  
 <span class="r10">  396 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            not show the progress bar. If True, it will </span>  
 <span class="r10">  397 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  398 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        length : int, optional</span><span class="r14">                          </span>  
 <span class="r10">  399 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The length of the texts. If None, the functi</span>  
 <span class="r10">  400 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            This is mainly used when `texts` is a genera</span>  
 <span class="r10">  401 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            `len(texts)` will raise a TypeError, and you</span>  
 <span class="r10">  402 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  403 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        return_as : str, optional</span><span class="r14">                       </span>  
 <span class="r10">  404 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            The type of object to return by this functio</span>  
 <span class="r10">  405 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If &quot;tuple&quot;, this returns a Tokenized namedtu</span>  
 <span class="r10">  406 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            and the vocab dictionary.</span><span class="r14">                   </span>  
 <span class="r10">  407 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If &quot;string&quot;, this return a list of lists of </span>  
 <span class="r10">  408 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If &quot;ids&quot;, this return a list of lists of int</span>  
 <span class="r10">  409 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            or stemmed IDs if a stemmer is used.</span><span class="r14">        </span>  
 <span class="r10">  410 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        </span><span class="r14">                                                </span>  
 <span class="r10">  411 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        allow_empty : bool, optional</span><span class="r14">                    </span>  
 <span class="r10">  412 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            Whether to allow the splitter to return an e</span>  
 <span class="r10">  413 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            will return an empty list, which may cause i</span>  
 <span class="r10">  414 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            an empty list. If True, the splitter will re</span>  
 <span class="r10">  415 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  416 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Returns</span><span class="r14">                                         </span>  
 <span class="r10">  417 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        -------</span><span class="r14">                                         </span>  
 <span class="r10">  418 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        List[List[int]] or Generator[List[int]] or List[</span>  
 <span class="r10">  419 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If `return_as=&quot;stream&quot;`, a Generator[List[in</span>  
 <span class="r10">  420 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If `return_as=&quot;ids&quot;`, a List[List[int]] is r</span>  
 <span class="r10">  421 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If `return_as=&quot;string&quot;`, a List[List[str]] i</span>  
 <span class="r10">  422 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            If `return_as=&quot;tuple&quot;`, a Tokenized namedtup</span>  
 <span class="r10">  423 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  424 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        incorrect_return_error </span><span class="r20">=</span><span class="r18"> (</span><span class="r14">                      </span>  
 <span class="r10">  425 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;return_as must be either &#x27;tuple&#x27;, &#x27;string&#x27;,</span>  
 <span class="r10">  426 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  427 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        incorrect_update_vocab_error </span><span class="r20">=</span><span class="r18"> (</span><span class="r14">                </span>  
 <span class="r10">  428 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;update_vocab must be either True, False, &#x27;i</span>  
 <span class="r10">  429 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  430 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> return_as </span><span class="r23">not</span><span class="r18"> </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;tuple&quot;</span><span class="r18">, </span><span class="r21">&quot;string&quot;</span><span class="r18">, </span><span class="r21">&quot;ids&quot;</span><span class="r18">, </span><span class="r21">&quot;</span>  
 <span class="r10">  431 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(incorrect_return_error)</span><span class="r14">    </span>  
 <span class="r10">  432 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  433 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> update_vocab </span><span class="r23">not</span><span class="r18"> </span><span class="r23">in</span><span class="r18"> [</span><span class="r15">True</span><span class="r18">, </span><span class="r15">False</span><span class="r18">, </span><span class="r21">&quot;if_empty&quot;</span><span class="r18">,</span>  
 <span class="r10">  434 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(incorrect_update_vocab_erro</span>  
 <span class="r10">  435 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  436 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> update_vocab </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;if_empty&quot;</span><span class="r18">:</span><span class="r14">                  </span>  
 <span class="r10">  437 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            update_vocab </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id) </span><span class="r20">==</span><span class="r18"> </span><span class="r20">0</span><span class="r14">    </span>  
 <span class="r10">  438 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  439 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        stream_fn </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">streaming_tokenize(texts</span><span class="r20">=</span><span class="r18">texts,</span>  
 <span class="r10">  440 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  441 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> return_as </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;stream&quot;</span><span class="r18">:</span><span class="r14">                       </span>  
 <span class="r10">  442 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> stream_fn</span><span class="r14">                            </span>  
 <span class="r10">  443 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  444 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> length </span><span class="r23">is</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                              </span>  
 <span class="r10">  445 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            length </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(texts)</span><span class="r14">                         </span>  
 <span class="r10">  446 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  447 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        tqdm_kwargs </span><span class="r20">=</span><span class="r18"> </span><span class="r22">dict</span><span class="r18">(</span><span class="r14">                             </span>  
 <span class="r10">  448 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            desc</span><span class="r20">=</span><span class="r21">&quot;Tokenize texts&quot;</span><span class="r18">,</span><span class="r14">                      </span>  
 <span class="r10">  449 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            leave</span><span class="r20">=</span><span class="r18">leave_progress,</span><span class="r14">                       </span>  
 <span class="r10">  450 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            disable</span><span class="r20">=</span><span class="r23">not</span><span class="r18"> show_progress,</span><span class="r14">                  </span>  
 <span class="r10">  451 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            total</span><span class="r20">=</span><span class="r18">length,</span><span class="r14">                               </span>  
 <span class="r10">  452 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  453 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  454 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        token_ids </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                                  </span>  
 <span class="r10">  455 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     1 </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> doc_ids </span><span class="r23">in</span><span class="r18"> tqdm(stream_fn, </span><span class="r20">**</span><span class="r18">tqdm_kwargs):</span><span class="r14">  </span>  
 <span class="r10">  456 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   73M </span>│<span class="r1">▁▁▁▁▁▁         </span>│<span class="r12">     1 </span>│<span class="r18">            token_ids</span><span class="r20">.</span><span class="r18">append(doc_ids)</span><span class="r14">                   </span>  
 <span class="r10">  457 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  458 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> return_as </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;ids&quot;</span><span class="r18">:</span><span class="r14">                          </span>  
 <span class="r10">  459 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> token_ids</span><span class="r14">                            </span>  
 <span class="r10">  460 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">elif</span><span class="r18"> return_as </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;string&quot;</span><span class="r18">:</span><span class="r14">                     </span>  
 <span class="r10">  461 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">decode(token_ids)</span><span class="r14">               </span>  
 <span class="r10">  462 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">elif</span><span class="r18"> return_as </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;tuple&quot;</span><span class="r18">:</span><span class="r14">                      </span>  
 <span class="r10">  463 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">to_tokenized_tuple(token_ids)</span><span class="r14">   </span>  
 <span class="r10">  464 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  465 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(incorrect_return_error)</span><span class="r14">    </span>  
 <span class="r10">  466 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  467 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">get_vocab_dict</span><span class="r18">(</span><span class="r22">self</span><span class="r18">) </span><span class="r20">-&gt;</span><span class="r18"> Dict[</span><span class="r22">str</span><span class="r18">, Any]:</span><span class="r14">         </span>  
 <span class="r10">  468 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stemmer </span><span class="r23">is</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                        </span>  
 <span class="r10">  469 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># if we are not using a stemmer, we return t</span>  
 <span class="r10">  470 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># which maps the words to the word IDs</span><span class="r14">      </span>  
 <span class="r10">  471 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">word_to_id</span><span class="r14">                      </span>  
 <span class="r10">  472 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  473 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># if we are using a stemmer, we return the s</span>  
 <span class="r10">  474 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># which we will use to map the stemmed words</span>  
 <span class="r10">  475 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">stem_to_sid</span><span class="r14">                     </span>  
 <span class="r10">  476 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  477 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">to_tokenized_tuple</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, docs: List[List[</span><span class="r22">int</span><span class="r18">]]) </span>  
 <span class="r10">  478 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  479 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Convert the token IDs to a Tokenized namedtuple,</span>  
 <span class="r10">  480 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        if a stemmer is used. The Tokenized namedtuple c</span>  
 <span class="r10">  481 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        is a dictionary mapping the token IDs to the tok</span>  
 <span class="r10">  482 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        the stemmed tokens (if a stemmer is used).</span><span class="r14">      </span>  
 <span class="r10">  483 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  484 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> Tokenized(ids</span><span class="r20">=</span><span class="r18">docs, vocab</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">get_vocab_</span>  
 <span class="r10">  485 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  486 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">decode</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, docs: List[List[</span><span class="r22">int</span><span class="r18">]]) </span><span class="r20">-&gt;</span><span class="r18"> List[List</span>  
 <span class="r10">  487 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  488 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Convert word IDs (or stemmed IDs if a stemmer is</span>  
 <span class="r10">  489 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        which is a dictionary mapping the word IDs to th</span>  
 <span class="r10">  490 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        to the stemmed words (if a stemmer is used).</span><span class="r14">    </span>  
 <span class="r10">  491 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  492 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Parameters</span><span class="r14">                                      </span>  
 <span class="r10">  493 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----------</span><span class="r14">                                      </span>  
 <span class="r10">  494 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        docs : List[List[int]]</span><span class="r14">                          </span>  
 <span class="r10">  495 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            A list of lists of word IDs or stemmed IDs.</span><span class="r14"> </span>  
 <span class="r10">  496 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  497 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Returns</span><span class="r14">                                         </span>  
 <span class="r10">  498 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        -------</span><span class="r14">                                         </span>  
 <span class="r10">  499 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        List[List[str]]</span><span class="r14">                                 </span>  
 <span class="r10">  500 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">            A list of lists of strings, each string bein</span>  
 <span class="r10">  501 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  502 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        vocab </span><span class="r20">=</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">get_vocab_dict()</span><span class="r14">                   </span>  
 <span class="r10">  503 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        reverse_vocab </span><span class="r20">=</span><span class="r18"> {v: k </span><span class="r15">for</span><span class="r18"> k, v </span><span class="r23">in</span><span class="r18"> vocab</span><span class="r20">.</span><span class="r18">items()}</span>  
 <span class="r10">  504 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> [[reverse_vocab[token_id] </span><span class="r15">for</span><span class="r18"> token_id </span><span class="r23">in</span>  
 <span class="r10">  505 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  506 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  507 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">convert_tokenized_to_string_list</span><span class="r18">(tokenized: Tokenize</span>  
 <span class="r10">  508 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  509 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Convert the token IDs back to strings using the voca</span>  
 <span class="r10">  510 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  511 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    reverse_vocab </span><span class="r20">=</span><span class="r18"> {v: k </span><span class="r15">for</span><span class="r18"> k, v </span><span class="r23">in</span><span class="r18"> tokenized</span><span class="r20">.</span><span class="r18">vocab</span><span class="r20">.</span><span class="r18">it</span>  
 <span class="r10">  512 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  513 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> [</span><span class="r14">                                            </span>  
 <span class="r10">  514 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        [reverse_vocab[token_id] </span><span class="r15">for</span><span class="r18"> token_id </span><span class="r23">in</span><span class="r18"> doc_ids</span>  
 <span class="r10">  515 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ]</span><span class="r14">                                                   </span>  
 <span class="r10">  516 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  517 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  518 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">_infer_stopwords</span><span class="r18">(stopwords: Union[</span><span class="r22">str</span><span class="r18">, List[</span><span class="r22">str</span><span class="r18">]]) </span><span class="r20">-</span>  
 <span class="r10">  519 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># Source of stopwords: https://github.com/nltk/nltk/</span>  
 <span class="r10">  520 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;english&quot;</span><span class="r18">, </span><span class="r21">&quot;en&quot;</span><span class="r18">, </span><span class="r15">True</span><span class="r18">]:  </span><span class="r26"># True is </span>  
 <span class="r10">  521 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_EN</span><span class="r14">                             </span>  
 <span class="r10">  522 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;english_plus&quot;</span><span class="r18">, </span><span class="r21">&quot;en_plus&quot;</span><span class="r18">]:</span><span class="r14">      </span>  
 <span class="r10">  523 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_EN_PLUS</span><span class="r14">                        </span>  
 <span class="r10">  524 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;german&quot;</span><span class="r18">, </span><span class="r21">&quot;de&quot;</span><span class="r18">]:</span><span class="r14">                 </span>  
 <span class="r10">  525 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_GERMAN</span><span class="r14">                         </span>  
 <span class="r10">  526 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;dutch&quot;</span><span class="r18">, </span><span class="r21">&quot;nl&quot;</span><span class="r18">]:</span><span class="r14">                  </span>  
 <span class="r10">  527 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_DUTCH</span><span class="r14">                          </span>  
 <span class="r10">  528 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;french&quot;</span><span class="r18">, </span><span class="r21">&quot;fr&quot;</span><span class="r18">]:</span><span class="r14">                 </span>  
 <span class="r10">  529 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_FRENCH</span><span class="r14">                         </span>  
 <span class="r10">  530 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;spanish&quot;</span><span class="r18">, </span><span class="r21">&quot;es&quot;</span><span class="r18">]:</span><span class="r14">                </span>  
 <span class="r10">  531 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_SPANISH</span><span class="r14">                        </span>  
 <span class="r10">  532 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;portuguese&quot;</span><span class="r18">, </span><span class="r21">&quot;pt&quot;</span><span class="r18">]:</span><span class="r14">             </span>  
 <span class="r10">  533 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_PORTUGUESE</span><span class="r14">                     </span>  
 <span class="r10">  534 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;italian&quot;</span><span class="r18">, </span><span class="r21">&quot;it&quot;</span><span class="r18">]:</span><span class="r14">                </span>  
 <span class="r10">  535 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_ITALIAN</span><span class="r14">                        </span>  
 <span class="r10">  536 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;russian&quot;</span><span class="r18">, </span><span class="r21">&quot;ru&quot;</span><span class="r18">]:</span><span class="r14">                </span>  
 <span class="r10">  537 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_RUSSIAN</span><span class="r14">                        </span>  
 <span class="r10">  538 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;swedish&quot;</span><span class="r18">, </span><span class="r21">&quot;sv&quot;</span><span class="r18">]:</span><span class="r14">                </span>  
 <span class="r10">  539 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_SWEDISH</span><span class="r14">                        </span>  
 <span class="r10">  540 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;norwegian&quot;</span><span class="r18">, </span><span class="r21">&quot;no&quot;</span><span class="r18">]:</span><span class="r14">              </span>  
 <span class="r10">  541 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_NORWEGIAN</span><span class="r14">                      </span>  
 <span class="r10">  542 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;chinese&quot;</span><span class="r18">, </span><span class="r21">&quot;zh&quot;</span><span class="r18">]:</span><span class="r14">                </span>  
 <span class="r10">  543 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> STOPWORDS_CHINESE</span><span class="r14">                        </span>  
 <span class="r10">  544 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> stopwords </span><span class="r23">in</span><span class="r18"> [</span><span class="r15">None</span><span class="r18">, </span><span class="r15">False</span><span class="r18">]:</span><span class="r14">                    </span>  
 <span class="r10">  545 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> []</span><span class="r14">                                       </span>  
 <span class="r10">  546 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">elif</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(stopwords, </span><span class="r22">str</span><span class="r18">):</span><span class="r14">                    </span>  
 <span class="r10">  547 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r14">                               </span>  
 <span class="r10">  548 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">f&quot;</span><span class="r25">{</span><span class="r18">stopwords</span><span class="r25">}</span><span class="r21"> not recognized. Only English s</span>  
 <span class="r10">  549 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;Please input a list of stopwords&quot;</span><span class="r14">          </span>  
 <span class="r10">  550 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  551 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                               </span>  
 <span class="r10">  552 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> stopwords</span><span class="r14">                                </span>  
 <span class="r10">  553 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  554 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  555 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">tokenize</span><span class="r18">(</span><span class="r14">                                           </span>  
 <span class="r10">  556 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    texts: Union[</span><span class="r22">str</span><span class="r18">, List[</span><span class="r22">str</span><span class="r18">]],</span><span class="r14">                       </span>  
 <span class="r10">  557 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    lower: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r18">,</span><span class="r14">                                 </span>  
 <span class="r10">  558 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    token_pattern: </span><span class="r22">str</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r21">r&quot;(?u)\b\w\w+\b&quot;</span><span class="r18">,</span><span class="r14">              </span>  
 <span class="r10">  559 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    stopwords: Union[</span><span class="r22">str</span><span class="r18">, List[</span><span class="r22">str</span><span class="r18">]] </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;english&quot;</span><span class="r18">,</span><span class="r14">       </span>  
 <span class="r10">  560 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    stemmer: Callable </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r18">,  </span><span class="r26"># type: ignore</span><span class="r14">           </span>  
 <span class="r10">  561 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    return_ids: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r18">,</span><span class="r14">                            </span>  
 <span class="r10">  562 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    show_progress: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r18">,</span><span class="r14">                         </span>  
 <span class="r10">  563 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    leave: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">False</span><span class="r18">,</span><span class="r14">                                </span>  
 <span class="r10">  564 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    allow_empty: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r18">,</span><span class="r14">                           </span>  
 <span class="r10">  565 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">) </span><span class="r20">-&gt;</span><span class="r18"> Union[List[List[</span><span class="r22">str</span><span class="r18">]], Tokenized]:</span><span class="r14">                 </span>  
 <span class="r10">  566 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  567 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Tokenize a list using the same method as the scikit-</span>  
 <span class="r10">  568 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    and optionally apply a stemmer to the tokens or stop</span>  
 <span class="r10">  569 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  570 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    If you provide stemmer, it must have a `stemWords` m</span>  
 <span class="r10">  571 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    that takes a list of strings and returns a list of s</span>  
 <span class="r10">  572 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    can only be called on a single word, you can use a l</span>  
 <span class="r10">  573 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    e.g. `lambda lst: list(map(stemmer.stem, lst))`.</span><span class="r14">    </span>  
 <span class="r10">  574 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  575 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    If return_ids is True, the function will return a na</span>  
 <span class="r10">  576 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    IDs and (2) the token_to_index dictionary. You can a</span>  
 <span class="r10">  577 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    the `ids` attribute and the token_to_index dictionar</span>  
 <span class="r10">  578 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    You can also destructure the namedtuple to get the i</span>  
 <span class="r10">  579 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    e.g. `token_ids, vocab = tokenize(...)`.</span><span class="r14">            </span>  
 <span class="r10">  580 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  581 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Parameters</span><span class="r14">                                          </span>  
 <span class="r10">  582 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    ----------</span><span class="r14">                                          </span>  
 <span class="r10">  583 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    texts : Union[str, List[str]]</span><span class="r14">                       </span>  
 <span class="r10">  584 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        A list of strings to tokenize. If a single strin</span>  
 <span class="r10">  585 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        converted to a list with a single element.</span><span class="r14">      </span>  
 <span class="r10">  586 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  587 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    lower : bool, optional</span><span class="r14">                              </span>  
 <span class="r10">  588 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Whether to convert the text to lowercase before </span>  
 <span class="r10">  589 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  590 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    token_pattern : str, optional</span><span class="r14">                       </span>  
 <span class="r10">  591 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        The regex pattern to use for tokenization, by de</span>  
 <span class="r10">  592 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  593 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    stopwords : Union[str, List[str]], optional</span><span class="r14">         </span>  
 <span class="r10">  594 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        The list of stopwords to remove from the text. I</span>  
 <span class="r10">  595 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        the function will use the default English stopwo</span>  
 <span class="r10">  596 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  597 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    stemmer : Callable, optional</span><span class="r14">                        </span>  
 <span class="r10">  598 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        The stemmer to use for stemming the tokens. It i</span>  
 <span class="r10">  599 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        to use the PyStemmer library for stemming, but y</span>  
 <span class="r10">  600 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        takes a list of strings and returns a list of st</span>  
 <span class="r10">  601 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  602 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    return_ids : bool, optional</span><span class="r14">                         </span>  
 <span class="r10">  603 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Whether to return the tokenized IDs and the voca</span>  
 <span class="r10">  604 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        function will return the tokenized strings. If T</span>  
 <span class="r10">  605 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        a namedtuple with the tokenized IDs and the voca</span>  
 <span class="r10">  606 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  607 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    show_progress : bool, optional</span><span class="r14">                      </span>  
 <span class="r10">  608 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Whether to show the progress bar for tokenizatio</span>  
 <span class="r10">  609 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        not show the progress bar. If True, it will use </span>  
 <span class="r10">  610 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  611 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    leave : bool, optional</span><span class="r14">                              </span>  
 <span class="r10">  612 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Whether to leave the progress bar after completi</span>  
 <span class="r10">  613 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        will disappear after completion. If True, the pr</span>  
 <span class="r10">  614 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  615 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    allow_empty : bool, optional</span><span class="r14">                        </span>  
 <span class="r10">  616 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Whether to allow the splitter to return an empty</span>  
 <span class="r10">  617 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        will return an empty list, which may cause issue</span>  
 <span class="r10">  618 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        an empty list. If True, the splitter will return</span>  
 <span class="r10">  619 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Note</span><span class="r14">                                                </span>  
 <span class="r10">  620 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    -----</span><span class="r14">                                               </span>  
 <span class="r10">  621 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    You may pass a single string or a list of strings. I</span>  
 <span class="r10">  622 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    this function will convert it to a list of strings w</span>  
 <span class="r10">  623 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  624 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(texts, </span><span class="r22">str</span><span class="r18">):</span><span class="r14">                          </span>  
 <span class="r10">  625 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        texts </span><span class="r20">=</span><span class="r18"> [texts]</span><span class="r14">                                 </span>  
 <span class="r10">  626 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  627 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    split_fn </span><span class="r20">=</span><span class="r18"> re</span><span class="r20">.</span><span class="r18">compile(token_pattern)</span><span class="r20">.</span><span class="r18">findall</span><span class="r14">        </span>  
 <span class="r10">  628 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    stopwords </span><span class="r20">=</span><span class="r18"> _infer_stopwords(stopwords)</span><span class="r14">             </span>  
 <span class="r10">  629 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  630 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># Step 1: Split the strings using the regex pattern</span><span class="r14"> </span>  
 <span class="r10">  631 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    corpus_ids </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                                     </span>  
 <span class="r10">  632 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    token_to_index </span><span class="r20">=</span><span class="r18"> {}</span><span class="r14">                                 </span>  
 <span class="r10">  633 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  634 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> text </span><span class="r23">in</span><span class="r18"> tqdm(</span><span class="r14">                                   </span>  
 <span class="r10">  635 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        texts, desc</span><span class="r20">=</span><span class="r21">&quot;Split strings&quot;</span><span class="r18">, leave</span><span class="r20">=</span><span class="r18">leave, disabl</span>  
 <span class="r10">  636 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ):  </span><span class="r14">                                                </span>  
 <span class="r10">  637 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        stopwords_set </span><span class="r20">=</span><span class="r18"> </span><span class="r22">set</span><span class="r18">(stopwords)</span><span class="r14">                  </span>  
 <span class="r10">  638 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> lower:</span><span class="r14">                                       </span>  
 <span class="r10">  639 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            text </span><span class="r20">=</span><span class="r18"> text</span><span class="r20">.</span><span class="r18">lower()</span><span class="r14">                         </span>  
 <span class="r10">  640 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  641 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        splitted </span><span class="r20">=</span><span class="r18"> split_fn(text)</span><span class="r14">                       </span>  
 <span class="r10">  642 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  643 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> allow_empty </span><span class="r23">is</span><span class="r18"> </span><span class="r15">False</span><span class="r18"> </span><span class="r23">and</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(splitted) </span><span class="r20">==</span><span class="r18"> </span><span class="r20">0</span><span class="r18">:</span><span class="r14"> </span>  
 <span class="r10">  644 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            splitted </span><span class="r20">=</span><span class="r18"> [</span><span class="r21">&quot;&quot;</span><span class="r18">]</span><span class="r14">                             </span>  
 <span class="r10">  645 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r14">                                                </span>  
 <span class="r10">  646 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        doc_ids </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                                    </span>  
 <span class="r10">  647 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  648 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> token </span><span class="r23">in</span><span class="r18"> splitted:</span><span class="r14">                          </span>  
 <span class="r10">  649 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> token </span><span class="r23">in</span><span class="r18"> stopwords_set:</span><span class="r14">                  </span>  
 <span class="r10">  650 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">continue</span><span class="r14">                                </span>  
 <span class="r10">  651 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  652 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> token </span><span class="r23">not</span><span class="r18"> </span><span class="r23">in</span><span class="r18"> token_to_index:</span><span class="r14">             </span>  
 <span class="r10">  653 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                token_to_index[token] </span><span class="r20">=</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(token_to_ind</span>  
 <span class="r10">  654 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  655 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            token_id </span><span class="r20">=</span><span class="r18"> token_to_index[token]</span><span class="r14">            </span>  
 <span class="r10">  656 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            doc_ids</span><span class="r20">.</span><span class="r18">append(token_id)</span><span class="r14">                    </span>  
 <span class="r10">  657 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  658 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus_ids</span><span class="r20">.</span><span class="r18">append(doc_ids)</span><span class="r14">                      </span>  
 <span class="r10">  659 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  660 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># Create a list of unique tokens that we will use to</span>  
 <span class="r10">  661 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    unique_tokens </span><span class="r20">=</span><span class="r18"> </span><span class="r22">list</span><span class="r18">(token_to_index</span><span class="r20">.</span><span class="r18">keys())</span><span class="r14">         </span>  
 <span class="r10">  662 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  663 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># Step 2: Stem the tokens if a stemmer is provided</span><span class="r14">  </span>  
 <span class="r10">  664 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> stemmer </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                             </span>  
 <span class="r10">  665 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">hasattr</span><span class="r18">(stemmer, </span><span class="r21">&quot;stemWords&quot;</span><span class="r18">):</span><span class="r14">               </span>  
 <span class="r10">  666 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            stemmer_fn </span><span class="r20">=</span><span class="r18"> stemmer</span><span class="r20">.</span><span class="r18">stemWords</span><span class="r14">              </span>  
 <span class="r10">  667 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">elif</span><span class="r18"> </span><span class="r22">callable</span><span class="r18">(stemmer):</span><span class="r14">                         </span>  
 <span class="r10">  668 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            stemmer_fn </span><span class="r20">=</span><span class="r18"> stemmer</span><span class="r14">                        </span>  
 <span class="r10">  669 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  670 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            error_msg </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;Stemmer must have a `stemWord` </span>  
 <span class="r10">  671 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(error_msg)</span><span class="r14">                 </span>  
 <span class="r10">  672 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  673 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Now, we use the stemmer on the token_to_index </span>  
 <span class="r10">  674 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        tokens_stemmed </span><span class="r20">=</span><span class="r18"> stemmer_fn(unique_tokens)</span><span class="r14">      </span>  
 <span class="r10">  675 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        vocab </span><span class="r20">=</span><span class="r18"> </span><span class="r22">set</span><span class="r18">(tokens_stemmed)</span><span class="r14">                     </span>  
 <span class="r10">  676 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        vocab_dict </span><span class="r20">=</span><span class="r18"> {token: i </span><span class="r15">for</span><span class="r18"> i, token </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span>  
 <span class="r10">  677 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        stem_id_to_stem </span><span class="r20">=</span><span class="r18"> {v: k </span><span class="r15">for</span><span class="r18"> k, v </span><span class="r23">in</span><span class="r18"> vocab_dict</span><span class="r20">.</span><span class="r18">i</span>  
 <span class="r10">  678 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># We create a dictionary mapping the stemmed tok</span>  
 <span class="r10">  679 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        doc_id_to_stem_id </span><span class="r20">=</span><span class="r18"> {</span><span class="r14">                           </span>  
 <span class="r10">  680 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            token_to_index[token]: vocab_dict[stem]</span><span class="r14">     </span>  
 <span class="r10">  681 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">for</span><span class="r18"> token, stem </span><span class="r23">in</span><span class="r18"> </span><span class="r22">zip</span><span class="r18">(unique_tokens, tokens</span>  
 <span class="r10">  682 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        }</span><span class="r14">                                               </span>  
 <span class="r10">  683 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  684 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Now, we simply need to replace the tokens in t</span>  
 <span class="r10">  685 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> i, doc_ids </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span><span class="r18">(</span><span class="r14">                    </span>  
 <span class="r10">  686 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            tqdm(corpus_ids, desc</span><span class="r20">=</span><span class="r21">&quot;Stem Tokens&quot;</span><span class="r18">, leave</span><span class="r20">=</span><span class="r18">l</span>  
 <span class="r10">  687 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        ):</span><span class="r14">                                              </span>  
 <span class="r10">  688 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            corpus_ids[i] </span><span class="r20">=</span><span class="r18"> [doc_id_to_stem_id[doc_id] </span><span class="r15">f</span>  
 <span class="r10">  689 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                               </span>  
 <span class="r10">  690 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        vocab_dict </span><span class="r20">=</span><span class="r18"> token_to_index</span><span class="r14">                     </span>  
 <span class="r10">  691 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  692 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># Step 3: Return the tokenized IDs and the vocab dic</span>  
 <span class="r10">  693 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> return_ids:</span><span class="r14">                                      </span>  
 <span class="r10">  694 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> Tokenized(ids</span><span class="r20">=</span><span class="r18">corpus_ids, vocab</span><span class="r20">=</span><span class="r18">vocab_dic</span>  
 <span class="r10">  695 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                               </span>  
 <span class="r10">  696 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># We need a reverse dictionary to convert the to</span>  
 <span class="r10">  697 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        reverse_dict </span><span class="r20">=</span><span class="r18"> stem_id_to_stem </span><span class="r15">if</span><span class="r18"> stemmer </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span>  
 <span class="r10">  698 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># We convert the token IDs back to tokens in-pla</span>  
 <span class="r10">  699 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> i, token_ids </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span><span class="r18">(</span><span class="r14">                  </span>  
 <span class="r10">  700 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            tqdm(</span><span class="r14">                                       </span>  
 <span class="r10">  701 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                corpus_ids,</span><span class="r14">                             </span>  
 <span class="r10">  702 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                desc</span><span class="r20">=</span><span class="r21">&quot;Reconstructing token strings&quot;</span><span class="r18">,</span><span class="r14">    </span>  
 <span class="r10">  703 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                leave</span><span class="r20">=</span><span class="r18">leave,</span><span class="r14">                            </span>  
 <span class="r10">  704 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                disable</span><span class="r20">=</span><span class="r23">not</span><span class="r18"> show_progress,</span><span class="r14">              </span>  
 <span class="r10">  705 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  706 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        ):</span><span class="r14">                                              </span>  
 <span class="r10">  707 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            corpus_ids[i] </span><span class="r20">=</span><span class="r18"> [reverse_dict[token_id] </span><span class="r15">for</span><span class="r18"> </span>  
 <span class="r10">  708 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> corpus_ids</span><span class="r14">                               </span>  
 <span class="r10">  709 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
       ╵       ╵       ╵       ╵        ╵       ╵               ╵       ╵                                                          
Top PEAK memory consumption, by line:
<span class="r1">(1)   310:  2590 MB</span>                                                                                                                 
<span class="r1">(2)   308:   650 MB</span>                                                                                                                 
<span class="r1">(3)   332:   352 MB</span>                                                                                                                 
<span class="r1">(4)   202:   193 MB</span>                                                                                                                 
<span class="r1">(5)   333:   157 MB</span>                                                                                                                 
Possible memory leak identified at line <span class="r29">310</span> <span class="r2">(</span>estimated likelihood: <span class="r29">100</span>%, velocity:   <span class="r29">0</span> MB/s<span class="r2">)</span>
Possible memory leak identified at line <span class="r29">308</span> <span class="r2">(</span>estimated likelihood:  <span class="r29">98</span>%, velocity:   <span class="r29">0</span> MB/s<span class="r2">)</span>
Possible memory leak identified at line <span class="r29">332</span> <span class="r2">(</span>estimated likelihood:  <span class="r29">97</span>%, velocity:   <span class="r29">0</span> MB/s<span class="r2">)</span>
<span class="r30">                /home/team-054/dkozlov/bm25s/bm25s/utils/beir.py: % of time =   0.00% (0.000ms) out of 21m:32.451s.                </span>
       ╷       ╷       ╷       ╷        ╷       ╷               ╷       ╷                                                          
 <span class="r2">      </span>│<span class="r3">Time</span><span class="r2">   </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r4">Memory</span><span class="r2">  </span>│<span class="r4">––––––</span><span class="r2"> </span>│<span class="r4">–––––––––––</span><span class="r2">    </span>│<span class="r5">Copy</span><span class="r2">   </span>│<span class="r2">                                                         </span> 
 <span class="r2"> </span><span class="r6">Line</span><span class="r2"> </span>│<span class="r7">Python</span><span class="r2"> </span>│<span class="r7">native</span><span class="r2"> </span>│<span class="r7">system</span><span class="r2"> </span>│<span class="r8">Python</span><span class="r2">  </span>│<span class="r8">peak</span><span class="r2">   </span>│<span class="r8">timeline</span><span class="r4">/%</span><span class="r2">     </span>│<span class="r9">(MB/s)</span><span class="r2"> </span>│<span class="r2">/home/team-054/dkozlov/bm25s/bm25s/utils/beir.py         </span> 
╺━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r10">    1 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">logging</span><span class="r14">                                          </span>  
 <span class="r10">    2 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">pathlib</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> Path</span><span class="r14">                                </span>  
 <span class="r10">    3 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">typing</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> Dict, List, Tuple</span><span class="r14">                    </span>  
 <span class="r10">    4 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    5 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">try</span><span class="r18">:</span><span class="r14">                                                    </span>  
 <span class="r10">    6 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">from</span><span class="r16"> </span><span class="r17">tqdm.auto</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> tqdm</span><span class="r14">                          </span>  
 <span class="r10">    7 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">except</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">:</span><span class="r14">                                     </span>  
 <span class="r10">    8 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    9 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">tqdm</span><span class="r18">(iterable, </span><span class="r20">*</span><span class="r18">args, </span><span class="r20">**</span><span class="r18">kwargs):</span><span class="r14">                </span>  
 <span class="r10">   10 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> iterable</span><span class="r14">                                 </span>  
 <span class="r10">   11 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   12 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   13 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">.</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> json_functions</span><span class="r14">                            </span>  
 <span class="r10">   14 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   15 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">BASE_URL </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;https://public.ukp.informatik.tu-darmstadt.d</span>  
 <span class="r10">   16 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">GH_URL </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;https://github.com/xhluca/bm25s/releases/downl</span>  
 <span class="r10">   17 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   18 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   19 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">clean_results_keys</span><span class="r18">(beir_results):</span><span class="r14">                   </span>  
 <span class="r10">   20 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> {k</span><span class="r20">.</span><span class="r18">split(</span><span class="r21">&quot;@&quot;</span><span class="r18">)[</span><span class="r20">-1</span><span class="r18">]: v </span><span class="r15">for</span><span class="r18"> k, v </span><span class="r23">in</span><span class="r18"> beir_results</span>  
 <span class="r10">   21 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   22 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   23 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">postprocess_results_for_eval</span><span class="r18">(results, scores, query_</span>  
 <span class="r10">   24 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">   25 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Given the queried results and scores output by BM25S</span>  
 <span class="r10">   26 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    to be compatible with BEIR evaluation functions.</span><span class="r14">    </span>  
 <span class="r10">   27 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    query_ids is a list of query ids in the same order a</span>  
 <span class="r10">   28 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">   29 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   30 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    results_record </span><span class="r20">=</span><span class="r18"> [</span><span class="r14">                                  </span>  
 <span class="r10">   31 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        {</span><span class="r21">&quot;id&quot;</span><span class="r18">: qid, </span><span class="r21">&quot;hits&quot;</span><span class="r18">: results[i], </span><span class="r21">&quot;scores&quot;</span><span class="r18">: </span><span class="r22">list</span><span class="r18">(s</span>  
 <span class="r10">   32 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> i, qid </span><span class="r23">in</span><span class="r18"> </span><span class="r22">enumerate</span><span class="r18">(query_ids)</span><span class="r14">              </span>  
 <span class="r10">   33 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ]</span><span class="r14">                                                   </span>  
 <span class="r10">   34 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   35 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    result_dict_for_eval </span><span class="r20">=</span><span class="r18"> {</span><span class="r14">                            </span>  
 <span class="r10">   36 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        res[</span><span class="r21">&quot;id&quot;</span><span class="r18">]: {</span><span class="r14">                                    </span>  
 <span class="r10">   37 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            docid: </span><span class="r22">float</span><span class="r18">(score) </span><span class="r15">for</span><span class="r18"> docid, score </span><span class="r23">in</span><span class="r18"> </span><span class="r22">zip</span><span class="r18">(</span>  
 <span class="r10">   38 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        }</span><span class="r14">                                               </span>  
 <span class="r10">   39 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> res </span><span class="r23">in</span><span class="r18"> results_record</span><span class="r14">                       </span>  
 <span class="r10">   40 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    }</span><span class="r14">                                                   </span>  
 <span class="r10">   41 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   42 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> result_dict_for_eval</span><span class="r14">                         </span>  
 <span class="r10">   43 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   44 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   45 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">merge_cqa_dupstack</span><span class="r18">(data_path):</span><span class="r14">                      </span>  
 <span class="r10">   46 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    data_path </span><span class="r20">=</span><span class="r18"> Path(data_path)</span><span class="r14">                         </span>  
 <span class="r10">   47 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    dataset </span><span class="r20">=</span><span class="r18"> data_path</span><span class="r20">.</span><span class="r18">name</span><span class="r14">                            </span>  
 <span class="r10">   48 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">assert</span><span class="r18"> dataset </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;cqadupstack&quot;</span><span class="r18">, </span><span class="r21">&quot;Dataset must be CQ</span>  
 <span class="r10">   49 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   50 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># check if corpus.jsonl exists</span><span class="r14">                      </span>  
 <span class="r10">   51 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    corpus_path </span><span class="r20">=</span><span class="r18"> data_path </span><span class="r20">/</span><span class="r18"> </span><span class="r21">&quot;corpus.jsonl&quot;</span><span class="r14">            </span>  
 <span class="r10">   52 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> corpus_path</span><span class="r20">.</span><span class="r18">exists():</span><span class="r14">                        </span>  
 <span class="r10">   53 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># combine all the corpus files into one</span><span class="r14">         </span>  
 <span class="r10">   54 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># corpus files are located under cqadupstack/&lt;na</span>  
 <span class="r10">   55 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        corpus_files </span><span class="r20">=</span><span class="r18"> </span><span class="r22">list</span><span class="r18">(data_path</span><span class="r20">.</span><span class="r18">glob(</span><span class="r21">&quot;*/corpus.jso</span>  
 <span class="r10">   56 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(corpus_path, </span><span class="r21">&quot;w&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">               </span>  
 <span class="r10">   57 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">for</span><span class="r18"> file </span><span class="r23">in</span><span class="r18"> tqdm(corpus_files, desc</span><span class="r20">=</span><span class="r21">&quot;Merging</span>  
 <span class="r10">   58 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r26"># get the name of the corpus</span><span class="r14">            </span>  
 <span class="r10">   59 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                corpus_name </span><span class="r20">=</span><span class="r18"> file</span><span class="r20">.</span><span class="r18">parent</span><span class="r20">.</span><span class="r18">name</span><span class="r14">          </span>  
 <span class="r10">   60 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   61 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(file, </span><span class="r21">&quot;r&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f2:</span><span class="r14">             </span>  
 <span class="r10">   62 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">for</span><span class="r18"> line </span><span class="r23">in</span><span class="r18"> tqdm(</span><span class="r14">                   </span>  
 <span class="r10">   63 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        f2, desc</span><span class="r20">=</span><span class="r21">f&quot;Merging </span><span class="r25">{</span><span class="r18">corpus_name</span><span class="r25">}</span>  
 <span class="r10">   64 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    ):</span><span class="r14">                                  </span>  
 <span class="r10">   65 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        line </span><span class="r20">=</span><span class="r18"> json_functions</span><span class="r20">.</span><span class="r18">loads(line</span>  
 <span class="r10">   66 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r26"># add the corpus name to _id</span><span class="r14">    </span>  
 <span class="r10">   67 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        line[</span><span class="r21">&quot;_id&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r21">f&quot;</span><span class="r25">{</span><span class="r18">corpus_name</span><span class="r25">}</span><span class="r21">_</span><span class="r25">{</span><span class="r18">l</span>  
 <span class="r10">   68 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r26"># write back to file</span><span class="r14">            </span>  
 <span class="r10">   69 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        f</span><span class="r20">.</span><span class="r18">write(json_functions</span><span class="r20">.</span><span class="r18">dumps(lin</span>  
 <span class="r10">   70 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        f</span><span class="r20">.</span><span class="r18">write(</span><span class="r21">&quot;</span><span class="r33">\n</span><span class="r21">&quot;</span><span class="r18">)</span><span class="r14">                   </span>  
 <span class="r10">   71 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   72 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># now, do the same for queries.jsonl</span><span class="r14">                </span>  
 <span class="r10">   73 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    queries_path </span><span class="r20">=</span><span class="r18"> data_path </span><span class="r20">/</span><span class="r18"> </span><span class="r21">&quot;queries.jsonl&quot;</span><span class="r14">          </span>  
 <span class="r10">   74 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> queries_path</span><span class="r20">.</span><span class="r18">exists():</span><span class="r14">                       </span>  
 <span class="r10">   75 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        queries_files </span><span class="r20">=</span><span class="r18"> </span><span class="r22">list</span><span class="r18">(data_path</span><span class="r20">.</span><span class="r18">glob(</span><span class="r21">&quot;*/queries.j</span>  
 <span class="r10">   76 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(queries_path, </span><span class="r21">&quot;w&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">              </span>  
 <span class="r10">   77 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">for</span><span class="r18"> file </span><span class="r23">in</span><span class="r18"> tqdm(queries_files, desc</span><span class="r20">=</span><span class="r21">&quot;Mergin</span>  
 <span class="r10">   78 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r26"># get the name of the corpus</span><span class="r14">            </span>  
 <span class="r10">   79 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                corpus_name </span><span class="r20">=</span><span class="r18"> file</span><span class="r20">.</span><span class="r18">parent</span><span class="r20">.</span><span class="r18">name</span><span class="r14">          </span>  
 <span class="r10">   80 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   81 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(file, </span><span class="r21">&quot;r&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f2:</span><span class="r14">             </span>  
 <span class="r10">   82 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">for</span><span class="r18"> line </span><span class="r23">in</span><span class="r18"> tqdm(</span><span class="r14">                   </span>  
 <span class="r10">   83 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        f2, desc</span><span class="r20">=</span><span class="r21">f&quot;Merging </span><span class="r25">{</span><span class="r18">corpus_name</span><span class="r25">}</span>  
 <span class="r10">   84 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    ):</span><span class="r14">                                  </span>  
 <span class="r10">   85 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        line </span><span class="r20">=</span><span class="r18"> json_functions</span><span class="r20">.</span><span class="r18">loads(line</span>  
 <span class="r10">   86 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r26"># add the corpus name to _id</span><span class="r14">    </span>  
 <span class="r10">   87 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        line[</span><span class="r21">&quot;_id&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r21">f&quot;</span><span class="r25">{</span><span class="r18">corpus_name</span><span class="r25">}</span><span class="r21">_</span><span class="r25">{</span><span class="r18">l</span>  
 <span class="r10">   88 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r26"># write back to file</span><span class="r14">            </span>  
 <span class="r10">   89 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        f</span><span class="r20">.</span><span class="r18">write(json_functions</span><span class="r20">.</span><span class="r18">dumps(lin</span>  
 <span class="r10">   90 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        f</span><span class="r20">.</span><span class="r18">write(</span><span class="r21">&quot;</span><span class="r33">\n</span><span class="r21">&quot;</span><span class="r18">)</span><span class="r14">                   </span>  
 <span class="r10">   91 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   92 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># now, do the same for qrels/test.tsv</span><span class="r14">               </span>  
 <span class="r10">   93 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    qrels_path </span><span class="r20">=</span><span class="r18"> data_path </span><span class="r20">/</span><span class="r18"> </span><span class="r21">&quot;qrels&quot;</span><span class="r18"> </span><span class="r20">/</span><span class="r18"> </span><span class="r21">&quot;test.tsv&quot;</span><span class="r14">       </span>  
 <span class="r10">   94 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    qrels_path</span><span class="r20">.</span><span class="r18">parent</span><span class="r20">.</span><span class="r18">mkdir(parents</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, exist_ok</span><span class="r20">=</span><span class="r15">True</span><span class="r18">)</span>  
 <span class="r10">   95 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   96 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> qrels_path</span><span class="r20">.</span><span class="r18">exists():</span><span class="r14">                         </span>  
 <span class="r10">   97 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        qrels_files </span><span class="r20">=</span><span class="r18"> </span><span class="r22">list</span><span class="r18">(data_path</span><span class="r20">.</span><span class="r18">glob(</span><span class="r21">&quot;*/qrels/test.</span>  
 <span class="r10">   98 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(qrels_path, </span><span class="r21">&quot;w&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">                </span>  
 <span class="r10">   99 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># First, write the columns: query-id    corp</span>  
 <span class="r10">  100 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            f</span><span class="r20">.</span><span class="r18">write(</span><span class="r21">&quot;query-id</span><span class="r33">\t</span><span class="r21">corpus-id</span><span class="r33">\t</span><span class="r21">score</span><span class="r33">\n</span><span class="r21">&quot;</span><span class="r18">)</span><span class="r14">     </span>  
 <span class="r10">  101 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">for</span><span class="r18"> file </span><span class="r23">in</span><span class="r18"> tqdm(qrels_files, desc</span><span class="r20">=</span><span class="r21">&quot;Merging </span>  
 <span class="r10">  102 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r26"># get the name of the corpus</span><span class="r14">            </span>  
 <span class="r10">  103 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                corpus_name </span><span class="r20">=</span><span class="r18"> file</span><span class="r20">.</span><span class="r18">parent</span><span class="r20">.</span><span class="r18">parent</span><span class="r20">.</span><span class="r18">name</span><span class="r14">   </span>  
 <span class="r10">  104 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(file, </span><span class="r21">&quot;r&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f2:</span><span class="r14">             </span>  
 <span class="r10">  105 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r26"># skip first line</span><span class="r14">                   </span>  
 <span class="r10">  106 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r22">next</span><span class="r18">(f2)</span><span class="r14">                            </span>  
 <span class="r10">  107 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  108 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">for</span><span class="r18"> line </span><span class="r23">in</span><span class="r18"> tqdm(</span><span class="r14">                   </span>  
 <span class="r10">  109 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        f2, desc</span><span class="r20">=</span><span class="r21">f&quot;Merging </span><span class="r25">{</span><span class="r18">corpus_name</span><span class="r25">}</span>  
 <span class="r10">  110 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    ):</span><span class="r14">                                  </span>  
 <span class="r10">  111 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r26"># since it&#x27;s a tsv, split by tab</span>  
 <span class="r10">  112 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        qid, cid, score </span><span class="r20">=</span><span class="r18"> line</span><span class="r20">.</span><span class="r18">strip()</span><span class="r20">.</span><span class="r18">s</span>  
 <span class="r10">  113 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r26"># add the corpus name to _id</span><span class="r14">    </span>  
 <span class="r10">  114 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        qid </span><span class="r20">=</span><span class="r18"> </span><span class="r21">f&quot;</span><span class="r25">{</span><span class="r18">corpus_name</span><span class="r25">}</span><span class="r21">_</span><span class="r25">{</span><span class="r18">qid</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r14">    </span>  
 <span class="r10">  115 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        cid </span><span class="r20">=</span><span class="r18"> </span><span class="r21">f&quot;</span><span class="r25">{</span><span class="r18">corpus_name</span><span class="r25">}</span><span class="r21">_</span><span class="r25">{</span><span class="r18">cid</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r14">    </span>  
 <span class="r10">  116 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        </span><span class="r26"># write back to file</span><span class="r14">            </span>  
 <span class="r10">  117 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                        f</span><span class="r20">.</span><span class="r18">write(</span><span class="r21">f&quot;</span><span class="r25">{</span><span class="r18">qid</span><span class="r25">}</span><span class="r33">\t</span><span class="r25">{</span><span class="r18">cid</span><span class="r25">}</span><span class="r33">\t</span><span class="r25">{</span><span class="r18">score</span><span class="r25">}</span><span class="r33">\</span>  
 <span class="r10">  118 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  119 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  120 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">download_dataset</span><span class="r18">(</span><span class="r14">                                   </span>  
 <span class="r10">  121 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    dataset,</span><span class="r14">                                            </span>  
 <span class="r10">  122 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    base_url</span><span class="r20">=</span><span class="r18">GH_URL,</span><span class="r14">                                    </span>  
 <span class="r10">  123 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    save_dir</span><span class="r20">=</span><span class="r21">&quot;./datasets&quot;</span><span class="r18">,</span><span class="r14">                              </span>  
 <span class="r10">  124 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    unzip</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                                         </span>  
 <span class="r10">  125 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    redownload</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                                   </span>  
 <span class="r10">  126 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    show_progress</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                                 </span>  
 <span class="r10">  127 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">):</span><span class="r14">                                                      </span>  
 <span class="r10">  128 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">import</span><span class="r16"> </span><span class="r17">urllib.request</span><span class="r14">                               </span>  
 <span class="r10">  129 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">import</span><span class="r16"> </span><span class="r17">zipfile</span><span class="r14">                                      </span>  
 <span class="r10">  130 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">from</span><span class="r16"> </span><span class="r17">pathlib</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> Path</span><span class="r14">                            </span>  
 <span class="r10">  131 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">from</span><span class="r16"> </span><span class="r17">tqdm.auto</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> tqdm</span><span class="r14">                          </span>  
 <span class="r10">  132 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  133 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    save_dir </span><span class="r20">=</span><span class="r18"> Path(save_dir)</span><span class="r14">                           </span>  
 <span class="r10">  134 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    save_dir</span><span class="r20">.</span><span class="r18">mkdir(parents</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, exist_ok</span><span class="r20">=</span><span class="r15">True</span><span class="r18">)</span><span class="r14">         </span>  
 <span class="r10">  135 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  136 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    url </span><span class="r20">=</span><span class="r18"> base_url</span><span class="r20">.</span><span class="r18">format(dataset)</span><span class="r14">                      </span>  
 <span class="r10">  137 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># check if zip file already exist</span><span class="r14">                   </span>  
 <span class="r10">  138 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    save_zip_path </span><span class="r20">=</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> </span><span class="r21">&quot;archive&quot;</span><span class="r18"> </span><span class="r20">/</span><span class="r18"> </span><span class="r21">f&quot;</span><span class="r25">{</span><span class="r18">dataset</span><span class="r25">}</span><span class="r21">.z</span>  
 <span class="r10">  139 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    save_zip_path</span><span class="r20">.</span><span class="r18">parent</span><span class="r20">.</span><span class="r18">mkdir(parents</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, exist_ok</span><span class="r20">=</span><span class="r15">Tr</span>  
 <span class="r10">  140 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  141 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> save_zip_path</span><span class="r20">.</span><span class="r18">exists() </span><span class="r23">or</span><span class="r18"> redownload:</span><span class="r14">        </span>  
 <span class="r10">  142 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># download the zip file and save it with tqdm pr</span>  
 <span class="r10">  143 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        pbar </span><span class="r20">=</span><span class="r18"> tqdm(</span><span class="r14">                                    </span>  
 <span class="r10">  144 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            unit</span><span class="r20">=</span><span class="r21">&quot;B&quot;</span><span class="r18">,</span><span class="r14">                                   </span>  
 <span class="r10">  145 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            unit_scale</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                            </span>  
 <span class="r10">  146 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            desc</span><span class="r20">=</span><span class="r21">f&quot;Downloading </span><span class="r25">{</span><span class="r18">dataset</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">,</span><span class="r14">              </span>  
 <span class="r10">  147 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            leave</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                                </span>  
 <span class="r10">  148 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            disable</span><span class="r20">=</span><span class="r23">not</span><span class="r18"> show_progress,</span><span class="r14">                  </span>  
 <span class="r10">  149 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  150 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(save_zip_path, </span><span class="r21">&quot;wb&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">            </span>  
 <span class="r10">  151 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            response </span><span class="r20">=</span><span class="r18"> urllib</span><span class="r20">.</span><span class="r18">request</span><span class="r20">.</span><span class="r18">urlopen(url)</span><span class="r14">      </span>  
 <span class="r10">  152 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            total_size </span><span class="r20">=</span><span class="r18"> </span><span class="r22">int</span><span class="r18">(response</span><span class="r20">.</span><span class="r18">headers</span><span class="r20">.</span><span class="r18">get(</span><span class="r21">&quot;conte</span>  
 <span class="r10">  153 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            block_size </span><span class="r20">=</span><span class="r18"> </span><span class="r20">8192</span><span class="r18"> </span><span class="r20">*</span><span class="r18"> </span><span class="r20">2</span><span class="r14">                       </span>  
 <span class="r10">  154 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># set the tqdm total to the total size</span><span class="r14">      </span>  
 <span class="r10">  155 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            pbar</span><span class="r20">.</span><span class="r18">total </span><span class="r20">=</span><span class="r18"> total_size</span><span class="r14">                     </span>  
 <span class="r10">  156 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">while</span><span class="r18"> </span><span class="r15">True</span><span class="r18">:</span><span class="r14">                                 </span>  
 <span class="r10">  157 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                buffer </span><span class="r20">=</span><span class="r18"> response</span><span class="r20">.</span><span class="r18">read(block_size)</span><span class="r14">      </span>  
 <span class="r10">  158 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> buffer:</span><span class="r14">                          </span>  
 <span class="r10">  159 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r15">break</span><span class="r14">                               </span>  
 <span class="r10">  160 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                f</span><span class="r20">.</span><span class="r18">write(buffer)</span><span class="r14">                         </span>  
 <span class="r10">  161 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                pbar</span><span class="r20">.</span><span class="r18">update(</span><span class="r22">len</span><span class="r18">(buffer))</span><span class="r14">                </span>  
 <span class="r10">  162 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  163 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        pbar</span><span class="r20">.</span><span class="r18">close()</span><span class="r14">                                    </span>  
 <span class="r10">  164 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  165 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># now that we have the zip file, extract it</span><span class="r14">         </span>  
 <span class="r10">  166 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> unzip:</span><span class="r14">                                           </span>  
 <span class="r10">  167 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">with</span><span class="r18"> zipfile</span><span class="r20">.</span><span class="r18">ZipFile(save_zip_path, </span><span class="r21">&quot;r&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> zip_</span>  
 <span class="r10">  168 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   10M </span>│<span class="r1">▁              </span>│<span class="r12">    11 </span>│<span class="r18">            zip_ref</span><span class="r20">.</span><span class="r18">extractall(save_dir)</span><span class="r14">                </span>  
 <span class="r10">  169 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  170 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># if it&#x27;s CQADupStack, merge the corpus, queries</span>  
 <span class="r10">  171 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> dataset </span><span class="r20">==</span><span class="r18"> </span><span class="r21">&quot;cqadupstack&quot;</span><span class="r18">:</span><span class="r14">                    </span>  
 <span class="r10">  172 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            merge_cqa_dupstack(save_dir </span><span class="r20">/</span><span class="r18"> dataset)</span><span class="r14">      </span>  
 <span class="r10">  173 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  174 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> save_dir </span><span class="r20">/</span><span class="r18"> dataset</span><span class="r14">                       </span>  
 <span class="r10">  175 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                               </span>  
 <span class="r10">  176 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> save_zip_path</span><span class="r14">                            </span>  
 <span class="r10">  177 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  178 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  179 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">load_jsonl</span><span class="r18">(</span><span class="r14">                                         </span>  
 <span class="r10">  180 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    dataset,</span><span class="r14">                                            </span>  
 <span class="r10">  181 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    fname,</span><span class="r14">                                              </span>  
 <span class="r10">  182 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    save_dir</span><span class="r20">=</span><span class="r21">&quot;./datasets&quot;</span><span class="r18">,</span><span class="r14">                              </span>  
 <span class="r10">  183 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    show_progress</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                                 </span>  
 <span class="r10">  184 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    return_dict</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                                   </span>  
 <span class="r10">  185 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    force_title</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                                  </span>  
 <span class="r10">  186 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    remove</span><span class="r20">=</span><span class="r15">None</span><span class="r18">,</span><span class="r14">                                        </span>  
 <span class="r10">  187 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">):</span><span class="r14">                                                      </span>  
 <span class="r10">  188 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    dataset_path </span><span class="r20">=</span><span class="r18"> Path(save_dir) </span><span class="r20">/</span><span class="r18"> dataset</span><span class="r14">             </span>  
 <span class="r10">  189 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    corpus_path </span><span class="r20">=</span><span class="r18"> dataset_path </span><span class="r20">/</span><span class="r18"> fname</span><span class="r14">                  </span>  
 <span class="r10">  190 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  191 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> corpus_path</span><span class="r20">.</span><span class="r18">exists():</span><span class="r14">                        </span>  
 <span class="r10">  192 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">FileNotFoundError</span><span class="r18">(</span><span class="r21">f&quot;Corpus file not found </span>  
 <span class="r10">  193 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  194 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    corpus </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                                         </span>  
 <span class="r10">  195 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(corpus_path, </span><span class="r21">&quot;r&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">                   </span>  
 <span class="r10">  196 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># get the number of bytes in the file</span><span class="r14">           </span>  
 <span class="r10">  197 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     3 </span>│<span class="r18">        num_lines </span><span class="r20">=</span><span class="r18"> </span><span class="r22">sum</span><span class="r18">(</span><span class="r20">1</span><span class="r18"> </span><span class="r15">for</span><span class="r18"> i </span><span class="r23">in</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(corpus_path, </span><span class="r21">&quot;rb</span>  
 <span class="r10">  198 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        pbar </span><span class="r20">=</span><span class="r18"> tqdm(</span><span class="r14">                                    </span>  
 <span class="r10">  199 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            f,</span><span class="r14">                                          </span>  
 <span class="r10">  200 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            desc</span><span class="r20">=</span><span class="r21">&quot;[</span><span class="r25">{}</span><span class="r21">] loading </span><span class="r25">{}</span><span class="r21">&quot;</span><span class="r20">.</span><span class="r18">format(dataset, fname</span>  
 <span class="r10">  201 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            leave</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                                </span>  
 <span class="r10">  202 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            disable</span><span class="r20">=</span><span class="r23">not</span><span class="r18"> show_progress,</span><span class="r14">                  </span>  
 <span class="r10">  203 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            total</span><span class="r20">=</span><span class="r18">num_lines,</span><span class="r14">                            </span>  
 <span class="r10">  204 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  205 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1"> 2.92G </span>│<span class="r1">▁▁▁▁▁▁▁▁▁  12% </span>│<span class="r12">     5 </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> line </span><span class="r23">in</span><span class="r18"> pbar:</span><span class="r14">                               </span>  
 <span class="r10">  206 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1"> 4.05G </span>│<span class="r1">▁▁▁▁▁▁▁▁▁  17% </span>│<span class="r12">     4 </span>│<span class="r18">            line </span><span class="r20">=</span><span class="r18"> json_functions</span><span class="r20">.</span><span class="r18">loads(line)</span><span class="r14">           </span>  
 <span class="r10">  207 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     1 </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> force_title:</span><span class="r14">                             </span>  
 <span class="r10">  208 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">                line[</span><span class="r21">&quot;title&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> line</span><span class="r20">.</span><span class="r18">get(</span><span class="r21">&quot;title&quot;</span><span class="r18">)</span><span class="r14">       </span>  
 <span class="r10">  209 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> remove </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                      </span>  
 <span class="r10">  210 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     3 </span>│<span class="r18">                </span><span class="r15">for</span><span class="r18"> key </span><span class="r23">in</span><span class="r18"> remove:</span><span class="r14">                      </span>  
 <span class="r10">  211 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">                    </span><span class="r15">del</span><span class="r18"> line[key]</span><span class="r14">                       </span>  
 <span class="r10">  212 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   93M </span>│<span class="r1">▁▁▁▁▁▁▁▁       </span>│<span class="r12">     2 </span>│<span class="r18">            corpus</span><span class="r20">.</span><span class="r18">append(line)</span><span class="r14">                         </span>  
 <span class="r10">  213 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># update the progress bar wrt the number of </span>  
 <span class="r10">  214 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  215 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> return_dict:</span><span class="r14">                                     </span>  
 <span class="r10">  216 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  311M </span>│<span class="r1">▁▁▁▁▁▁▁▁▁   2% </span>│<span class="r12">     2 </span>│<span class="r18">        corpus </span><span class="r20">=</span><span class="r18"> {doc</span><span class="r20">.</span><span class="r18">pop(</span><span class="r21">&quot;_id&quot;</span><span class="r18">): doc </span><span class="r15">for</span><span class="r18"> doc </span><span class="r23">in</span><span class="r18"> corpus}</span>  
 <span class="r10">  217 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  218 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> corpus</span><span class="r14">                                       </span>  
 <span class="r10">  219 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  220 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  221 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">load_corpus</span><span class="r18">(dataset, save_dir</span><span class="r20">=</span><span class="r21">&quot;./datasets&quot;</span><span class="r18">, show_pro</span>  
 <span class="r10">  222 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> load_jsonl(</span><span class="r14">                                  </span>  
 <span class="r10">  223 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        dataset</span><span class="r20">=</span><span class="r18">dataset,</span><span class="r14">                                </span>  
 <span class="r10">  224 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir</span><span class="r20">=</span><span class="r18">save_dir,</span><span class="r14">                              </span>  
 <span class="r10">  225 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        show_progress</span><span class="r20">=</span><span class="r18">show_progress,</span><span class="r14">                    </span>  
 <span class="r10">  226 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        return_dict</span><span class="r20">=</span><span class="r18">return_dict,</span><span class="r14">                        </span>  
 <span class="r10">  227 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        fname</span><span class="r20">=</span><span class="r21">&quot;corpus.jsonl&quot;</span><span class="r18">,</span><span class="r14">                           </span>  
 <span class="r10">  228 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        force_title</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                               </span>  
 <span class="r10">  229 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        remove</span><span class="r20">=</span><span class="r18">[</span><span class="r21">&quot;metadata&quot;</span><span class="r18">],</span><span class="r14">                            </span>  
 <span class="r10">  230 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    )</span><span class="r14">                                                   </span>  
 <span class="r10">  231 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  232 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  233 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">load_queries</span><span class="r18">(dataset, save_dir</span><span class="r20">=</span><span class="r21">&quot;./datasets&quot;</span><span class="r18">, show_pr</span>  
 <span class="r10">  234 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> load_jsonl(</span><span class="r14">                                  </span>  
 <span class="r10">  235 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        dataset</span><span class="r20">=</span><span class="r18">dataset,</span><span class="r14">                                </span>  
 <span class="r10">  236 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        save_dir</span><span class="r20">=</span><span class="r18">save_dir,</span><span class="r14">                              </span>  
 <span class="r10">  237 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        show_progress</span><span class="r20">=</span><span class="r18">show_progress,</span><span class="r14">                    </span>  
 <span class="r10">  238 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        return_dict</span><span class="r20">=</span><span class="r18">return_dict,</span><span class="r14">                        </span>  
 <span class="r10">  239 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        fname</span><span class="r20">=</span><span class="r21">&quot;queries.jsonl&quot;</span><span class="r18">,</span><span class="r14">                          </span>  
 <span class="r10">  240 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        force_title</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                              </span>  
 <span class="r10">  241 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        remove</span><span class="r20">=</span><span class="r18">[</span><span class="r21">&quot;metadata&quot;</span><span class="r18">],</span><span class="r14">                            </span>  
 <span class="r10">  242 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    )</span><span class="r14">                                                   </span>  
 <span class="r10">  243 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  244 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  245 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">load_qrels</span><span class="r18">(</span><span class="r14">                                         </span>  
 <span class="r10">  246 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    dataset, split</span><span class="r20">=</span><span class="r21">&quot;test&quot;</span><span class="r18">, save_dir</span><span class="r20">=</span><span class="r21">&quot;./datasets&quot;</span><span class="r18">, show_p</span>  
 <span class="r10">  247 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">):</span><span class="r14">                                                      </span>  
 <span class="r10">  248 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  249 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    This is tsv files</span><span class="r14">                                   </span>  
 <span class="r10">  250 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  251 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> split </span><span class="r23">not</span><span class="r18"> </span><span class="r23">in</span><span class="r18"> [</span><span class="r21">&quot;train&quot;</span><span class="r18">, </span><span class="r21">&quot;dev&quot;</span><span class="r18">, </span><span class="r21">&quot;test&quot;</span><span class="r18">]:</span><span class="r14">           </span>  
 <span class="r10">  252 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ValueError</span><span class="r18">(</span><span class="r21">&quot;split must be one of [&#x27;train&#x27;,</span>  
 <span class="r10">  253 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  254 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    dataset_path </span><span class="r20">=</span><span class="r18"> Path(save_dir) </span><span class="r20">/</span><span class="r18"> dataset</span><span class="r14">             </span>  
 <span class="r10">  255 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    qrels_path </span><span class="r20">=</span><span class="r18"> dataset_path </span><span class="r20">/</span><span class="r18"> </span><span class="r21">&quot;qrels&quot;</span><span class="r18"> </span><span class="r20">/</span><span class="r18"> </span><span class="r21">f&quot;</span><span class="r25">{</span><span class="r18">split</span><span class="r25">}</span><span class="r21">.tsv&quot;</span>  
 <span class="r10">  256 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  257 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> qrels_path</span><span class="r20">.</span><span class="r18">exists():</span><span class="r14">                         </span>  
 <span class="r10">  258 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">FileNotFoundError</span><span class="r18">(</span><span class="r21">f&quot;Qrels file not found a</span>  
 <span class="r10">  259 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  260 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    qrels </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                                          </span>  
 <span class="r10">  261 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(qrels_path, </span><span class="r21">&quot;r&quot;</span><span class="r18">) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">                    </span>  
 <span class="r10">  262 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># skip first line</span><span class="r14">                               </span>  
 <span class="r10">  263 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">next</span><span class="r18">(f)</span><span class="r14">                                         </span>  
 <span class="r10">  264 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> line </span><span class="r23">in</span><span class="r18"> tqdm(</span><span class="r14">                               </span>  
 <span class="r10">  265 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            f,</span><span class="r14">                                          </span>  
 <span class="r10">  266 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            desc</span><span class="r20">=</span><span class="r21">&quot;Loading Qrels </span><span class="r25">{}</span><span class="r21">&quot;</span><span class="r20">.</span><span class="r18">format(dataset),</span><span class="r14">    </span>  
 <span class="r10">  267 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            leave</span><span class="r20">=</span><span class="r15">False</span><span class="r18">,</span><span class="r14">                                </span>  
 <span class="r10">  268 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            disable</span><span class="r20">=</span><span class="r23">not</span><span class="r18"> show_progress,</span><span class="r14">                  </span>  
 <span class="r10">  269 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        ):</span><span class="r14">                                              </span>  
 <span class="r10">  270 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            qid, cid, score </span><span class="r20">=</span><span class="r18"> line</span><span class="r20">.</span><span class="r18">strip()</span><span class="r20">.</span><span class="r18">split(</span><span class="r21">&quot;</span><span class="r33">\t</span><span class="r21">&quot;</span><span class="r18">)</span><span class="r14">  </span>  
 <span class="r10">  271 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            qrels</span><span class="r20">.</span><span class="r18">append((qid, cid, </span><span class="r22">int</span><span class="r18">(score)))</span><span class="r14">        </span>  
 <span class="r10">  272 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  273 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> return_dict:</span><span class="r14">                                     </span>  
 <span class="r10">  274 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        qrels </span><span class="r20">=</span><span class="r18"> {qid: {cid: score} </span><span class="r15">for</span><span class="r18"> qid, cid, score </span><span class="r23">i</span>  
 <span class="r10">  275 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  276 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> qrels</span><span class="r14">                                        </span>  
 <span class="r10">  277 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  278 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  279 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">evaluate</span><span class="r18">(</span><span class="r14">                                           </span>  
 <span class="r10">  280 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    qrels: Dict[</span><span class="r22">str</span><span class="r18">, Dict[</span><span class="r22">str</span><span class="r18">, </span><span class="r22">int</span><span class="r18">]],</span><span class="r14">                   </span>  
 <span class="r10">  281 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    results: Dict[</span><span class="r22">str</span><span class="r18">, Dict[</span><span class="r22">str</span><span class="r18">, </span><span class="r22">float</span><span class="r18">]],</span><span class="r14">               </span>  
 <span class="r10">  282 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    k_values: List[</span><span class="r22">int</span><span class="r18">],</span><span class="r14">                                </span>  
 <span class="r10">  283 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ignore_identical_ids: </span><span class="r22">bool</span><span class="r18"> </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r18">,</span><span class="r14">                  </span>  
 <span class="r10">  284 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">) </span><span class="r20">-&gt;</span><span class="r18"> Tuple[Dict[</span><span class="r22">str</span><span class="r18">, </span><span class="r22">float</span><span class="r18">], Dict[</span><span class="r22">str</span><span class="r18">, </span><span class="r22">float</span><span class="r18">], Dict[</span><span class="r22">str</span><span class="r18">,</span>  
 <span class="r10">  285 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  286 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Acknowledgement: This function is adapted from BEIR&#x27;</span>  
 <span class="r10">  287 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    License for this function: Apache-2.0</span><span class="r14">               </span>  
 <span class="r10">  288 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  289 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">try</span><span class="r18">:</span><span class="r14">                                                </span>  
 <span class="r10">  290 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">import</span><span class="r16"> </span><span class="r17">pytrec_eval</span><span class="r14">                              </span>  
 <span class="r10">  291 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r14">                                                    </span>  
 <span class="r10">  292 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">except</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">:</span><span class="r14">                                 </span>  
 <span class="r10">  293 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">(</span><span class="r14">                              </span>  
 <span class="r10">  294 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;Please install pytrec_eval to use this func</span>  
 <span class="r10">  295 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  296 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  297 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> ignore_identical_ids:</span><span class="r14">                            </span>  
 <span class="r10">  298 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        logging</span><span class="r20">.</span><span class="r18">info(</span><span class="r14">                                   </span>  
 <span class="r10">  299 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r21">&quot;For evaluation, we ignore identical query a</span>  
 <span class="r10">  300 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">  301 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        popped </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                                     </span>  
 <span class="r10">  302 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> qid, rels </span><span class="r23">in</span><span class="r18"> results</span><span class="r20">.</span><span class="r18">items():</span><span class="r14">               </span>  
 <span class="r10">  303 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">for</span><span class="r18"> pid </span><span class="r23">in</span><span class="r18"> </span><span class="r22">list</span><span class="r18">(rels):</span><span class="r14">                      </span>  
 <span class="r10">  304 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                </span><span class="r15">if</span><span class="r18"> qid </span><span class="r20">==</span><span class="r18"> pid:</span><span class="r14">                          </span>  
 <span class="r10">  305 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    results[qid]</span><span class="r20">.</span><span class="r18">pop(pid)</span><span class="r14">               </span>  
 <span class="r10">  306 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    popped</span><span class="r20">.</span><span class="r18">append(pid)</span><span class="r14">                  </span>  
 <span class="r10">  307 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  308 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ndcg </span><span class="r20">=</span><span class="r18"> {}</span><span class="r14">                                           </span>  
 <span class="r10">  309 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    _map </span><span class="r20">=</span><span class="r18"> {}</span><span class="r14">                                           </span>  
 <span class="r10">  310 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    recall </span><span class="r20">=</span><span class="r18"> {}</span><span class="r14">                                         </span>  
 <span class="r10">  311 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    precision </span><span class="r20">=</span><span class="r18"> {}</span><span class="r14">                                      </span>  
 <span class="r10">  312 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  313 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> k </span><span class="r23">in</span><span class="r18"> k_values:</span><span class="r14">                                  </span>  
 <span class="r10">  314 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        ndcg[</span><span class="r21">f&quot;NDCG@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r20">0.0</span><span class="r14">                         </span>  
 <span class="r10">  315 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        _map[</span><span class="r21">f&quot;MAP@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r20">0.0</span><span class="r14">                          </span>  
 <span class="r10">  316 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        recall[</span><span class="r21">f&quot;Recall@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r20">0.0</span><span class="r14">                     </span>  
 <span class="r10">  317 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        precision[</span><span class="r21">f&quot;P@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r20">0.0</span><span class="r14">                       </span>  
 <span class="r10">  318 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  319 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    map_string </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;map_cut.&quot;</span><span class="r18"> </span><span class="r20">+</span><span class="r18"> </span><span class="r21">&quot;,&quot;</span><span class="r20">.</span><span class="r18">join([</span><span class="r22">str</span><span class="r18">(k) </span><span class="r15">for</span><span class="r18"> k </span><span class="r23">in</span><span class="r18"> </span>  
 <span class="r10">  320 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ndcg_string </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;ndcg_cut.&quot;</span><span class="r18"> </span><span class="r20">+</span><span class="r18"> </span><span class="r21">&quot;,&quot;</span><span class="r20">.</span><span class="r18">join([</span><span class="r22">str</span><span class="r18">(k) </span><span class="r15">for</span><span class="r18"> k </span><span class="r23">i</span>  
 <span class="r10">  321 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    recall_string </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;recall.&quot;</span><span class="r18"> </span><span class="r20">+</span><span class="r18"> </span><span class="r21">&quot;,&quot;</span><span class="r20">.</span><span class="r18">join([</span><span class="r22">str</span><span class="r18">(k) </span><span class="r15">for</span><span class="r18"> k </span><span class="r23">i</span>  
 <span class="r10">  322 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    precision_string </span><span class="r20">=</span><span class="r18"> </span><span class="r21">&quot;P.&quot;</span><span class="r18"> </span><span class="r20">+</span><span class="r18"> </span><span class="r21">&quot;,&quot;</span><span class="r20">.</span><span class="r18">join([</span><span class="r22">str</span><span class="r18">(k) </span><span class="r15">for</span><span class="r18"> k </span><span class="r23">in</span><span class="r18"> </span>  
 <span class="r10">  323 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    evaluator </span><span class="r20">=</span><span class="r18"> pytrec_eval</span><span class="r20">.</span><span class="r18">RelevanceEvaluator(</span><span class="r14">         </span>  
 <span class="r10">  324 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        qrels, {map_string, ndcg_string, recall_string, </span>  
 <span class="r10">  325 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    )</span><span class="r14">                                                   </span>  
 <span class="r10">  326 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    scores </span><span class="r20">=</span><span class="r18"> evaluator</span><span class="r20">.</span><span class="r18">evaluate(results)</span><span class="r14">                </span>  
 <span class="r10">  327 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  328 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> query_id </span><span class="r23">in</span><span class="r18"> scores</span><span class="r20">.</span><span class="r18">keys():</span><span class="r14">                      </span>  
 <span class="r10">  329 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> k </span><span class="r23">in</span><span class="r18"> k_values:</span><span class="r14">                              </span>  
 <span class="r10">  330 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            ndcg[</span><span class="r21">f&quot;NDCG@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">+=</span><span class="r18"> scores[query_id][</span><span class="r21">&quot;ndcg_</span>  
 <span class="r10">  331 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            _map[</span><span class="r21">f&quot;MAP@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">+=</span><span class="r18"> scores[query_id][</span><span class="r21">&quot;map_cu</span>  
 <span class="r10">  332 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            recall[</span><span class="r21">f&quot;Recall@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">+=</span><span class="r18"> scores[query_id][</span><span class="r21">&quot;r</span>  
 <span class="r10">  333 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            precision[</span><span class="r21">f&quot;P@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">+=</span><span class="r18"> scores[query_id][</span><span class="r21">&quot;P_&quot;</span>  
 <span class="r10">  334 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  335 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> k </span><span class="r23">in</span><span class="r18"> k_values:</span><span class="r14">                                  </span>  
 <span class="r10">  336 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        ndcg[</span><span class="r21">f&quot;NDCG@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r22">round</span><span class="r18">(ndcg[</span><span class="r21">f&quot;NDCG@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">/</span><span class="r18"> </span><span class="r22">le</span>  
 <span class="r10">  337 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        _map[</span><span class="r21">f&quot;MAP@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r22">round</span><span class="r18">(_map[</span><span class="r21">f&quot;MAP@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">/</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(</span>  
 <span class="r10">  338 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        recall[</span><span class="r21">f&quot;Recall@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r22">round</span><span class="r18">(recall[</span><span class="r21">f&quot;Recall@</span><span class="r25">{</span><span class="r18">k</span>  
 <span class="r10">  339 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        precision[</span><span class="r21">f&quot;P@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span><span class="r20">=</span><span class="r18"> </span><span class="r22">round</span><span class="r18">(precision[</span><span class="r21">f&quot;P@</span><span class="r25">{</span><span class="r18">k</span><span class="r25">}</span><span class="r21">&quot;</span><span class="r18">] </span>  
 <span class="r10">  340 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  341 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">for</span><span class="r18"> </span><span class="r22">eval</span><span class="r18"> </span><span class="r23">in</span><span class="r18"> [ndcg, _map, recall, precision]:</span><span class="r14">        </span>  
 <span class="r10">  342 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        logging</span><span class="r20">.</span><span class="r18">info(</span><span class="r21">&quot;</span><span class="r33">\n</span><span class="r21">&quot;</span><span class="r18">)</span><span class="r14">                              </span>  
 <span class="r10">  343 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">for</span><span class="r18"> k </span><span class="r23">in</span><span class="r18"> </span><span class="r22">eval</span><span class="r20">.</span><span class="r18">keys():</span><span class="r14">                           </span>  
 <span class="r10">  344 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            logging</span><span class="r20">.</span><span class="r18">info(</span><span class="r21">&quot;</span><span class="r25">{}</span><span class="r21">: </span><span class="r25">{:.4f}</span><span class="r21">&quot;</span><span class="r20">.</span><span class="r18">format(k, </span><span class="r22">eval</span><span class="r18">[k])</span>  
 <span class="r10">  345 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  346 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> ndcg, _map, recall, precision</span><span class="r14">                </span>  
 <span class="r10">  347 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
       ╵       ╵       ╵       ╵        ╵       ╵               ╵       ╵                                                          
Top PEAK memory consumption, by line:
<span class="r1">(1)   206:  4150 MB</span>                                                                                                                 
<span class="r1">(2)   205:  2991 MB</span>                                                                                                                 
<span class="r1">(3)   216:   311 MB</span>                                                                                                                 
<span class="r1">(4)   212:    93 MB</span>                                                                                                                 
<span class="r1">(5)   168:    10 MB</span>                                                                                                                 
Possible memory leak identified at line <span class="r29">206</span> <span class="r2">(</span>estimated likelihood: <span class="r29">100</span>%, velocity:   <span class="r29">0</span> MB/s<span class="r2">)</span>
Possible memory leak identified at line <span class="r29">205</span> <span class="r2">(</span>estimated likelihood: <span class="r29">100</span>%, velocity:   <span class="r29">0</span> MB/s<span class="r2">)</span>
<span class="r30">               /home/team-054/dkozlov/bm25s/bm25s/utils/corpus.py: % of time =   0.00% (0.000ms) out of 21m:32.451s.               </span>
       ╷       ╷       ╷       ╷        ╷       ╷               ╷       ╷                                                          
 <span class="r2">      </span>│<span class="r3">Time</span><span class="r2">   </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r4">Memory</span><span class="r2">  </span>│<span class="r4">––––––</span><span class="r2"> </span>│<span class="r4">–––––––––––</span><span class="r2">    </span>│<span class="r5">Copy</span><span class="r2">   </span>│<span class="r2">                                                         </span> 
 <span class="r2"> </span><span class="r6">Line</span><span class="r2"> </span>│<span class="r7">Python</span><span class="r2"> </span>│<span class="r7">native</span><span class="r2"> </span>│<span class="r7">system</span><span class="r2"> </span>│<span class="r8">Python</span><span class="r2">  </span>│<span class="r8">peak</span><span class="r2">   </span>│<span class="r8">timeline</span><span class="r4">/%</span><span class="r2">     </span>│<span class="r9">(MB/s)</span><span class="r2"> </span>│<span class="r2">/home/team-054/dkozlov/bm25s/bm25s/utils/corpus.py       </span> 
╺━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r10">    1 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">logging</span><span class="r14">                                          </span>  
 <span class="r10">    2 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">mmap</span><span class="r14">                                             </span>  
 <span class="r10">    3 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">os</span><span class="r14">                                               </span>  
 <span class="r10">    4 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    5 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">numpy</span><span class="r16"> </span><span class="r15">as</span><span class="r16"> </span><span class="r17">np</span><span class="r14">                                      </span>  
 <span class="r10">    6 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    7 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">try</span><span class="r18">:</span><span class="r14">                                                    </span>  
 <span class="r10">    8 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">import</span><span class="r16"> </span><span class="r17">orjson</span><span class="r16"> </span><span class="r15">as</span><span class="r16"> </span><span class="r17">json</span><span class="r14">                               </span>  
 <span class="r10">    9 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">except</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">:</span><span class="r14">                                     </span>  
 <span class="r10">   10 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">import</span><span class="r16"> </span><span class="r17">json</span><span class="r14">                                         </span>  
 <span class="r10">   11 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   12 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">try</span><span class="r18">:</span><span class="r14">                                                    </span>  
 <span class="r10">   13 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">from</span><span class="r16"> </span><span class="r17">tqdm.auto</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> tqdm</span><span class="r14">                          </span>  
 <span class="r10">   14 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    TQDM_AVAILABLE </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r14">                               </span>  
 <span class="r10">   15 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">except</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">:</span><span class="r14">                                     </span>  
 <span class="r10">   16 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    TQDM_AVAILABLE </span><span class="r20">=</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                              </span>  
 <span class="r10">   17 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">tqdm</span><span class="r18">(iterable</span><span class="r20">=</span><span class="r15">None</span><span class="r18">, </span><span class="r20">*</span><span class="r18">args, </span><span class="r20">**</span><span class="r18">kwargs):</span><span class="r14">           </span>  
 <span class="r10">   18 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> iterable</span><span class="r14">                                 </span>  
 <span class="r10">   19 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   20 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">from</span><span class="r16"> </span><span class="r17">.</span><span class="r16"> </span><span class="r15">import</span><span class="r18"> json_functions</span><span class="r14">                            </span>  
 <span class="r10">   21 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   22 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">change_extension</span><span class="r18">(path, new_extension):</span><span class="r14">              </span>  
 <span class="r10">   23 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    path </span><span class="r20">=</span><span class="r18"> </span><span class="r22">str</span><span class="r18">(path)</span><span class="r14">                                    </span>  
 <span class="r10">   24 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> path</span><span class="r20">.</span><span class="r18">rpartition(</span><span class="r21">&quot;.&quot;</span><span class="r18">)[</span><span class="r20">0</span><span class="r18">] </span><span class="r20">+</span><span class="r18"> new_extension</span><span class="r14">      </span>  
 <span class="r10">   25 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   26 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   27 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">find_newline_positions</span><span class="r18">(path, show_progress</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, lea</span>  
 <span class="r10">   28 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    path </span><span class="r20">=</span><span class="r18"> </span><span class="r22">str</span><span class="r18">(path)</span><span class="r14">                                    </span>  
 <span class="r10">   29 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    indexes </span><span class="r20">=</span><span class="r18"> []</span><span class="r14">                                        </span>  
 <span class="r10">   30 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(path, </span><span class="r21">&quot;r&quot;</span><span class="r18">, encoding</span><span class="r20">=</span><span class="r18">encoding) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14">       </span>  
 <span class="r10">   31 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        indexes</span><span class="r20">.</span><span class="r18">append(f</span><span class="r20">.</span><span class="r18">tell())</span><span class="r14">                        </span>  
 <span class="r10">   32 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        pbar </span><span class="r20">=</span><span class="r18"> tqdm(</span><span class="r14">                                    </span>  
 <span class="r10">   33 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            total</span><span class="r20">=</span><span class="r18">os</span><span class="r20">.</span><span class="r18">path</span><span class="r20">.</span><span class="r18">getsize(path),</span><span class="r14">                </span>  
 <span class="r10">   34 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            desc</span><span class="r20">=</span><span class="r21">&quot;Finding newlines for mmindex&quot;</span><span class="r18">,</span><span class="r14">        </span>  
 <span class="r10">   35 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            unit</span><span class="r20">=</span><span class="r21">&quot;B&quot;</span><span class="r18">,</span><span class="r14">                                   </span>  
 <span class="r10">   36 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            unit_scale</span><span class="r20">=</span><span class="r15">True</span><span class="r18">,</span><span class="r14">                            </span>  
 <span class="r10">   37 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            disable</span><span class="r20">=</span><span class="r23">not</span><span class="r18"> show_progress,</span><span class="r14">                  </span>  
 <span class="r10">   38 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            leave</span><span class="r20">=</span><span class="r18">leave_progress,</span><span class="r14">                       </span>  
 <span class="r10">   39 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        )</span><span class="r14">                                               </span>  
 <span class="r10">   40 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   41 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     6 </span>│<span class="r18">        </span><span class="r15">while</span><span class="r18"> f</span><span class="r20">.</span><span class="r18">readline():</span><span class="r14">                             </span>  
 <span class="r10">   42 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  360M </span>│<span class="r1">▁▁▁▁▁▁▁▁▁   1% </span>│<span class="r12">    71 </span>│<span class="r18">            t </span><span class="r20">=</span><span class="r18"> f</span><span class="r20">.</span><span class="r18">tell()</span><span class="r14">                                </span>  
 <span class="r10">   43 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   68M </span>│<span class="r1">▁▁▁▁▁          </span>│<span class="r12">     1 </span>│<span class="r18">            indexes</span><span class="r20">.</span><span class="r18">append(t)</span><span class="r14">                           </span>  
 <span class="r10">   44 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r14">                                                </span>  
 <span class="r10">   45 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> pbar </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                        </span>  
 <span class="r10">   46 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     2 </span>│<span class="r18">                pbar</span><span class="r20">.</span><span class="r18">update(t </span><span class="r20">-</span><span class="r18"> indexes[</span><span class="r20">-2</span><span class="r18">])</span><span class="r14">            </span>  
 <span class="r10">   47 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r14">                                                </span>  
 <span class="r10">   48 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> pbar </span><span class="r23">is</span><span class="r18"> </span><span class="r23">not</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                            </span>  
 <span class="r10">   49 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            pbar</span><span class="r20">.</span><span class="r18">close()</span><span class="r14">                                </span>  
 <span class="r10">   50 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   51 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   69M </span>│<span class="r1">▁              </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> indexes[:</span><span class="r20">-1</span><span class="r18">]</span><span class="r14">                                 </span>  
 <span class="r10">   52 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   53 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   54 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">save_mmindex</span><span class="r18">(indexes, path, encoding</span><span class="r20">=</span><span class="r21">&quot;utf-8&quot;</span><span class="r18">):</span><span class="r14">      </span>  
 <span class="r10">   55 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    path </span><span class="r20">=</span><span class="r18"> </span><span class="r22">str</span><span class="r18">(path)</span><span class="r14">                                    </span>  
 <span class="r10">   56 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    index_file </span><span class="r20">=</span><span class="r18"> change_extension(path, </span><span class="r21">&quot;.mmindex.json&quot;</span><span class="r18">)</span>  
 <span class="r10">   57 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(index_file, </span><span class="r21">&quot;w&quot;</span><span class="r18">, encoding</span><span class="r20">=</span><span class="r18">encoding) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14"> </span>  
 <span class="r10">   58 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">   98M </span>│<span class="r1">▁▁▁            </span>│<span class="r12">       </span>│<span class="r18">        f</span><span class="r20">.</span><span class="r18">write(json_functions</span><span class="r20">.</span><span class="r18">dumps(indexes))</span><span class="r14">          </span>  
 <span class="r10">   59 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   60 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   61 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">load_mmindex</span><span class="r18">(path, encoding</span><span class="r20">=</span><span class="r21">&quot;utf-8&quot;</span><span class="r18">):</span><span class="r14">               </span>  
 <span class="r10">   62 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    path </span><span class="r20">=</span><span class="r18"> </span><span class="r22">str</span><span class="r18">(path)</span><span class="r14">                                    </span>  
 <span class="r10">   63 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    index_file </span><span class="r20">=</span><span class="r18"> change_extension(path, </span><span class="r21">&quot;.mmindex.json&quot;</span><span class="r18">)</span>  
 <span class="r10">   64 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">with</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(index_file, </span><span class="r21">&quot;r&quot;</span><span class="r18">, encoding</span><span class="r20">=</span><span class="r18">encoding) </span><span class="r15">as</span><span class="r18"> f:</span><span class="r14"> </span>  
 <span class="r10">   65 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> json_functions</span><span class="r20">.</span><span class="r18">loads(f</span><span class="r20">.</span><span class="r18">read())</span><span class="r14">           </span>  
 <span class="r10">   66 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   67 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   68 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r26"># now we can jump to any line in the file thanks to the </span>  
 <span class="r10">   69 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">get_line</span><span class="r18">(</span><span class="r14">                                           </span>  
 <span class="r10">   70 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    path,</span><span class="r14">                                               </span>  
 <span class="r10">   71 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    index,</span><span class="r14">                                              </span>  
 <span class="r10">   72 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    mmindex,</span><span class="r14">                                            </span>  
 <span class="r10">   73 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    encoding</span><span class="r20">=</span><span class="r21">&quot;utf-8&quot;</span><span class="r18">,</span><span class="r14">                                   </span>  
 <span class="r10">   74 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    file_obj</span><span class="r20">=</span><span class="r15">None</span><span class="r18">,</span><span class="r14">                                      </span>  
 <span class="r10">   75 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    mmap_obj</span><span class="r20">=</span><span class="r15">None</span><span class="r18">,</span><span class="r14">                                      </span>  
 <span class="r10">   76 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">) </span><span class="r20">-&gt;</span><span class="r18"> </span><span class="r22">str</span><span class="r18">:</span><span class="r14">                                               </span>  
 <span class="r10">   77 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    path </span><span class="r20">=</span><span class="r18"> </span><span class="r22">str</span><span class="r18">(path)</span><span class="r14">                                    </span>  
 <span class="r10">   78 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> file_obj </span><span class="r23">is</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                                </span>  
 <span class="r10">   79 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        file_obj </span><span class="r20">=</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(path, </span><span class="r21">&quot;r&quot;</span><span class="r18">, encoding</span><span class="r20">=</span><span class="r18">encoding)</span><span class="r14">   </span>  
 <span class="r10">   80 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        CLOSE_FILE </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r14">                               </span>  
 <span class="r10">   81 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                               </span>  
 <span class="r10">   82 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        CLOSE_FILE </span><span class="r20">=</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                              </span>  
 <span class="r10">   83 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   84 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> mmap_obj </span><span class="r23">is</span><span class="r18"> </span><span class="r15">None</span><span class="r18">:</span><span class="r14">                                </span>  
 <span class="r10">   85 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        mmap_obj </span><span class="r20">=</span><span class="r18"> mmap</span><span class="r20">.</span><span class="r18">mmap(file_obj</span><span class="r20">.</span><span class="r18">fileno(), </span><span class="r20">0</span><span class="r18">, acces</span>  
 <span class="r10">   86 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        CLOSE_MMAP </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r14">                               </span>  
 <span class="r10">   87 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                               </span>  
 <span class="r10">   88 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        CLOSE_MMAP </span><span class="r20">=</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                              </span>  
 <span class="r10">   89 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   90 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    mmap_obj</span><span class="r20">.</span><span class="r18">seek(mmindex[index])</span><span class="r14">                       </span>  
 <span class="r10">   91 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    result </span><span class="r20">=</span><span class="r18"> mmap_obj</span><span class="r20">.</span><span class="r18">readline()</span><span class="r20">.</span><span class="r18">decode(encoding)</span><span class="r14">       </span>  
 <span class="r10">   92 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   93 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> CLOSE_MMAP:</span><span class="r14">                                      </span>  
 <span class="r10">   94 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        mmap_obj</span><span class="r20">.</span><span class="r18">close()</span><span class="r14">                                </span>  
 <span class="r10">   95 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   96 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> CLOSE_FILE:</span><span class="r14">                                      </span>  
 <span class="r10">   97 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        file_obj</span><span class="r20">.</span><span class="r18">close()</span><span class="r14">                                </span>  
 <span class="r10">   98 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   99 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> result</span><span class="r14">                                       </span>  
 <span class="r10">  100 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  101 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  102 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">class</span><span class="r16"> </span><span class="r17">JsonlCorpus</span><span class="r18">:</span><span class="r14">                                      </span>  
 <span class="r10">  103 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">    </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  104 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    A class to read a jsonl file line by line using mmap</span>  
 <span class="r10">  105 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    access to any line in the file. For example, you cou</span>  
 <span class="r10">  106 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    of a 10GB file in a fraction of a second, returning </span>  
 <span class="r10">  107 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  108 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Example</span><span class="r14">                                             </span>  
 <span class="r10">  109 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    --------</span><span class="r14">                                            </span>  
 <span class="r10">  110 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  111 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Traditioanally, you would read a jsonl file line by </span>  
 <span class="r10">  112 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  113 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    ```python</span><span class="r14">                                           </span>  
 <span class="r10">  114 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    import json</span><span class="r14">                                         </span>  
 <span class="r10">  115 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    data = [json.loads(line) for line in open(&quot;file.json</span>  
 <span class="r10">  116 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    print(corpus[1000])</span><span class="r14">                                 </span>  
 <span class="r10">  117 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    ```</span><span class="r14">                                                 </span>  
 <span class="r10">  118 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  119 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    This is memory inefficient and has a large overhead.</span>  
 <span class="r10">  120 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  121 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    ```python</span><span class="r14">                                           </span>  
 <span class="r10">  122 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    corpus = JsonlCorpus(&quot;file.jsonl&quot;)</span><span class="r14">                  </span>  
 <span class="r10">  123 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    print(corpus[1000])</span><span class="r14">                                 </span>  
 <span class="r10">  124 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    ```</span><span class="r14">                                                 </span>  
 <span class="r10">  125 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  126 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    Which only loads the line you need into memory, and </span>  
 <span class="r10">  127 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">    &quot;&quot;&quot;</span><span class="r14">                                                 </span>  
 <span class="r10">  128 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  129 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">__init__</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, path, show_progress</span><span class="r20">=</span><span class="r15">True</span><span class="r18">, leave_p</span>  
 <span class="r10">  130 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">path </span><span class="r20">=</span><span class="r18"> path</span><span class="r14">                                </span>  
 <span class="r10">  131 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">verbosity </span><span class="r20">=</span><span class="r18"> verbosity</span><span class="r14">                      </span>  
 <span class="r10">  132 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">encoding </span><span class="r20">=</span><span class="r18"> encoding</span><span class="r14">                        </span>  
 <span class="r10">  133 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  134 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># if the index file does not exist, create it</span><span class="r14">   </span>  
 <span class="r10">  135 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> os</span><span class="r20">.</span><span class="r18">path</span><span class="r20">.</span><span class="r18">exists(change_extension(path, </span><span class="r21">&quot;.mmind</span>  
 <span class="r10">  136 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">mmindex </span><span class="r20">=</span><span class="r18"> load_mmindex(path, encoding</span><span class="r20">=</span><span class="r22">s</span>  
 <span class="r10">  137 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">else</span><span class="r18">:</span><span class="r14">                                           </span>  
 <span class="r10">  138 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            logging</span><span class="r20">.</span><span class="r18">info(</span><span class="r21">&quot;Creating index file for jsonl </span>  
 <span class="r10">  139 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            mmindex </span><span class="r20">=</span><span class="r18"> find_newline_positions(</span><span class="r14">           </span>  
 <span class="r10">  140 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                path, show_progress</span><span class="r20">=</span><span class="r18">show_progress, leave</span>  
 <span class="r10">  141 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  142 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">if</span><span class="r18"> save_index:</span><span class="r14">                              </span>  
 <span class="r10">  143 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                save_mmindex(mmindex, path, encoding</span><span class="r20">=</span><span class="r22">sel</span>  
 <span class="r10">  144 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  145 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">mmindex </span><span class="r20">=</span><span class="r18"> mmindex</span><span class="r14">                      </span>  
 <span class="r10">  146 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  147 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Finally, open the file and mmap objects</span><span class="r14">       </span>  
 <span class="r10">  148 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">load()</span><span class="r14">                                     </span>  
 <span class="r10">  149 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  150 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">__len__</span><span class="r18">(</span><span class="r22">self</span><span class="r18">):</span><span class="r14">                                  </span>  
 <span class="r10">  151 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> </span><span class="r22">len</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">mmindex)</span><span class="r14">                        </span>  
 <span class="r10">  152 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  153 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">__getitem__</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, index):</span><span class="r14">                       </span>  
 <span class="r10">  154 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># handle multiple indices</span><span class="r14">                       </span>  
 <span class="r10">  155 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(index, </span><span class="r22">int</span><span class="r18">):</span><span class="r14">                      </span>  
 <span class="r10">  156 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> json_functions</span><span class="r20">.</span><span class="r18">loads(</span><span class="r14">                </span>  
 <span class="r10">  157 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                get_line(</span><span class="r14">                               </span>  
 <span class="r10">  158 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r22">self</span><span class="r20">.</span><span class="r18">path,</span><span class="r14">                          </span>  
 <span class="r10">  159 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    index,</span><span class="r14">                              </span>  
 <span class="r10">  160 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    </span><span class="r22">self</span><span class="r20">.</span><span class="r18">mmindex,</span><span class="r14">                       </span>  
 <span class="r10">  161 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    encoding</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">encoding,</span><span class="r14">             </span>  
 <span class="r10">  162 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    file_obj</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">file_obj,</span><span class="r14">             </span>  
 <span class="r10">  163 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                    mmap_obj</span><span class="r20">=</span><span class="r22">self</span><span class="r20">.</span><span class="r18">mmap_obj,</span><span class="r14">             </span>  
 <span class="r10">  164 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">                )</span><span class="r14">                                       </span>  
 <span class="r10">  165 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            )</span><span class="r14">                                           </span>  
 <span class="r10">  166 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  167 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(index, </span><span class="r22">slice</span><span class="r18">):</span><span class="r14">                    </span>  
 <span class="r10">  168 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> [</span><span class="r22">self</span><span class="r20">.</span><span class="r19">__getitem__</span><span class="r18">(i) </span><span class="r15">for</span><span class="r18"> i </span><span class="r23">in</span><span class="r18"> </span><span class="r22">range</span><span class="r18">(</span><span class="r20">*</span>  
 <span class="r10">  169 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(index, (</span><span class="r22">list</span><span class="r18">, </span><span class="r22">tuple</span><span class="r18">)):</span><span class="r14">            </span>  
 <span class="r10">  170 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> [</span><span class="r22">self</span><span class="r20">.</span><span class="r19">__getitem__</span><span class="r18">(i) </span><span class="r15">for</span><span class="r18"> i </span><span class="r23">in</span><span class="r18"> index]</span><span class="r14"> </span>  
 <span class="r10">  171 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">isinstance</span><span class="r18">(index, np</span><span class="r20">.</span><span class="r18">ndarray):</span><span class="r14">               </span>  
 <span class="r10">  172 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># if it&#x27;s an ndarray, this means each elemen</span>  
 <span class="r10">  173 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># be of any shape. thus, we should flatten i</span>  
 <span class="r10">  174 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># was a list, and then reshape it back to th</span>  
 <span class="r10">  175 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            index_flat </span><span class="r20">=</span><span class="r18"> index</span><span class="r20">.</span><span class="r18">flatten()</span><span class="r20">.</span><span class="r18">tolist()</span><span class="r14">       </span>  
 <span class="r10">  176 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            results </span><span class="r20">=</span><span class="r18"> [</span><span class="r22">self</span><span class="r20">.</span><span class="r19">__getitem__</span><span class="r18">(i) </span><span class="r15">for</span><span class="r18"> i </span><span class="r23">in</span><span class="r18"> inde</span>  
 <span class="r10">  177 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            reshaped </span><span class="r20">=</span><span class="r18"> np</span><span class="r20">.</span><span class="r18">array(results)</span><span class="r20">.</span><span class="r18">reshape(index</span><span class="r20">.</span><span class="r18">s</span>  
 <span class="r10">  178 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">return</span><span class="r18"> reshaped</span><span class="r14">                             </span>  
 <span class="r10">  179 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r14">                                                </span>  
 <span class="r10">  180 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">raise</span><span class="r18"> </span><span class="r31">TypeError</span><span class="r18">(</span><span class="r21">&quot;Invalid index type&quot;</span><span class="r18">)</span><span class="r14">           </span>  
 <span class="r10">  181 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  182 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">close</span><span class="r18">(</span><span class="r22">self</span><span class="r18">):</span><span class="r14">                                    </span>  
 <span class="r10">  183 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  184 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Close the file and mmap objects. This is useful </span>  
 <span class="r10">  185 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        If you don&#x27;t call this method, the objects will </span>  
 <span class="r10">  186 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  187 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">hasattr</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, </span><span class="r21">&quot;file_obj&quot;</span><span class="r18">) </span><span class="r23">and</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">file_obj </span><span class="r23">i</span>  
 <span class="r10">  188 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">file_obj</span><span class="r20">.</span><span class="r18">close()</span><span class="r14">                       </span>  
 <span class="r10">  189 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># delete the object</span><span class="r14">                         </span>  
 <span class="r10">  190 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">del</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">file_obj</span><span class="r14">                           </span>  
 <span class="r10">  191 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">file_obj </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r14">                        </span>  
 <span class="r10">  192 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">hasattr</span><span class="r18">(</span><span class="r22">self</span><span class="r18">, </span><span class="r21">&quot;mmap_obj&quot;</span><span class="r18">) </span><span class="r23">and</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">mmap_obj </span><span class="r23">i</span>  
 <span class="r10">  193 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">mmap_obj</span><span class="r20">.</span><span class="r18">close()</span><span class="r14">                       </span>  
 <span class="r10">  194 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r26"># delete the object</span><span class="r14">                         </span>  
 <span class="r10">  195 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r15">del</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">mmap_obj</span><span class="r14">                           </span>  
 <span class="r10">  196 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            </span><span class="r22">self</span><span class="r20">.</span><span class="r18">mmap_obj </span><span class="r20">=</span><span class="r18"> </span><span class="r15">None</span><span class="r14">                        </span>  
 <span class="r10">  197 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">verbosity </span><span class="r20">&gt;=</span><span class="r18"> </span><span class="r20">1</span><span class="r18">:</span><span class="r14">                         </span>  
 <span class="r10">  198 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            logging</span><span class="r20">.</span><span class="r18">info(</span><span class="r21">&quot;Closed file and mmap objects&quot;</span><span class="r18">)</span>  
 <span class="r10">  199 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r14">                                                    </span>  
 <span class="r10">  200 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">load</span><span class="r18">(</span><span class="r22">self</span><span class="r18">):</span><span class="r14">                                     </span>  
 <span class="r10">  201 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r16">        </span><span class="r13">&quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  202 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Load the file and mmap objects. This is useful i</span>  
 <span class="r10">  203 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  204 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Note</span><span class="r14">                                            </span>  
 <span class="r10">  205 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        ----</span><span class="r14">                                            </span>  
 <span class="r10">  206 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        This is called automatically when the object is </span>  
 <span class="r10">  207 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        Also, if there is an existing file and mmap obje</span>  
 <span class="r10">  208 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">        &quot;&quot;&quot;</span><span class="r14">                                             </span>  
 <span class="r10">  209 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">close()  </span><span class="r26"># close any existing file and mmap</span>  
 <span class="r10">  210 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">  211 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">file_obj </span><span class="r20">=</span><span class="r18"> </span><span class="r22">open</span><span class="r18">(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">path, </span><span class="r21">&quot;r&quot;</span><span class="r18">, encoding</span><span class="r20">=</span><span class="r22">se</span>  
 <span class="r10">  212 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">mmap_obj </span><span class="r20">=</span><span class="r18"> mmap</span><span class="r20">.</span><span class="r18">mmap(</span><span class="r22">self</span><span class="r20">.</span><span class="r18">file_obj</span><span class="r20">.</span><span class="r18">fileno()</span>  
 <span class="r10">  213 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">if</span><span class="r18"> </span><span class="r22">self</span><span class="r20">.</span><span class="r18">verbosity </span><span class="r20">&gt;=</span><span class="r18"> </span><span class="r20">1</span><span class="r18">:</span><span class="r14">                         </span>  
 <span class="r10">  214 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">            logging</span><span class="r20">.</span><span class="r18">info(</span><span class="r21">&quot;Opened file and mmap objects&quot;</span><span class="r18">)</span>  
 <span class="r10">  215 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r14">                                                    </span>  
 <span class="r10">  216 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">__del__</span><span class="r18">(</span><span class="r22">self</span><span class="r18">):</span><span class="r14">                                  </span>  
 <span class="r10">  217 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r22">self</span><span class="r20">.</span><span class="r18">close()</span><span class="r14">                                    </span>  
 <span class="r10">  218 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
       ╵       ╵       ╵       ╵        ╵       ╵               ╵       ╵                                                          
Top PEAK memory consumption, by line:
<span class="r1">(1)    42:   360 MB</span>                                                                                                                 
<span class="r1">(2)    58:    98 MB</span>                                                                                                                 
<span class="r1">(3)    51:    69 MB</span>                                                                                                                 
<span class="r1">(4)    43:    68 MB</span>                                                                                                                 
<span class="r30">           /home/team-054/dkozlov/bm25s/bm25s/utils/json_functions.py: % of time =   0.00% (0.000ms) out of 21m:32.451s.           </span>
       ╷       ╷       ╷       ╷        ╷       ╷               ╷       ╷                                                          
 <span class="r2">      </span>│<span class="r3">Time</span><span class="r2">   </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r4">Memory</span><span class="r2">  </span>│<span class="r4">––––––</span><span class="r2"> </span>│<span class="r4">–––––––––––</span><span class="r2">    </span>│<span class="r5">Copy</span><span class="r2">   </span>│<span class="r2">                                                         </span> 
 <span class="r2"> </span><span class="r6">Line</span><span class="r2"> </span>│<span class="r7">Python</span><span class="r2"> </span>│<span class="r7">native</span><span class="r2"> </span>│<span class="r7">system</span><span class="r2"> </span>│<span class="r8">Python</span><span class="r2">  </span>│<span class="r8">peak</span><span class="r2">   </span>│<span class="r8">timeline</span><span class="r4">/%</span><span class="r2">     </span>│<span class="r9">(MB/s)</span><span class="r2"> </span>│<span class="r2">/home/team-054/dkozlov/bm25s/bm25s/utils/json_functions… </span> 
╺━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r10">    1 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">import</span><span class="r16"> </span><span class="r17">json</span><span class="r14">                                             </span>  
 <span class="r10">    2 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">    3 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">try</span><span class="r18">:</span><span class="r14">                                                    </span>  
 <span class="r10">    4 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">import</span><span class="r16"> </span><span class="r17">orjson</span><span class="r14">                                       </span>  
 <span class="r10">    5 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ORJSON_AVAILABLE </span><span class="r20">=</span><span class="r18"> </span><span class="r15">True</span><span class="r14">                             </span>  
 <span class="r10">    6 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">except</span><span class="r18"> </span><span class="r31">ImportError</span><span class="r18">:</span><span class="r14">                                     </span>  
 <span class="r10">    7 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    ORJSON_AVAILABLE </span><span class="r20">=</span><span class="r18"> </span><span class="r15">False</span><span class="r14">                            </span>  
 <span class="r10">    8 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r14">                                                    </span>  
 <span class="r10">    9 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   10 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">dumps_with_builtin</span><span class="r18">(d: </span><span class="r22">dict</span><span class="r18">, </span><span class="r20">**</span><span class="r18">kwargs) </span><span class="r20">-&gt;</span><span class="r18"> </span><span class="r22">str</span><span class="r18">:</span><span class="r14">       </span>  
 <span class="r10">   11 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1"> 100%   </span>│<span class="r1">  451M </span>│<span class="r1">▁▁▁▁▁▁▁▁▁   3% </span>│<span class="r12">     4 </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> json</span><span class="r20">.</span><span class="r18">dumps(d, </span><span class="r20">**</span><span class="r18">kwargs)</span><span class="r14">                      </span>  
 <span class="r10">   12 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   13 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">def</span><span class="r16"> </span><span class="r19">dumps_with_orjson</span><span class="r18">(d: </span><span class="r22">dict</span><span class="r18">, </span><span class="r20">**</span><span class="r18">kwargs) </span><span class="r20">-&gt;</span><span class="r18"> </span><span class="r22">str</span><span class="r18">:</span><span class="r14">        </span>  
 <span class="r10">   14 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">if</span><span class="r18"> kwargs</span><span class="r20">.</span><span class="r18">get(</span><span class="r21">&quot;ensure_ascii&quot;</span><span class="r18">, </span><span class="r15">True</span><span class="r18">):</span><span class="r14">                </span>  
 <span class="r10">   15 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r26"># Simulate `ensure_ascii=True` by escaping non-A</span>  
 <span class="r10">   16 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> orjson</span><span class="r20">.</span><span class="r18">dumps(d)</span><span class="r20">.</span><span class="r18">decode(</span><span class="r21">&quot;utf-8&quot;</span><span class="r18">)</span><span class="r20">.</span><span class="r18">encode(</span><span class="r21">&quot;a</span>  
 <span class="r10">   17 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r26"># Ignore other kwargs not supported by orjson</span><span class="r14">       </span>  
 <span class="r10">   18 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">return</span><span class="r18"> orjson</span><span class="r20">.</span><span class="r18">dumps(d)</span><span class="r20">.</span><span class="r18">decode(</span><span class="r21">&quot;utf-8&quot;</span><span class="r18">)</span><span class="r14">              </span>  
 <span class="r10">   19 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   20 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">if</span><span class="r18"> ORJSON_AVAILABLE:</span><span class="r14">                                    </span>  
 <span class="r10">   21 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">dumps</span><span class="r18">(d: </span><span class="r22">dict</span><span class="r18">, </span><span class="r20">**</span><span class="r18">kwargs) </span><span class="r20">-&gt;</span><span class="r18"> </span><span class="r22">str</span><span class="r18">:</span><span class="r14">                </span>  
 <span class="r10">   22 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> dumps_with_orjson(d, </span><span class="r20">**</span><span class="r18">kwargs)</span><span class="r14">           </span>  
 <span class="r10">   23 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    loads </span><span class="r20">=</span><span class="r18"> orjson</span><span class="r20">.</span><span class="r18">loads</span><span class="r14">                                </span>  
 <span class="r10">   24 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">else</span><span class="r18">:</span><span class="r14">                                                   </span>  
 <span class="r10">   25 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    </span><span class="r15">def</span><span class="r16"> </span><span class="r19">dumps</span><span class="r18">(d: </span><span class="r22">dict</span><span class="r18">, </span><span class="r20">**</span><span class="r18">kwargs) </span><span class="r20">-&gt;</span><span class="r18"> </span><span class="r22">str</span><span class="r18">:</span><span class="r14">                </span>  
 <span class="r10">   26 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">     1 </span>│<span class="r18">        </span><span class="r15">return</span><span class="r18"> dumps_with_builtin(d, </span><span class="r20">**</span><span class="r18">kwargs)</span><span class="r14">          </span>  
 <span class="r10">   27 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">    loads </span><span class="r20">=</span><span class="r18"> json</span><span class="r20">.</span><span class="r18">loads</span><span class="r14">                                  </span>  
 <span class="r10">   28 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   29 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
 <span class="r10">   30 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r1">        </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">                                                        </span>  
       ╵       ╵       ╵       ╵        ╵       ╵               ╵       ╵                                                          
Top PEAK memory consumption, by line:
<span class="r1">(1)    11:   451 MB</span>                                                                                                                 
generated by the <a class="r34" href="https://github.com/plasma-umass/scalene">scalene</a> profiler                                                                                                   
</code></pre>
</body>
</html>
